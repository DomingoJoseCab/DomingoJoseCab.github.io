<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>ce4316f4d8054061a3b2193f9e7790ff</title>
  <style>
    html {
      line-height: 1.5;
      font-family: Georgia, serif;
      font-size: 20px;
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 1em;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, 'Lucida Console', Consolas, monospace;
      font-size: 85%;
      margin: 0;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<div id="b800fd19" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.0335e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:28.786314&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:28.765979&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<h1
id="proyecto-final-de-la-asignatura-de-visión-artificial-y-reconocimiento-de-patrones">Proyecto
Final de la asignatura de Visión Artificial y Reconocimiento de
Patrones</h1>
<p>Cuaderno correspondiente al proyecto final de la asignatura de Visión
Artificial y Reconocimiento de Patrones con el objetivo de mostrar las
distintas técnicas aprendidas a lo largo del curso. El problema tratará
de una clasificación de animales repartidas en 10 clases desbalanceadas,
lo que modificará nuestra forma de evaluación del modelo. Dicho proyecto
será realizado en Kaggle dado que nos da la oportunidad de ejecutarlo en
un entorno óptimo para el problema.</p>
<p><strong>Proyecto realizado por:</strong></p>
<ul>
<li><h3 id="domingo-josé-caballero-navarro"><strong>Domingo José
Caballero Navarro</strong></h3></li>
<li><h3 id="rubén-castillo-carrasco"><strong>Rubén Castillo
Carrasco</strong></h3></li>
</ul>
<p><strong>Proyecto supervisado por:</strong></p>
<ul>
<li><h3 id="josé-miguel-puerta-callejón"><strong>José Miguel Puerta
Callejón</strong></h3></li>
<li><h3 id="luis-gonzález-naharro"><strong>Luis González
Naharro</strong></h3></li>
</ul>
<p><strong>Asignatura:</strong></p>
<ul>
<li><h3
id="visión-artificial-y-reconocimiento-de-patrones-universidad-de-castilla-la-mancha"><strong>Visión
Artificial y Reconocimiento de Patrones (Universidad de Castilla-La
Mancha)</strong></h3></li>
</ul>
</div>
<div id="559d820c" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.8321e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:28.823519&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:28.805198&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<h1
id="clasificación-de-animales-repartidos-en-10-clases-desbalanceadas">Clasificación
de animales repartidos en 10 clases desbalanceadas</h1>
<p>El problema que se nos presenta es el de clasificar distintas
imágenes entre 10 tipos de clases. Dichas clases se encuentran
desbalanceadas, algo muy importante a tener en cuenta a la hora de la
validación. Lo que se realizará en este cuaderno lo podemos ver
reflejado a continuación:</p>
<h3 id="índice"><strong>Índice:</strong></h3>
<ol>
<li><a href="#introduccion">Introducción al problema</a></li>
<li><a href="#analisis">Análisis exploratorio de los datos</a></li>
<li><a href="#preprocesamiento">Preprocesamiento de los datos</a></li>
<li><a href="#creacion">Diseño de diferentes modelos</a></li>
<li><a href="#resultados">Análisis de los resultados obtenidos</a></li>
<li><a href="#validacion">Detalles del modelo final: Ensemble</a></li>
<li><a href="#conclusion">Conclusión</a></li>
</ol>
</div>
<div id="8e223f34" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.8284e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:28.860348&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:28.842064&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<h1 id="1-introducción">1. Introducción<a name="introduccion"></a></h1>
<p>Par la realización de este proyecto utilizaremos las librerías
principales para el tratamiento de imágenes y redes neuronales. Por lo
tanto, empezaremos importanto <code>numpy</code>, <code>pandas</code>,
<code>os</code>, <code>cv2</code>, <code>keras</code> y
<code>glob</code>.</p>
</div>
<div id="1b6cda65" class="cell code" data-execution_count="1"
data-_cell_guid="b1076dfc-b9ad-4769-8c92-a6c4dae69d19"
data-_uuid="8f2839f25d086af736a60e9eeb907d3b93b6e0e5"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:28.900128Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:28.899474Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:01:33.781356Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:01:33.780291Z&quot;}"
data-papermill="{&quot;duration&quot;:4.905182,&quot;end_time&quot;:&quot;2023-01-11T16:01:33.783993&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:28.878811&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb1"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> glob</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span></code></pre></div>
</div>
<div id="d52a76ac" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.0351e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:33.826283&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:33.805932&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Además, activaremos la GPU que nos ofrece Kaggle para poder acelerar
el entrenamiento de nuestros modelos mejorando así el tiempo de
ejecución.</p>
</div>
<div id="690f8316" class="cell code" data-execution_count="2"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:33.867039Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:33.866449Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:01:34.097966Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:01:34.096930Z&quot;}"
data-papermill="{&quot;duration&quot;:0.255327,&quot;end_time&quot;:&quot;2023-01-11T16:01:34.101299&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:33.845972&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb2"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>device_type <span class="op">=</span> <span class="st">&quot;GPU&quot;</span>  <span class="co"># The device type</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>devices <span class="op">=</span> tf.config.list_physical_devices(device_type)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> devices:</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Raise an informative message when there are no devices in the host runtime</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">raise</span> <span class="pp">RuntimeError</span>(<span class="ss">f&quot;No </span><span class="sc">{</span>device_type<span class="sc">}</span><span class="ss"> devices are used in the host.&quot;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>2023-01-11 16:01:33.933612: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:01:34.086470: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:01:34.087369: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
</code></pre>
</div>
</div>
<div id="7240feae" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.9574e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:34.142245&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:34.122671&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<h1 id="2-análisis-exploratorio-de-los-datos">2. Análisis exploratorio
de los datos<a name="analisis"></a></h1>
<p>El primer paso que tenemos que hacer a la hora de inicar un proyecto
es cargar y dividir nuestro conjunto de datos en entrenamiento,
validación y test. Obteniendo así los conjuntos que utilizaremos para
validar nuestros modelos y para entrenarlos.</p>
<p>Posteriormente a la división empezaremos con el análisis exploratorio
de datos en el que observaremos como esta formado nuestro conjunto de
<strong>entrenamiento</strong>, es importante destacar que se realiza
sobre el entrenamiento dado que si observaramos el test estaríamos
causando una fuga de datos. Con esto queremos expresar que si nos
fijamos en el test para crear nuestro modelo o nuestro preprocesamiento
estaríamos alterando el resultado de validación, haciendo que nuestro
modelo en producción se vea perjudicado.</p>
<p>Para dividir nuestro conjunto de datos utilizaremos
<code>split-folders</code>.</p>
</div>
<div id="137cbf63" class="cell code" data-execution_count="3"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:34.192327Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:34.191996Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:01:45.087833Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:01:45.086642Z&quot;}"
data-papermill="{&quot;duration&quot;:10.928426,&quot;end_time&quot;:&quot;2023-01-11T16:01:45.090326&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:34.161900&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb4"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span> pip install split<span class="op">-</span>folders</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Collecting split-folders
  Downloading split_folders-0.5.1-py3-none-any.whl (8.4 kB)
Installing collected packages: split-folders
Successfully installed split-folders-0.5.1
WARNING: Running pip as the &#39;root&#39; user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv
</code></pre>
</div>
</div>
<div id="adf834c0" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.8777e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:45.128559&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:45.109782&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez instalado pasaremos a importar las librerías necesarias para
el apartado de carga de los datos y para el análisis exploratorio de
datos.</p>
</div>
<div id="e82edd6f" class="cell code" data-execution_count="4"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:45.168832Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:45.168505Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:01:46.991208Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:01:46.990131Z&quot;}"
data-papermill="{&quot;duration&quot;:1.846216,&quot;end_time&quot;:&quot;2023-01-11T16:01:46.994212&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:45.147996&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb6"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> splitfolders</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> PIL</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pathlib</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.graph_objects <span class="im">as</span> go</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> itertools</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> plotly.express <span class="im">as</span> px</span></code></pre></div>
</div>
<div id="584246ec" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.9894e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:47.037028&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:47.017134&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos cargadas las librerías necesarías procedemos a cargar
los datos, para ello lo primero que hacemos es almacenar el camino dónde
se encuentran los datos.</p>
</div>
<div id="dc248a00" class="cell code" data-execution_count="5"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:47.079177Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:47.078132Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:01:47.083435Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:01:47.082170Z&quot;}"
data-papermill="{&quot;duration&quot;:2.8671e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:47.085688&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:47.057017&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb7"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> <span class="st">&quot;../input/animals10/raw-img&quot;</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>path <span class="op">=</span> pathlib.Path(path)</span></code></pre></div>
</div>
<div id="1cc2bb93" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.9647e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:47.124945&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:47.105298&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>A continuación, teniendo el camino dónde se encuentran el conjunto de
datos los cargamos en images.</p>
</div>
<div id="dd34d575" class="cell code" data-execution_count="6"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:47.164543Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:47.164272Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:01:50.592266Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:01:50.590071Z&quot;}"
data-papermill="{&quot;duration&quot;:3.451169,&quot;end_time&quot;:&quot;2023-01-11T16:01:50.595077&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:47.143908&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb8"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> glob.glob(<span class="st">&#39;../input/animals10/raw-img/*/*.jpeg&#39;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;El número de imágenes es: &quot;</span>, <span class="bu">len</span>(images))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> pd.Series(images)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>El número de imágenes es:  24209
</code></pre>
</div>
</div>
<div id="7b4301d0" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.9398e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:50.634711&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:50.615313&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos las imágenes cargadas nos encargamos de organizar
correctamente los datos.</p>
</div>
<div id="406df3ac" class="cell code" data-execution_count="7"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:50.674930Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:50.674044Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:01:50.712016Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:01:50.711133Z&quot;}"
data-papermill="{&quot;duration&quot;:6.0485e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:50.714189&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:50.653704&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb10"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;FileName&#39;</span>] <span class="op">=</span> images.<span class="bu">map</span>(<span class="kw">lambda</span> image_name :image_name.split(<span class="st">&quot;H&quot;</span>)[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>df[<span class="st">&#39;ClassId&#39;</span>] <span class="op">=</span> images.<span class="bu">map</span>(<span class="kw">lambda</span> image_name :image_name.split(<span class="st">&quot;/&quot;</span>)[<span class="op">-</span><span class="dv">2</span>])</span></code></pre></div>
</div>
<div id="ba51fc0e" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.8901e-2,&quot;end_time&quot;:&quot;2023-01-11T16:01:50.752050&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:50.733149&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>A continuación, teniendo todo el conjunto de datos realizamos la
división en entrenamiento, validación y test. En este caso dejaremos un
80% para entrenamiento, un 10% para validación y otro 10% para test.</p>
</div>
<div id="0c5e414f" class="cell code" data-execution_count="8"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:01:50.792020Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:01:50.791112Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:39.776142Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:39.773578Z&quot;}"
data-papermill="{&quot;duration&quot;:229.007352,&quot;end_time&quot;:&quot;2023-01-11T16:05:39.778329&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:01:50.770977&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb11"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>splitfolders.ratio(path, output<span class="op">=</span><span class="st">&quot;output&quot;</span>, seed<span class="op">=</span><span class="dv">101</span>, ratio<span class="op">=</span>(<span class="fl">.8</span>, <span class="fl">.1</span>, <span class="fl">.1</span>))</span></code></pre></div>
<div class="output stream stderr">
<pre><code>Copying files: 26179 files [03:48, 114.33 files/s]
</code></pre>
</div>
</div>
<div id="70915f01" class="cell code" data-execution_count="9"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:39.975059Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:39.974246Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:40.055548Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:40.054640Z&quot;}"
data-papermill="{&quot;duration&quot;:0.181456,&quot;end_time&quot;:&quot;2023-01-11T16:05:40.057881&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:39.876425&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb13"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>train_image <span class="op">=</span> glob.glob(<span class="st">&#39;./output/train/*/*.jpeg&#39;</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>train_images <span class="op">=</span> train_image </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>test_image <span class="op">=</span> glob.glob(<span class="st">&#39;./output/test/*/*.jpeg&#39;</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>test_images <span class="op">=</span> test_image</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>val_image <span class="op">=</span> glob.glob(<span class="st">&#39;./output/val/*/*.jpeg&#39;</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>val_images <span class="op">=</span> val_image </span></code></pre></div>
</div>
<div id="e82ee351" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.101274,&quot;end_time&quot;:&quot;2023-01-11T16:05:40.260897&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:40.159623&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos visualizar cuántas imágenes hay en cada conjunto.</p>
</div>
<div id="9b42858e" class="cell code" data-execution_count="10"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:40.457799Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:40.457449Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:40.462966Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:40.462012Z&quot;}"
data-papermill="{&quot;duration&quot;:0.106348,&quot;end_time&quot;:&quot;2023-01-11T16:05:40.465867&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:40.359519&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb14"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;El número de imágenes para el entrenamiento: &quot;</span>, <span class="bu">len</span>(train_images))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;El número de imágenes para el test: &quot;</span>, <span class="bu">len</span>(test_image))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">&quot;El número de imágenes para la validación: &quot;</span>, <span class="bu">len</span>(val_images))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>El número de imágenes para el entrenamiento:  19366
El número de imágenes para el test:  2447
El número de imágenes para la validación:  2396
</code></pre>
</div>
</div>
<div id="f3f5e0f0" class="cell code" data-execution_count="11"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:40.716669Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:40.716324Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:40.721853Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:40.720914Z&quot;}"
data-papermill="{&quot;duration&quot;:0.106284,&quot;end_time&quot;:&quot;2023-01-11T16:05:40.723863&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:40.617579&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb16"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>train_path <span class="op">=</span> <span class="st">&#39;./output/train/&#39;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>val_path <span class="op">=</span> <span class="st">&#39;./output/val&#39;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>test_path <span class="op">=</span> <span class="st">&#39;./output/test&#39;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>class_names <span class="op">=</span> os.listdir(train_path)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>class_names_val <span class="op">=</span> os.listdir(val_path)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>class_names_test <span class="op">=</span> os.listdir(test_path)</span></code></pre></div>
</div>
<div id="9ec1a5d6" class="cell markdown"
data-papermill="{&quot;duration&quot;:9.6894e-2,&quot;end_time&quot;:&quot;2023-01-11T16:05:40.917949&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:40.821055&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>De una forma visual lo podemos comprender mejor.</p>
</div>
<div id="e2818512" class="cell code" data-execution_count="12"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:41.133776Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:41.131824Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:41.928931Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:41.927735Z&quot;}"
data-papermill="{&quot;duration&quot;:0.915319,&quot;end_time&quot;:&quot;2023-01-11T16:05:41.931217&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:41.015898&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb17"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>random_x <span class="op">=</span> [<span class="bu">len</span>(train_images), <span class="bu">len</span>(test_images), <span class="bu">len</span>(val_images)]</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>names <span class="op">=</span> [<span class="st">&#39;Train&#39;</span>, <span class="st">&#39;Test&#39;</span>, <span class="st">&#39;Val&#39;</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> px.pie(values<span class="op">=</span>random_x, names<span class="op">=</span>names)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title<span class="op">=</span><span class="st">&#39;Distribución de los conjuntos&#39;</span>,font_size<span class="op">=</span><span class="dv">15</span>,title_x<span class="op">=</span><span class="fl">0.45</span>,annotations<span class="op">=</span>[<span class="bu">dict</span>(text<span class="op">=</span><span class="st">&#39;Animas-10&#39;</span>,font_size<span class="op">=</span><span class="dv">18</span>, showarrow<span class="op">=</span><span class="va">False</span>,height<span class="op">=</span><span class="dv">800</span>,width<span class="op">=</span><span class="dv">700</span>)])</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>fig.update_traces(textfont_size<span class="op">=</span><span class="dv">15</span>,textinfo<span class="op">=</span><span class="st">&#39;percent&#39;</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
<div class="output display_data">
        <script type="text/javascript">
        window.PlotlyConfig = {MathJaxConfig: 'local'};
        if (window.MathJax && window.MathJax.Hub && window.MathJax.Hub.Config) {window.MathJax.Hub.Config({SVG: {font: "STIX-Web"}});}
        if (typeof require !== 'undefined') {
        require.undef("plotly");
        requirejs.config({
            paths: {
                'plotly': ['https://cdn.plot.ly/plotly-2.14.0.min']
            }
        });
        require(['plotly'], function(Plotly) {
            window._Plotly = Plotly;
        });
        }
        </script>
        
</div>
<div class="output display_data">
<div>                            <div id="630ab12b-70fd-46d0-a389-d85282790fc9" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("630ab12b-70fd-46d0-a389-d85282790fc9")) {                    Plotly.newPlot(                        "630ab12b-70fd-46d0-a389-d85282790fc9",                        [{"domain":{"x":[0.0,1.0],"y":[0.0,1.0]},"hovertemplate":"label=%{label}<br>value=%{value}<extra></extra>","labels":["Train","Test","Val"],"legendgroup":"","name":"","showlegend":true,"values":[19366,2447,2396],"type":"pie","textfont":{"size":15},"textinfo":"percent"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"legend":{"tracegroupgap":0},"margin":{"t":60},"font":{"size":15},"title":{"text":"Distribución de los conjuntos","x":0.45},"annotations":[{"height":800,"showarrow":false,"text":"Animas-10","width":700,"font":{"size":18}}]},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('630ab12b-70fd-46d0-a389-d85282790fc9');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="e8999ad1" class="cell markdown"
data-papermill="{&quot;duration&quot;:9.8277e-2,&quot;end_time&quot;:&quot;2023-01-11T16:05:42.128378&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:42.030101&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar en el gráfico cómo están repartidos los conjuntos de
entrenamiento, validación y test. A continuación, visualizaremos cómo
están repartidas las clases en nuestro conjunto de entrenamiento.</p>
</div>
<div id="a916af4d" class="cell code" data-execution_count="13"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:42.326362Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:42.326004Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:42.364702Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:42.363597Z&quot;}"
data-papermill="{&quot;duration&quot;:0.142746,&quot;end_time&quot;:&quot;2023-01-11T16:05:42.367381&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:42.224635&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb18"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>train_images_names <span class="op">=</span> pd.Series(train_images)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>train_df <span class="op">=</span> pd.DataFrame()</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">&#39;Filename&#39;</span>] <span class="op">=</span> train_images_names.<span class="bu">map</span>( <span class="kw">lambda</span> img_name: img_name.split(<span class="st">&quot;/&quot;</span>)[<span class="op">-</span><span class="dv">1</span>])</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>train_df[<span class="st">&#39;ClassId&#39;</span>] <span class="op">=</span> train_images_names.<span class="bu">map</span>(<span class="kw">lambda</span> img_name: img_name.split(<span class="st">&quot;/&quot;</span>)[<span class="op">-</span><span class="dv">2</span>])</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>train_df.head()</span></code></pre></div>
<div class="output execute_result" data-execution_count="13">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Filename</th>
      <th>ClassId</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>OIP-nopyaGynaYjNqHjVELwZAgHaFv.jpeg</td>
      <td>mucca</td>
    </tr>
    <tr>
      <th>1</th>
      <td>OIP-Z1wg0mi5S0PZuD0W6OSaiAHaEg.jpeg</td>
      <td>mucca</td>
    </tr>
    <tr>
      <th>2</th>
      <td>OIP-J5WeSbxIwYLyTnte4wszgwHaEF.jpeg</td>
      <td>mucca</td>
    </tr>
    <tr>
      <th>3</th>
      <td>OIP-xMwo9fBfITdttwcoOm9b4gEsDI.jpeg</td>
      <td>mucca</td>
    </tr>
    <tr>
      <th>4</th>
      <td>OIP-GQ5uYUFIs6mi9CnnoTD2cgHaFl.jpeg</td>
      <td>mucca</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="d3e22c7c" class="cell code" data-execution_count="14"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:42.566823Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:42.566492Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:42.577762Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:42.576888Z&quot;}"
data-papermill="{&quot;duration&quot;:0.112342,&quot;end_time&quot;:&quot;2023-01-11T16:05:42.579756&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:42.467414&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb19"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>class_distribution <span class="op">=</span> train_df[<span class="st">&#39;ClassId&#39;</span>].value_counts()</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>class_distribution.head(<span class="dv">10</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="14">
<pre><code>cane          3890
ragno         3600
gallina       2478
cavallo       2098
mucca         1492
scoiattolo    1489
farfalla      1324
pecora        1155
gatto          984
elefante       856
Name: ClassId, dtype: int64</code></pre>
</div>
</div>
<div id="85f7d4a3" class="cell markdown"
data-papermill="{&quot;duration&quot;:9.7209e-2,&quot;end_time&quot;:&quot;2023-01-11T16:05:42.774565&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:42.677356&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar cómo el conjunto de datos está desbalanceado, si nos
fijamos bien la clase mayoritaría cane (perro) tiene una presencia de
más de 4 veces a la que tiene elefante. Esto es muy importante tenerlo
en cuenta dado que nuestro modelo se puede ver afectado, tendremos que
conseguir que nuestro modelo generalice muy bien y consiga sacar
patrones diferenciales.</p>
</div>
<div id="f4b23b24" class="cell code" data-execution_count="15"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:42.973187Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:42.972812Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:42.987637Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:42.986683Z&quot;}"
data-papermill="{&quot;duration&quot;:0.119428,&quot;end_time&quot;:&quot;2023-01-11T16:05:42.989679&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:42.870251&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb21"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>fig <span class="op">=</span> go.Figure(go.Bar(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>class_distribution.values,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>            y<span class="op">=</span>class_distribution.index,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>            orientation<span class="op">=</span><span class="st">&#39;h&#39;</span>))</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title<span class="op">=</span><span class="st">&#39;Distribución de clases en el conjunto de entrenamiento&#39;</span>,font_size<span class="op">=</span><span class="dv">15</span>,title_x<span class="op">=</span><span class="fl">0.45</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
<div class="output display_data">
<div>                            <div id="262165fb-fc63-4094-b815-d985c373f92d" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("262165fb-fc63-4094-b815-d985c373f92d")) {                    Plotly.newPlot(                        "262165fb-fc63-4094-b815-d985c373f92d",                        [{"orientation":"h","x":[3890,3600,2478,2098,1492,1489,1324,1155,984,856],"y":["cane","ragno","gallina","cavallo","mucca","scoiattolo","farfalla","pecora","gatto","elefante"],"type":"bar"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"font":{"size":15},"title":{"text":"Distribución de clases en el conjunto de entrenamiento","x":0.45}},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('262165fb-fc63-4094-b815-d985c373f92d');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="89afe0ee" class="cell markdown"
data-papermill="{&quot;duration&quot;:9.6917e-2,&quot;end_time&quot;:&quot;2023-01-11T16:05:43.183556&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:43.086639&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar gráficamente de una forma más visual cómo se ve la
muestra desbalanceada.</p>
</div>
<div id="eb735ac0" class="cell code" data-execution_count="16"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:43.439917Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:43.439333Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:43.508221Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:43.507351Z&quot;}"
data-papermill="{&quot;duration&quot;:0.231021,&quot;end_time&quot;:&quot;2023-01-11T16:05:43.510749&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:43.279728&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb22"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fig<span class="op">=</span>px.pie(class_distribution.head(<span class="dv">10</span>),values<span class="op">=</span> <span class="st">&#39;ClassId&#39;</span>, names<span class="op">=</span>train_df[<span class="st">&#39;ClassId&#39;</span>].unique(),hole<span class="op">=</span><span class="fl">0.425</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>fig.update_layout(title<span class="op">=</span><span class="st">&#39;Distribución de clases en el conjunto de entrenamiento&#39;</span>,font_size<span class="op">=</span><span class="dv">15</span>,title_x<span class="op">=</span><span class="fl">0.45</span>,annotations<span class="op">=</span>[<span class="bu">dict</span>(text<span class="op">=</span><span class="st">&#39;Animas-10&#39;</span>,font_size<span class="op">=</span><span class="dv">18</span>, showarrow<span class="op">=</span><span class="va">False</span>,height<span class="op">=</span><span class="dv">800</span>,width<span class="op">=</span><span class="dv">700</span>)])</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>fig.update_traces(textfont_size<span class="op">=</span><span class="dv">15</span>,textinfo<span class="op">=</span><span class="st">&#39;percent&#39;</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>fig.show()</span></code></pre></div>
<div class="output display_data">
<div>                            <div id="aa2a46ce-b35c-46fa-8e25-0e32ec14f51d" class="plotly-graph-div" style="height:525px; width:100%;"></div>            <script type="text/javascript">                require(["plotly"], function(Plotly) {                    window.PLOTLYENV=window.PLOTLYENV || {};                                    if (document.getElementById("aa2a46ce-b35c-46fa-8e25-0e32ec14f51d")) {                    Plotly.newPlot(                        "aa2a46ce-b35c-46fa-8e25-0e32ec14f51d",                        [{"domain":{"x":[0.0,1.0],"y":[0.0,1.0]},"hole":0.425,"hovertemplate":"label=%{label}<br>ClassId=%{value}<extra></extra>","labels":["mucca","pecora","ragno","cavallo","gallina","scoiattolo","farfalla","gatto","elefante","cane"],"legendgroup":"","name":"","showlegend":true,"values":[3890,3600,2478,2098,1492,1489,1324,1155,984,856],"type":"pie","textfont":{"size":15},"textinfo":"percent"}],                        {"template":{"data":{"histogram2dcontour":[{"type":"histogram2dcontour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"choropleth":[{"type":"choropleth","colorbar":{"outlinewidth":0,"ticks":""}}],"histogram2d":[{"type":"histogram2d","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmap":[{"type":"heatmap","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"heatmapgl":[{"type":"heatmapgl","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"contourcarpet":[{"type":"contourcarpet","colorbar":{"outlinewidth":0,"ticks":""}}],"contour":[{"type":"contour","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"surface":[{"type":"surface","colorbar":{"outlinewidth":0,"ticks":""},"colorscale":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]]}],"mesh3d":[{"type":"mesh3d","colorbar":{"outlinewidth":0,"ticks":""}}],"scatter":[{"fillpattern":{"fillmode":"overlay","size":10,"solidity":0.2},"type":"scatter"}],"parcoords":[{"type":"parcoords","line":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolargl":[{"type":"scatterpolargl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"bar":[{"error_x":{"color":"#2a3f5f"},"error_y":{"color":"#2a3f5f"},"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"bar"}],"scattergeo":[{"type":"scattergeo","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterpolar":[{"type":"scatterpolar","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"histogram":[{"marker":{"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"histogram"}],"scattergl":[{"type":"scattergl","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatter3d":[{"type":"scatter3d","line":{"colorbar":{"outlinewidth":0,"ticks":""}},"marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattermapbox":[{"type":"scattermapbox","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scatterternary":[{"type":"scatterternary","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"scattercarpet":[{"type":"scattercarpet","marker":{"colorbar":{"outlinewidth":0,"ticks":""}}}],"carpet":[{"aaxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"baxis":{"endlinecolor":"#2a3f5f","gridcolor":"white","linecolor":"white","minorgridcolor":"white","startlinecolor":"#2a3f5f"},"type":"carpet"}],"table":[{"cells":{"fill":{"color":"#EBF0F8"},"line":{"color":"white"}},"header":{"fill":{"color":"#C8D4E3"},"line":{"color":"white"}},"type":"table"}],"barpolar":[{"marker":{"line":{"color":"#E5ECF6","width":0.5},"pattern":{"fillmode":"overlay","size":10,"solidity":0.2}},"type":"barpolar"}],"pie":[{"automargin":true,"type":"pie"}]},"layout":{"autotypenumbers":"strict","colorway":["#636efa","#EF553B","#00cc96","#ab63fa","#FFA15A","#19d3f3","#FF6692","#B6E880","#FF97FF","#FECB52"],"font":{"color":"#2a3f5f"},"hovermode":"closest","hoverlabel":{"align":"left"},"paper_bgcolor":"white","plot_bgcolor":"#E5ECF6","polar":{"bgcolor":"#E5ECF6","angularaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"radialaxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"ternary":{"bgcolor":"#E5ECF6","aaxis":{"gridcolor":"white","linecolor":"white","ticks":""},"baxis":{"gridcolor":"white","linecolor":"white","ticks":""},"caxis":{"gridcolor":"white","linecolor":"white","ticks":""}},"coloraxis":{"colorbar":{"outlinewidth":0,"ticks":""}},"colorscale":{"sequential":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"sequentialminus":[[0.0,"#0d0887"],[0.1111111111111111,"#46039f"],[0.2222222222222222,"#7201a8"],[0.3333333333333333,"#9c179e"],[0.4444444444444444,"#bd3786"],[0.5555555555555556,"#d8576b"],[0.6666666666666666,"#ed7953"],[0.7777777777777778,"#fb9f3a"],[0.8888888888888888,"#fdca26"],[1.0,"#f0f921"]],"diverging":[[0,"#8e0152"],[0.1,"#c51b7d"],[0.2,"#de77ae"],[0.3,"#f1b6da"],[0.4,"#fde0ef"],[0.5,"#f7f7f7"],[0.6,"#e6f5d0"],[0.7,"#b8e186"],[0.8,"#7fbc41"],[0.9,"#4d9221"],[1,"#276419"]]},"xaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"yaxis":{"gridcolor":"white","linecolor":"white","ticks":"","title":{"standoff":15},"zerolinecolor":"white","automargin":true,"zerolinewidth":2},"scene":{"xaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"yaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2},"zaxis":{"backgroundcolor":"#E5ECF6","gridcolor":"white","linecolor":"white","showbackground":true,"ticks":"","zerolinecolor":"white","gridwidth":2}},"shapedefaults":{"line":{"color":"#2a3f5f"}},"annotationdefaults":{"arrowcolor":"#2a3f5f","arrowhead":0,"arrowwidth":1},"geo":{"bgcolor":"white","landcolor":"#E5ECF6","subunitcolor":"white","showland":true,"showlakes":true,"lakecolor":"white"},"title":{"x":0.05},"mapbox":{"style":"light"}}},"legend":{"tracegroupgap":0},"margin":{"t":60},"font":{"size":15},"title":{"text":"Distribución de clases en el conjunto de entrenamiento","x":0.45},"annotations":[{"height":800,"showarrow":false,"text":"Animas-10","width":700,"font":{"size":18}}]},                        {"responsive": true}                    ).then(function(){
                            
var gd = document.getElementById('aa2a46ce-b35c-46fa-8e25-0e32ec14f51d');
var x = new MutationObserver(function (mutations, observer) {{
        var display = window.getComputedStyle(gd).display;
        if (!display || display === 'none') {{
            console.log([gd, 'removed!']);
            Plotly.purge(gd);
            observer.disconnect();
        }}
}});

// Listen for the removal of the full notebook cells
var notebookContainer = gd.closest('#notebook-container');
if (notebookContainer) {{
    x.observe(notebookContainer, {childList: true});
}}

// Listen for the clearing of the current output cell
var outputEl = gd.closest('.output');
if (outputEl) {{
    x.observe(outputEl, {childList: true});
}}

                        })                };                });            </script>        </div>
</div>
</div>
<div id="16c6c711" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.144873,&quot;end_time&quot;:&quot;2023-01-11T16:05:43.802683&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:43.657810&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>A continuación, vamos a ver cómo se compone el conjunto de
entrenamiento visualizando una serie de imágenes.</p>
</div>
<div id="62654e52" class="cell code" data-execution_count="17"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:44.074358Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:44.073989Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:45.135016Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:45.134108Z&quot;}"
data-papermill="{&quot;duration&quot;:1.169375,&quot;end_time&quot;:&quot;2023-01-11T16:05:45.144896&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:43.975521&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb23"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>images <span class="op">=</span> train_df.sample(<span class="dv">12</span>).reset_index()</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">15</span>, <span class="dv">15</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">12</span>):</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    img_name <span class="op">=</span> images.loc[i, <span class="st">&#39;Filename&#39;</span>]</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    label_str <span class="op">=</span> (images.loc[i, <span class="st">&#39;ClassId&#39;</span>])</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    plt.subplot(<span class="dv">4</span>,<span class="dv">4</span>,i<span class="op">+</span><span class="dv">1</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>    plt.imshow(plt.imread(os.path.join(train_path,label_str, img_name)))</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    plt.title(label_str)</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    plt.xticks([])</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    plt.yticks([])</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    plt.yticks([])</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/379bea7543100db333f7d1d50c7368fee05c664e.png" /></p>
</div>
</div>
<div id="c80d09ac" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.112189,&quot;end_time&quot;:&quot;2023-01-11T16:05:45.370051&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:45.257862&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez terminado con la visualización del conjunto de entrenamiento
podemos concluir con lo siguiente:</p>
<ul>
<li>Nos encontramos ante un problema desbalanceado por lo que tendremos
que tener en cuenta otras métricas de evaluación.</li>
<li>Además, encontramos que para determinadas clases existen pocos datos
como para conseguir un modelo preciso, es por eso que podríamos realizar
un Data Augmentation para obtener una mayor muestra del conjunto de
datos.</li>
</ul>
</div>
<div id="c37dc8d9" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.107923,&quot;end_time&quot;:&quot;2023-01-11T16:05:45.584705&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:45.476782&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<h1 id="3-preprocesamiento-de-los-datos">3. Preprocesamiento de los
datos<a name="preprocesamiento"></a></h1>
<p>En cuanto al preprocesamiento de los datos realizaremos un Data
Augmentation utilizando la herramienta que nos ofrece ya Keras,
utilizando <code>ImageDataGenerator</code>. El objetivo de realizar este
preprocesamiento es conseguir que nuestra posterior red neuronal sea muy
robusta y generalice muy bien consiguiendo así destacar las partes
importantes de cada clase. A continuación, mostraremos un ejemplo de lo
que vamos a realizar.</p>
</div>
<div id="12659188" class="cell code" data-execution_count="18"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:45.800219Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:45.799833Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:47.097731Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:47.096914Z&quot;}"
data-papermill="{&quot;duration&quot;:1.41216,&quot;end_time&quot;:&quot;2023-01-11T16:05:47.103535&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:45.691375&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb24"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.preprocessing.image <span class="im">import</span> ImageDataGenerator, array_to_img, img_to_array, load_img</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>datagen <span class="op">=</span> ImageDataGenerator(zoom_range<span class="op">=</span><span class="fl">0.15</span>,</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>                                   width_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>                                   height_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>                                   shear_range<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>img <span class="op">=</span> load_img(<span class="st">&#39;/kaggle/input/animals10/raw-img/cane/OIF-e2bexWrojgtQnAPPcUfOWQ.jpeg&#39;</span>)  <span class="co"># this is a PIL image</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> img_to_array(img)  <span class="co"># this is a Numpy array with shape (3, 150, 150)</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> x.reshape((<span class="dv">1</span>,) <span class="op">+</span> x.shape)  <span class="co"># this is a Numpy array with shape (1, 3, 150, 150)</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a><span class="co"># iterator</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>aug_iter <span class="op">=</span> datagen.flow(x, batch_size<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="co"># generate samples and plot</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(nrows<span class="op">=</span><span class="dv">1</span>, ncols<span class="op">=</span><span class="dv">4</span>, figsize<span class="op">=</span>(<span class="dv">25</span>,<span class="dv">25</span>))</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].imshow(img)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>ax[<span class="dv">0</span>].set_title(<span class="st">&#39;Original&#39;</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">4</span>):</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># convert to unsigned integers</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> <span class="bu">next</span>(aug_iter)[<span class="dv">0</span>].astype(<span class="st">&#39;uint8&#39;</span>)</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot image</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    ax[i].imshow(image)</span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>    ax[i].axis(<span class="st">&#39;off&#39;</span>)</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    ax[i].set_title(<span class="ss">f&#39;Alteración_</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">&#39;</span>)</span></code></pre></div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/b05c3129fcd78cdbb27cebfc2ce02725ad99bb8a.png" /></p>
</div>
</div>
<div id="3fa95d0f" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.111598,&quot;end_time&quot;:&quot;2023-01-11T16:05:47.329572&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:47.217974&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Cómo podemos observar en las imágenes de muestra el Data Augmentation
se ve puede realizar de varias formas, bien desplazando la imágen
horizontal o verticalmente, bien realizar zoom a la imágen, o bien
realizar una rotación de la imágen respecto de un eje distorsionandola
un poco.</p>
</div>
<div id="c0af6ddf" class="cell code" data-execution_count="19"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:47.555733Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:47.555378Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:49.064966Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:49.063981Z&quot;}"
data-papermill="{&quot;duration&quot;:1.625294,&quot;end_time&quot;:&quot;2023-01-11T16:05:49.067257&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:47.441963&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb25"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>batch_size <span class="op">=</span> <span class="dv">32</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>w <span class="op">=</span> <span class="dv">224</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>h <span class="op">=</span> <span class="dv">224</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>train_datagen <span class="op">=</span> ImageDataGenerator(zoom_range<span class="op">=</span><span class="fl">0.15</span>,</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>                                   width_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>                                   height_shift_range<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>                                   shear_range<span class="op">=</span><span class="fl">0.15</span>)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>test_datagen <span class="op">=</span> ImageDataGenerator()</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>val_datagen <span class="op">=</span> ImageDataGenerator()</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>train_generator <span class="op">=</span> train_datagen.flow_from_directory(train_path,</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>                                                    target_size<span class="op">=</span>(w, h),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>                                                    batch_size<span class="op">=</span>batch_size,</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>                                                    shuffle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>test_generator <span class="op">=</span> test_datagen.flow_from_directory(test_path,</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>                                                  target_size<span class="op">=</span>(w,h),</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>                                                  batch_size<span class="op">=</span>batch_size,</span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>                                                  shuffle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>val_generator <span class="op">=</span> val_datagen.flow_from_directory(val_path,</span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>                                                target_size<span class="op">=</span>(w,h),</span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>                                                batch_size<span class="op">=</span>batch_size,</span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                                                shuffle<span class="op">=</span><span class="va">False</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Found 20938 images belonging to 10 classes.
Found 2627 images belonging to 10 classes.
Found 2614 images belonging to 10 classes.
</code></pre>
</div>
</div>
<div id="4dc869af" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.11136,&quot;end_time&quot;:&quot;2023-01-11T16:05:49.292915&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:49.181555&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Para realizar dichas alteraciones tendremos que establecer los
siguiente valores para ImageDataGenerator:</p>
<ul>
<li><p><strong>zoom_range</strong>: en este caso se utiliza para
realizar zoom a imágenes de forma aleatoria, hemos establecido que el
zoom tenga un rango del 0'15.</p></li>
<li><p><strong>width_shift_range</strong>: rango en el cual se
desplazará la imagen, en este caso será un 20% de la imagen lo máximo
que podrá desplazarse horizontalmente.</p></li>
<li><p><strong>height_shift_range</strong>: en este caso es igual que en
width_shift_range, pero verticalmente.</p></li>
<li><p><strong>shear_range</strong>: se utiliza para distorsionar una
imagen respecto a un eje, el objetivo es dotar a la red de otra
perspectiva de la imagen para que aprenda mejor. En este caso hemos
establecido un rango del 15% en cuánto a dicha rotación respecto de un
eje.</p></li>
</ul>
<p>Podemos observar los índices asociados a las correspondientes
clases.</p>
</div>
<div id="c1f92be4" class="cell code" data-execution_count="20"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:49.520413Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:49.520057Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:49.526579Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:49.525615Z&quot;}"
data-papermill="{&quot;duration&quot;:0.123497,&quot;end_time&quot;:&quot;2023-01-11T16:05:49.528569&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:49.405072&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb27"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>train_generator.class_indices</span></code></pre></div>
<div class="output execute_result" data-execution_count="20">
<pre><code>{&#39;cane&#39;: 0,
 &#39;cavallo&#39;: 1,
 &#39;elefante&#39;: 2,
 &#39;farfalla&#39;: 3,
 &#39;gallina&#39;: 4,
 &#39;gatto&#39;: 5,
 &#39;mucca&#39;: 6,
 &#39;pecora&#39;: 7,
 &#39;ragno&#39;: 8,
 &#39;scoiattolo&#39;: 9}</code></pre>
</div>
</div>
<div id="c4a6ac92" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.112064,&quot;end_time&quot;:&quot;2023-01-11T16:05:49.750626&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:49.638562&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<h1 id="4-diseño-del-modelo">4. Diseño del
modelo<a name="creacion"></a></h1>
<p>Una vez hemos realizado el preprocesamiento a nuestro conjunto de
entrenamiento, es decir el Data Augmentation, es momento de diseñar los
modelos a implementar. Nos encontramos ante dos posibilidades, bien
diseñar una red convolucional de forma manual, o bien importar una red
preentrenada mediante Transfer Learning. Dada estás posibilidades
realizaremos lo siguiente: crearemos dos redes convolucionales de forma
manual y las compararemos con tres redes preentrenadas, una vez
comparadas seleccionaremos los mejores modelos.</p>
<h2 id="41-creación-de-redes-convolucionales">4.1 Creación de Redes
Convolucionales</h2>
<p>En este apartado llevaremos a cabo la creación de dos redes
convolucionales de manera manual, es decir, las crearemos nosotros
mismos. Encontramos dos tipos de redes a crear: redes convolucionales
con grandes filtros o redes convolucionales con filtros pequeños.</p>
<h3 id="411-red-convolucional-con-grandes-filtros">4.1.1 Red
Convolucional con grandes filtros</h3>
<p>La primera idea que llevaremos a cabo es la de implementar una red
convolucional con filtros grandes, es decir con un tamaño de kernel
elevado cómo puede ser 11. Lo que intentamos conseguir con esto es
comprobar si tiene un efecto positivo en la red convolucional a la hora
de clasificar. La representación visual de lo que sería aplicar grandes
filtros se puede ver en la siguiente imagen.</p>
</div>
<div id="a8fee72a" class="cell code" data-execution_count="21"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:49.992290Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:49.991891Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:50.007036Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:50.005879Z&quot;}"
data-papermill="{&quot;duration&quot;:0.131259,&quot;end_time&quot;:&quot;2023-01-11T16:05:50.009303&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:49.878044&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb29"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> Image</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>Image(<span class="st">&#39;../input/modelosvarp/conv_grandes_filtros.jpg&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="21">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/dd326e5dde74bc806a49f218923d06a5b31bb815.jpg" /></p>
</div>
</div>
<div id="9d40952d" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.112684,&quot;end_time&quot;:&quot;2023-01-11T16:05:50.234633&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:50.121949&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Observamos cómo se minimiza la imagen de una forma más rápida, quizás
teniendo en cuenta eso consiga forzar a la red a encontrar patrones
rápidamente consiguiendo diferenciar las clases. Una vez explicado esto,
vamos a realizar el diseño de dicha red convolucional, para ello lo
primero es importar todas las capas de tensorflow necesarias para
realizar la implementación.</p>
</div>
<div id="e16a4a87" class="cell code" data-execution_count="22"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:50.533658Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:50.533301Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:50.539854Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:50.538792Z&quot;}"
data-papermill="{&quot;duration&quot;:0.194472,&quot;end_time&quot;:&quot;2023-01-11T16:05:50.541820&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:50.347348&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb30"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> tensorflow <span class="im">as</span> tf</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow <span class="im">import</span> keras</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras <span class="im">import</span> layers</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.models <span class="im">import</span> Sequential, Model, load_model</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.callbacks <span class="im">import</span> EarlyStopping,ModelCheckpoint</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span> Dense, BatchNormalization, Flatten, Conv2D, MaxPooling2D, Dropout</span></code></pre></div>
</div>
<div id="fed0c88c" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.11008,&quot;end_time&quot;:&quot;2023-01-11T16:05:50.762209&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:50.652129&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Hemos importado las siguientes capas:</p>
<ul>
<li><p>Capa <strong>Dense</strong> para calcular el resultado en las
capas ocultas y proporcionar una salida.</p></li>
<li><p>Capa <strong>Conv2D</strong> encargada de aplicar la convolución
a las imágenes.</p></li>
<li><p>Capa <strong>BatchNormalization</strong> para aplicar una
normalización cada vez que se aplica la convolución.</p></li>
<li><p>Capa <strong>MaxPooling2D</strong> que va reduciendo la
imagen.</p></li>
<li><p>Capa <strong>Flatten</strong> para juntar la imagen en un único
array.</p></li>
<li><p>Capa <strong>Dropout</strong> para forzar a la red a generalizar
mejor.</p></li>
</ul>
<p>Además, de dichas capas también hemos importado dos callbacks:</p>
<ul>
<li><p><strong>EarlyStopping</strong>: encargado reducir la varianza si
el modelo no mejora en la pérdida sobre el conjunto de
validación.</p></li>
<li><p><strong>ModelCheckpoint</strong>: encargado de conservar el
modelo que ofrecio el mejor resultado en el conjunto de
validación.</p></li>
</ul>
</div>
<div id="002db270" class="cell code" data-execution_count="23"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:50.994796Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:50.993860Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:54.075158Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:54.073161Z&quot;}"
data-papermill="{&quot;duration&quot;:3.202526,&quot;end_time&quot;:&quot;2023-01-11T16:05:54.077389&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:50.874863&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb31"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (<span class="dv">224</span>,<span class="dv">224</span>,<span class="dv">3</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>activation <span class="op">=</span> <span class="st">&quot;relu&quot;</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>model_cnn <span class="op">=</span> keras.Sequential([</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">16</span>, kernel_size <span class="op">=</span> <span class="dv">11</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation, input_shape<span class="op">=</span>input_shape),</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">16</span>, kernel_size <span class="op">=</span> <span class="dv">11</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>    keras.layers.MaxPooling2D(<span class="dv">2</span>),</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dropout(<span class="fl">0.2</span>),</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">16</span>, kernel_size <span class="op">=</span> <span class="dv">11</span>, strides<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="st">&quot;same&quot;</span>, activation<span class="op">=</span>activation),</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">32</span>, kernel_size <span class="op">=</span> <span class="dv">13</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">64</span>, kernel_size <span class="op">=</span> <span class="dv">13</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    keras.layers.MaxPooling2D(<span class="dv">2</span>),</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dropout(<span class="fl">0.2</span>),</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">128</span>, kernel_size <span class="op">=</span> <span class="dv">13</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dropout(<span class="fl">0.2</span>),</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    keras.layers.Flatten(),</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dense(<span class="dv">256</span>, activation<span class="op">=</span>activation),</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dropout(<span class="fl">0.4</span>),</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">10</span>, activation <span class="op">=</span> <span class="st">&quot;softmax&quot;</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>model_cnn.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;categorical_crossentropy&quot;</span>, optimizer <span class="op">=</span> <span class="st">&quot;adam&quot;</span>, metrics <span class="op">=</span> <span class="st">&quot;AUC&quot;</span>)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a>model_cnn.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;sequential&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d (Conv2D)              (None, 214, 214, 16)      5824      
_________________________________________________________________
batch_normalization (BatchNo (None, 214, 214, 16)      64        
_________________________________________________________________
conv2d_1 (Conv2D)            (None, 204, 204, 16)      30992     
_________________________________________________________________
batch_normalization_1 (Batch (None, 204, 204, 16)      64        
_________________________________________________________________
max_pooling2d (MaxPooling2D) (None, 102, 102, 16)      0         
_________________________________________________________________
dropout (Dropout)            (None, 102, 102, 16)      0         
_________________________________________________________________
conv2d_2 (Conv2D)            (None, 102, 102, 16)      30992     
_________________________________________________________________
batch_normalization_2 (Batch (None, 102, 102, 16)      64        
_________________________________________________________________
conv2d_3 (Conv2D)            (None, 90, 90, 32)        86560     
_________________________________________________________________
batch_normalization_3 (Batch (None, 90, 90, 32)        128       
_________________________________________________________________
conv2d_4 (Conv2D)            (None, 78, 78, 64)        346176    
_________________________________________________________________
batch_normalization_4 (Batch (None, 78, 78, 64)        256       
_________________________________________________________________
max_pooling2d_1 (MaxPooling2 (None, 39, 39, 64)        0         
_________________________________________________________________
dropout_1 (Dropout)          (None, 39, 39, 64)        0         
_________________________________________________________________
conv2d_5 (Conv2D)            (None, 27, 27, 128)       1384576   
_________________________________________________________________
batch_normalization_5 (Batch (None, 27, 27, 128)       512       
_________________________________________________________________
dropout_2 (Dropout)          (None, 27, 27, 128)       0         
_________________________________________________________________
flatten (Flatten)            (None, 93312)             0         
_________________________________________________________________
dense (Dense)                (None, 256)               23888128  
_________________________________________________________________
dropout_3 (Dropout)          (None, 256)               0         
_________________________________________________________________
dense_1 (Dense)              (None, 10)                2570      
=================================================================
Total params: 25,776,906
Trainable params: 25,776,362
Non-trainable params: 544
_________________________________________________________________
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>2023-01-11 16:05:51.043819: I tensorflow/core/platform/cpu_feature_guard.cc:142] This TensorFlow binary is optimized with oneAPI Deep Neural Network Library (oneDNN) to use the following CPU instructions in performance-critical operations:  AVX2 AVX512F FMA
To enable them in other operations, rebuild TensorFlow with the appropriate compiler flags.
2023-01-11 16:05:51.044259: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:05:51.045140: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:05:51.045780: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:05:53.538779: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:05:53.539643: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:05:53.540376: I tensorflow/stream_executor/cuda/cuda_gpu_executor.cc:937] successful NUMA node read from SysFS had negative value (-1), but there must be at least one NUMA node, so returning NUMA node zero
2023-01-11 16:05:53.540996: I tensorflow/core/common_runtime/gpu/gpu_device.cc:1510] Created device /job:localhost/replica:0/task:0/device:GPU:0 with 15381 MB memory:  -&gt; device: 0, name: Tesla P100-PCIE-16GB, pci bus id: 0000:00:04.0, compute capability: 6.0
</code></pre>
</div>
</div>
<div id="bcf301f6" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.11152,&quot;end_time&quot;:&quot;2023-01-11T16:05:54.302579&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:54.191059&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Cómo podemos observar hemos establecido las siguientes medidas para
los apartados de pérdida, optimizador y métrica:</p>
<ul>
<li><p><strong>Categorical Crossentropy</strong>: calcula la pérdida con
la entropía cruzada.</p></li>
<li><p><strong>Adam</strong>: una combinación lineal entre el gradiente
y el incremento anterior, y considera los gradientes recientemente
aparecidos en las actualizaciones para mantener diferentes tasas de
aprendizaje por variable.</p></li>
<li><p><strong>AUC</strong>: métrica que evalua la tasa de verdaderos
positivos con la tasa de falsos positivos, métrica que utilizaremos dado
que se usa en conjuntos de datos desbalanceados al tener en cuenta los
falsos positivos.</p></li>
</ul>
<p>A continuación, crearemos una lista con los callbacks que
utilizaremos a lo largo de las implementaciones de los distintos
modelos.</p>
</div>
<div id="bc46b528" class="cell code" data-execution_count="24"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:54.696727Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:54.696135Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T16:05:54.702113Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T16:05:54.701292Z&quot;}"
data-papermill="{&quot;duration&quot;:0.186759,&quot;end_time&quot;:&quot;2023-01-11T16:05:54.706320&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:54.519561&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb34"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cbs <span class="op">=</span> [</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>    ModelCheckpoint(filepath <span class="op">=</span> <span class="st">&quot;modelo.h5&quot;</span>,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                   monitor <span class="op">=</span> <span class="st">&quot;val_loss&quot;</span>,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                   save_best_only <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                   save_weights_only<span class="op">=</span><span class="va">True</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    EarlyStopping(monitor<span class="op">=</span><span class="st">&#39;val_loss&#39;</span>,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>                    min_delta<span class="op">=</span><span class="fl">0.0002</span>,</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                    patience<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>]</span></code></pre></div>
</div>
<div id="cc1acef3" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.127371,&quot;end_time&quot;:&quot;2023-01-11T16:05:55.002746&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:54.875375&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos todo listo procedemos al entrenamiento de nuestro
modelo, ejecutaremos 100 epochs dado que el EarlyStopping parará antes
el entrenamiento.</p>
</div>
<div id="f2cf7b1b" class="cell code" data-execution_count="25"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T16:05:55.226919Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T16:05:55.226527Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T17:03:54.246264Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T17:03:54.245255Z&quot;}"
data-papermill="{&quot;duration&quot;:3479.133905,&quot;end_time&quot;:&quot;2023-01-11T17:03:54.248743&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T16:05:55.114838&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb35"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>history_cnn <span class="op">=</span> model_cnn.fit(train_generator,validation_data<span class="op">=</span>val_generator,epochs<span class="op">=</span><span class="dv">100</span>,verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>cbs)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>2023-01-11 16:05:55.683490: I tensorflow/compiler/mlir/mlir_graph_optimization_pass.cc:185] None of the MLIR Optimization Passes are enabled (registered 2)
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
</code></pre>
</div>
<div class="output stream stderr">
<pre><code>2023-01-11 16:05:57.955805: I tensorflow/stream_executor/cuda/cuda_dnn.cc:369] Loaded cuDNN version 8005
</code></pre>
</div>
<div class="output stream stdout">
<pre><code>655/655 [==============================] - 286s 420ms/step - loss: 19.9186 - auc: 0.5640 - val_loss: 4.3230 - val_auc: 0.6058
Epoch 2/100
655/655 [==============================] - 275s 420ms/step - loss: 2.2178 - auc: 0.6351 - val_loss: 3.3841 - val_auc: 0.6478
Epoch 3/100
655/655 [==============================] - 278s 424ms/step - loss: 2.1914 - auc: 0.6424 - val_loss: 3.2959 - val_auc: 0.6385
Epoch 4/100
655/655 [==============================] - 281s 429ms/step - loss: 2.2171 - auc: 0.6375 - val_loss: 3.0489 - val_auc: 0.6445
Epoch 5/100
655/655 [==============================] - 278s 423ms/step - loss: 2.1961 - auc: 0.6396 - val_loss: 2.9499 - val_auc: 0.6470
Epoch 6/100
655/655 [==============================] - 283s 432ms/step - loss: 2.2018 - auc: 0.6376 - val_loss: 3.0580 - val_auc: 0.6524
Epoch 7/100
655/655 [==============================] - 285s 435ms/step - loss: 2.1869 - auc: 0.6404 - val_loss: 2.6172 - val_auc: 0.6450
Epoch 8/100
655/655 [==============================] - 278s 425ms/step - loss: 2.1881 - auc: 0.6399 - val_loss: 3.0163 - val_auc: 0.6514
Epoch 9/100
655/655 [==============================] - 281s 428ms/step - loss: 2.1814 - auc: 0.6425 - val_loss: 3.2252 - val_auc: 0.6424
Epoch 10/100
655/655 [==============================] - 281s 429ms/step - loss: 2.1823 - auc: 0.6424 - val_loss: 3.0806 - val_auc: 0.6082
Epoch 11/100
655/655 [==============================] - 275s 420ms/step - loss: 2.2111 - auc: 0.6370 - val_loss: 3.1108 - val_auc: 0.6307
Epoch 12/100
655/655 [==============================] - 276s 422ms/step - loss: 2.2079 - auc: 0.6305 - val_loss: 3.0287 - val_auc: 0.6306
</code></pre>
</div>
</div>
<div id="d60928f0" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.515949,&quot;end_time&quot;:&quot;2023-01-11T17:03:55.338623&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:03:54.822674&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Cómo podemos observar nuestro modelo a terminado antes el
entrenamiento dado que no ha conseguido una mejora de pérdida en el
conjunto de validación. Si observamos el resultado obtenido sobre el
conjunto de validación nos encontramos que el mejor resultado es
<code>0.6324</code>, un resultado bastante bajo y que nos indica de que
nuestro modelo no es bueno para el problema.</p>
</div>
<div id="6d5a2601" class="cell code" data-execution_count="26"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T17:03:56.437557Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T17:03:56.437161Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T17:04:40.507692Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T17:04:40.506739Z&quot;}"
data-papermill="{&quot;duration&quot;:44.841348,&quot;end_time&quot;:&quot;2023-01-11T17:04:40.757740&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:03:55.916392&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb40"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> np.mean(history_cnn.history[<span class="st">&#39;val_auc&#39;</span>])</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> np.mean(history_cnn.history[<span class="st">&#39;val_loss&#39;</span>])</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> np.mean(history_cnn.history[<span class="st">&#39;auc&#39;</span>])</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> np.mean(history_cnn.history[<span class="st">&#39;loss&#39;</span>])</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&quot;ggplot&quot;</span>)</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn.history[<span class="st">&#39;val_loss&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn.history[<span class="st">&#39;loss&#39;</span>], marker <span class="op">=</span> <span class="st">&#39;o&#39;</span>)</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_loss&quot;</span>, <span class="st">&quot;loss&quot;</span>])</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Losses</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_loss<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Loss&quot;</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn.history[<span class="st">&#39;val_auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn.history[<span class="st">&#39;auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_auc&quot;</span>, <span class="st">&quot;auc&quot;</span>])</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;AUCs</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_acc<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>acc<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;AUC&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="26">
<pre><code>Text(0, 0.5, &#39;AUC&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/d1c765857d9703d24c1dbdf842831722e1dce861.png" /></p>
</div>
</div>
<div id="9b4cbcfc" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.519086,&quot;end_time&quot;:&quot;2023-01-11T17:04:41.857516&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:04:41.338430&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar cómo al principio del entrenamiento encontramos cómo
hay mucho sesgo y mucha varianza con el conjunto de validación. Conforme
avanza el entrenamiento converge hacia un mismo punto eliminando la
varianza, pero manteniendo un mínimo de sesgo.</p>
<h3 id="412-red-convolucional-con-filtros-pequeños">4.1.2 Red
Convolucional con filtros pequeños</h3>
<p>La segunda idea que llevaremos a cabo es la de implementar una red
convolucional con filtros pequeños, es decir con un tamaño de kernel
reducido cómo puede ser 3. Lo que intentamos conseguir con esto es
comprobar si tiene un efecto positivo en la red convolucional a la hora
de clasificar. La representación visual de lo que sería aplicar filtros
pequeños se puede ver en la siguiente imagen.</p>
</div>
<div id="cbb126ff" class="cell code" data-execution_count="27"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T17:04:42.947963Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T17:04:42.947584Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T17:04:42.968942Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T17:04:42.968014Z&quot;}"
data-papermill="{&quot;duration&quot;:0.599906,&quot;end_time&quot;:&quot;2023-01-11T17:04:42.971114&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:04:42.371208&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb42"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>Image(<span class="st">&#39;../input/modelosvarp/conv_pequenos_filtros.jpg&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="27">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/e605e096d5e4966ac653cc943abe8acb16d5cd0e.jpg" /></p>
</div>
</div>
<div id="1f215862" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.697684,&quot;end_time&quot;:&quot;2023-01-11T17:04:44.182950&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:04:43.485266&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Cómo podemos apreciar en la imagen el concepto que hay detrás de
utilizar filtros pequeños es el de alterar la imagen de una forma más
pausada a cómo se realizaría en el modelo anterior. En este caso no
utilizaremos las capas de MaxPooling2D para ver si afecta positivamente
la reducción de difuminación ocasianda por esta capa. El objetivo de
este modelo es obtener un mejor resultado que en el que utilizamos
filtros grandes.</p>
</div>
<div id="10cf5991" class="cell code" data-execution_count="28"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T17:04:45.720914Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T17:04:45.720484Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T17:04:45.948647Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T17:04:45.946351Z&quot;}"
data-papermill="{&quot;duration&quot;:0.929251,&quot;end_time&quot;:&quot;2023-01-11T17:04:45.953069&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:04:45.023818&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb43"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>input_shape <span class="op">=</span> (<span class="dv">224</span>,<span class="dv">224</span>,<span class="dv">3</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>activation <span class="op">=</span> <span class="st">&quot;relu&quot;</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>model_cnn_small <span class="op">=</span> keras.Sequential([</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">16</span>, kernel_size <span class="op">=</span> <span class="dv">7</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation, input_shape<span class="op">=</span>input_shape),</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">16</span>, kernel_size <span class="op">=</span> <span class="dv">3</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">16</span>, kernel_size <span class="op">=</span> <span class="dv">3</span>, strides<span class="op">=</span><span class="dv">1</span>, padding<span class="op">=</span><span class="st">&quot;same&quot;</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">32</span>, kernel_size <span class="op">=</span> <span class="dv">3</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">32</span>, kernel_size <span class="op">=</span> <span class="dv">3</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">64</span>, kernel_size <span class="op">=</span> <span class="dv">5</span>, strides<span class="op">=</span><span class="dv">1</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">128</span>, kernel_size <span class="op">=</span> <span class="dv">5</span>, strides<span class="op">=</span><span class="dv">3</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>    keras.layers.Conv2D(filters <span class="op">=</span> <span class="dv">128</span>, kernel_size <span class="op">=</span> <span class="dv">3</span>, strides<span class="op">=</span><span class="dv">3</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a>    keras.layers.BatchNormalization(),</span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dropout(<span class="fl">0.2</span>),</span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>    keras.layers.Flatten(),</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dense(<span class="dv">256</span>, activation<span class="op">=</span>activation),</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>    keras.layers.Dropout(<span class="fl">0.4</span>),</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>    Dense(<span class="dv">10</span>, activation <span class="op">=</span> <span class="st">&quot;softmax&quot;</span>)</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>])</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>model_cnn_small.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;categorical_crossentropy&quot;</span>, optimizer <span class="op">=</span> <span class="st">&quot;adam&quot;</span>, metrics <span class="op">=</span> <span class="st">&quot;AUC&quot;</span>)</span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>model_cnn_small.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;sequential_1&quot;
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
conv2d_6 (Conv2D)            (None, 218, 218, 16)      2368      
_________________________________________________________________
batch_normalization_6 (Batch (None, 218, 218, 16)      64        
_________________________________________________________________
conv2d_7 (Conv2D)            (None, 216, 216, 16)      2320      
_________________________________________________________________
batch_normalization_7 (Batch (None, 216, 216, 16)      64        
_________________________________________________________________
conv2d_8 (Conv2D)            (None, 216, 216, 16)      2320      
_________________________________________________________________
batch_normalization_8 (Batch (None, 216, 216, 16)      64        
_________________________________________________________________
conv2d_9 (Conv2D)            (None, 214, 214, 32)      4640      
_________________________________________________________________
batch_normalization_9 (Batch (None, 214, 214, 32)      128       
_________________________________________________________________
conv2d_10 (Conv2D)           (None, 212, 212, 32)      9248      
_________________________________________________________________
batch_normalization_10 (Batc (None, 212, 212, 32)      128       
_________________________________________________________________
conv2d_11 (Conv2D)           (None, 208, 208, 64)      51264     
_________________________________________________________________
batch_normalization_11 (Batc (None, 208, 208, 64)      256       
_________________________________________________________________
conv2d_12 (Conv2D)           (None, 68, 68, 128)       204928    
_________________________________________________________________
batch_normalization_12 (Batc (None, 68, 68, 128)       512       
_________________________________________________________________
conv2d_13 (Conv2D)           (None, 22, 22, 128)       147584    
_________________________________________________________________
batch_normalization_13 (Batc (None, 22, 22, 128)       512       
_________________________________________________________________
dropout_4 (Dropout)          (None, 22, 22, 128)       0         
_________________________________________________________________
flatten_1 (Flatten)          (None, 61952)             0         
_________________________________________________________________
dense_2 (Dense)              (None, 256)               15859968  
_________________________________________________________________
dropout_5 (Dropout)          (None, 256)               0         
_________________________________________________________________
dense_3 (Dense)              (None, 10)                2570      
=================================================================
Total params: 16,288,938
Trainable params: 16,288,074
Non-trainable params: 864
_________________________________________________________________
</code></pre>
</div>
</div>
<div id="383debc6" class="cell markdown"
data-papermill="{&quot;duration&quot;:0.582157,&quot;end_time&quot;:&quot;2023-01-11T17:04:47.086578&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:04:46.504421&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>En cuanto a la métrica de pérdida, optimización y evaluación se
utilizarán las mismas que en el modelo anterior. En cuanto a los
parámetros del entrenamiento se utilizarán también los mismos.</p>
</div>
<div id="bf5bebf5" class="cell code" data-execution_count="29"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T17:04:48.177638Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T17:04:48.177267Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T18:50:13.748272Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T18:50:13.747269Z&quot;}"
data-papermill="{&quot;duration&quot;:6327.451659,&quot;end_time&quot;:&quot;2023-01-11T18:50:15.052156&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T17:04:47.600497&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb45"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>history_cnn_small <span class="op">=</span> model_cnn_small.fit(train_generator,validation_data<span class="op">=</span>val_generator,epochs<span class="op">=</span><span class="dv">100</span>,verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>cbs)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
655/655 [==============================] - 301s 454ms/step - loss: 3.4088 - auc: 0.6063 - val_loss: 2.2110 - val_auc: 0.6815
Epoch 2/100
655/655 [==============================] - 300s 458ms/step - loss: 2.1518 - auc: 0.6740 - val_loss: 2.5128 - val_auc: 0.6970
Epoch 3/100
655/655 [==============================] - 297s 454ms/step - loss: 2.0831 - auc: 0.7056 - val_loss: 1.9901 - val_auc: 0.7691
Epoch 4/100
655/655 [==============================] - 300s 458ms/step - loss: 1.9894 - auc: 0.7427 - val_loss: 2.1194 - val_auc: 0.7402
Epoch 5/100
655/655 [==============================] - 294s 449ms/step - loss: 1.9308 - auc: 0.7616 - val_loss: 1.8476 - val_auc: 0.7924
Epoch 6/100
655/655 [==============================] - 295s 450ms/step - loss: 1.8949 - auc: 0.7721 - val_loss: 1.9656 - val_auc: 0.7638
Epoch 7/100
655/655 [==============================] - 295s 450ms/step - loss: 1.8704 - auc: 0.7804 - val_loss: 2.5253 - val_auc: 0.7167
Epoch 8/100
655/655 [==============================] - 296s 452ms/step - loss: 1.8339 - auc: 0.7907 - val_loss: 1.6130 - val_auc: 0.8511
Epoch 9/100
655/655 [==============================] - 294s 449ms/step - loss: 1.8030 - auc: 0.7974 - val_loss: 1.8459 - val_auc: 0.8029
Epoch 10/100
655/655 [==============================] - 295s 450ms/step - loss: 1.7739 - auc: 0.8060 - val_loss: 1.5613 - val_auc: 0.8682
Epoch 11/100
655/655 [==============================] - 296s 452ms/step - loss: 1.7294 - auc: 0.8163 - val_loss: 1.5557 - val_auc: 0.8599
Epoch 12/100
655/655 [==============================] - 296s 452ms/step - loss: 1.7041 - auc: 0.8238 - val_loss: 1.7581 - val_auc: 0.8235
Epoch 13/100
655/655 [==============================] - 295s 450ms/step - loss: 1.6916 - auc: 0.8256 - val_loss: 1.4732 - val_auc: 0.8738
Epoch 14/100
655/655 [==============================] - 298s 454ms/step - loss: 1.6588 - auc: 0.8348 - val_loss: 1.4162 - val_auc: 0.8843
Epoch 15/100
655/655 [==============================] - 299s 456ms/step - loss: 1.6361 - auc: 0.8399 - val_loss: 1.4291 - val_auc: 0.8853
Epoch 16/100
655/655 [==============================] - 299s 457ms/step - loss: 1.6365 - auc: 0.8398 - val_loss: 1.3941 - val_auc: 0.8897
Epoch 17/100
655/655 [==============================] - 297s 453ms/step - loss: 1.5983 - auc: 0.8486 - val_loss: 1.3970 - val_auc: 0.8880
Epoch 18/100
655/655 [==============================] - 300s 458ms/step - loss: 1.5941 - auc: 0.8503 - val_loss: 1.4947 - val_auc: 0.8763
Epoch 19/100
655/655 [==============================] - 301s 459ms/step - loss: 1.5649 - auc: 0.8554 - val_loss: 1.8505 - val_auc: 0.8349
Epoch 20/100
655/655 [==============================] - 301s 460ms/step - loss: 1.5506 - auc: 0.8577 - val_loss: 1.5671 - val_auc: 0.8642
Epoch 21/100
655/655 [==============================] - 299s 456ms/step - loss: 1.5271 - auc: 0.8633 - val_loss: 1.7919 - val_auc: 0.8786
</code></pre>
</div>
</div>
<div id="1047e7e6" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.329421,&quot;end_time&quot;:&quot;2023-01-11T18:50:17.689542&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:16.360121&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar como el entrenamiento de este modelo ha durado mucho
más que el modelo con filtros grandes, además, ha obtenido un mejor
resultado en el conjunto de validación cómo es <code>0.9</code>. A
continuación, visualizaremos de una forma gráfica cómo ha ido
evolucionando dicho entrenamiento.</p>
</div>
<div id="8337a4a2" class="cell code" data-execution_count="30"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T18:50:20.255345Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T18:50:20.254982Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T18:50:20.688762Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T18:50:20.687812Z&quot;}"
data-papermill="{&quot;duration&quot;:1.749012,&quot;end_time&quot;:&quot;2023-01-11T18:50:20.691020&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:18.942008&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb47"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> np.mean(history_cnn_small.history[<span class="st">&#39;val_auc&#39;</span>])</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> np.mean(history_cnn_small.history[<span class="st">&#39;val_loss&#39;</span>])</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> np.mean(history_cnn_small.history[<span class="st">&#39;auc&#39;</span>])</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> np.mean(history_cnn_small.history[<span class="st">&#39;loss&#39;</span>])</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&quot;ggplot&quot;</span>)</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn_small.history[<span class="st">&#39;val_loss&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn_small.history[<span class="st">&#39;loss&#39;</span>], marker <span class="op">=</span> <span class="st">&#39;o&#39;</span>)</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_loss&quot;</span>, <span class="st">&quot;loss&quot;</span>])</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Losses</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_loss<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Loss&quot;</span>)</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn_small.history[<span class="st">&#39;val_auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>plt.plot(history_cnn_small.history[<span class="st">&#39;auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_auc&quot;</span>, <span class="st">&quot;auc&quot;</span>])</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;AUCs</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_acc<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>acc<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;AUC&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="30">
<pre><code>Text(0, 0.5, &#39;AUC&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/26a08a04a1b9b3f314156b127f30f190071da453.png" /></p>
</div>
</div>
<div id="bfea4fc3" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.226673,&quot;end_time&quot;:&quot;2023-01-11T18:50:23.506373&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:22.279700&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar cómo existe una pequeña varianza entre el conjunto
de entrenamiento y validación, mientra que el conjunto de entrenamiento
tiene una mejora graudal el conjunto de validación tiene picos que
alterán la mejora. En cuanto a la evolución del sesgo en ambos conjuntos
conforme evolucionan las épocas mejora, salvo en el conjunto de
validación al final del entrenamiento. En conclusión, obtenemos un buen
resultado en el conjunto de validación, pero creemos qu esta muy lejos
de ser una solución prometedora. Por lo tanto, tendremos que buscar
otros diseños con el objetivo de encontrar el modelo que nos ofrezca un
resultado óptimo.</p>
<h2 id="42-diseño-de-redes-de-transfer-learning">4.2 Diseño de Redes de
Transfer learning</h2>
<p>La segunda opción que hemos comentado anteriormente es la de importar
redes ya preentrenadas de Transfer Learning. La ventaja de este tipo de
redes es que vienen prepraradas para ajustar los pesos que ya tienen
entrenados y ofrecer una clasificación, no te tienes que preocupar por
realizar un diseño específico.</p>
<h3 id="421-red-neuronal-resnet50">4.2.1 Red Neuronal: ResNet50</h3>
<p>La primera red preentrenada que probaremos es la red
<strong>ResNet50</strong>, es una red residual lo que quiere decir que
tiene capas enlazadas con otras capas no necesariamente contiguas.
Empezaremos importando dicha red desde tensorflow.</p>
</div>
<div id="6d9e57b8" class="cell code" data-execution_count="31"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T18:50:26.103617Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T18:50:26.103249Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T18:50:28.093611Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T18:50:28.092609Z&quot;}"
data-papermill="{&quot;duration&quot;:3.292931,&quot;end_time&quot;:&quot;2023-01-11T18:50:28.096148&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:24.803217&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb49"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications <span class="im">import</span> ResNet50</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>model_resnet50 <span class="op">=</span> ResNet50(</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>      input_shape <span class="op">=</span> (<span class="dv">224</span>,<span class="dv">224</span>,<span class="dv">3</span>),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>      include_top <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>      weights <span class="op">=</span> <span class="st">&#39;imagenet&#39;</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Downloading data from https://storage.googleapis.com/tensorflow/keras-applications/resnet/resnet50_weights_tf_dim_ordering_tf_kernels_notop.h5
94773248/94765736 [==============================] - 1s 0us/step
94781440/94765736 [==============================] - 1s 0us/step
</code></pre>
</div>
</div>
<div id="b249d13a" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.262784,&quot;end_time&quot;:&quot;2023-01-11T18:50:30.668729&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:29.405945&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos cargado nuestro modelo ResNet50 lo que haremos será
congelar el entrenamiento de las capas para mantener los pesos
originales.</p>
</div>
<div id="8bd386f2" class="cell code" data-execution_count="32"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T18:50:33.524902Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T18:50:33.524353Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T18:50:33.534614Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T18:50:33.533883Z&quot;}"
data-papermill="{&quot;duration&quot;:1.553755,&quot;end_time&quot;:&quot;2023-01-11T18:50:33.536892&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:31.983137&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb51"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> layers <span class="kw">in</span> model_resnet50.layers:</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>    layers.trainable <span class="op">=</span> <span class="va">False</span></span></code></pre></div>
</div>
<div id="70641a75" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.311661,&quot;end_time&quot;:&quot;2023-01-11T18:50:36.095469&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:34.783808&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Lo que haremos con la salida de dicho modelo será enlazarlo con una
capa oculta de tipo Dense, que a su vez estará conectada con la última
capa Dense encargada de ofrecer la salida y la clasificación. Entre
estás dos capas encontramos una capa Dropout para forzar a nuestra red a
generalizar mejor en las últimas capas, forzando así a reconocer
patrones diferenciales.</p>
</div>
<div id="fa9db606" class="cell code" data-execution_count="33"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T18:50:39.472433Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T18:50:39.471879Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T18:50:39.523760Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T18:50:39.522876Z&quot;}"
data-papermill="{&quot;duration&quot;:1.434201,&quot;end_time&quot;:&quot;2023-01-11T18:50:39.531085&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:38.096884&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb52"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span>  Dropout</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Flatten()(model_resnet50.output)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Dropout(<span class="fl">0.5</span>)(y)</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Dense(<span class="dv">10</span>, activation <span class="op">=</span> <span class="st">&quot;softmax&quot;</span>)(y)</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>model_resnet50 <span class="op">=</span> keras.Model(model_resnet50.<span class="bu">input</span>, y)</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>model_resnet50.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;categorical_crossentropy&quot;</span>, optimizer <span class="op">=</span> <span class="st">&quot;adam&quot;</span>, metrics <span class="op">=</span> <span class="st">&quot;AUC&quot;</span>)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>model_resnet50.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;model&quot;
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
input_1 (InputLayer)            [(None, 224, 224, 3) 0                                            
__________________________________________________________________________________________________
conv1_pad (ZeroPadding2D)       (None, 230, 230, 3)  0           input_1[0][0]                    
__________________________________________________________________________________________________
conv1_conv (Conv2D)             (None, 112, 112, 64) 9472        conv1_pad[0][0]                  
__________________________________________________________________________________________________
conv1_bn (BatchNormalization)   (None, 112, 112, 64) 256         conv1_conv[0][0]                 
__________________________________________________________________________________________________
conv1_relu (Activation)         (None, 112, 112, 64) 0           conv1_bn[0][0]                   
__________________________________________________________________________________________________
pool1_pad (ZeroPadding2D)       (None, 114, 114, 64) 0           conv1_relu[0][0]                 
__________________________________________________________________________________________________
pool1_pool (MaxPooling2D)       (None, 56, 56, 64)   0           pool1_pad[0][0]                  
__________________________________________________________________________________________________
conv2_block1_1_conv (Conv2D)    (None, 56, 56, 64)   4160        pool1_pool[0][0]                 
__________________________________________________________________________________________________
conv2_block1_1_bn (BatchNormali (None, 56, 56, 64)   256         conv2_block1_1_conv[0][0]        
__________________________________________________________________________________________________
conv2_block1_1_relu (Activation (None, 56, 56, 64)   0           conv2_block1_1_bn[0][0]          
__________________________________________________________________________________________________
conv2_block1_2_conv (Conv2D)    (None, 56, 56, 64)   36928       conv2_block1_1_relu[0][0]        
__________________________________________________________________________________________________
conv2_block1_2_bn (BatchNormali (None, 56, 56, 64)   256         conv2_block1_2_conv[0][0]        
__________________________________________________________________________________________________
conv2_block1_2_relu (Activation (None, 56, 56, 64)   0           conv2_block1_2_bn[0][0]          
__________________________________________________________________________________________________
conv2_block1_0_conv (Conv2D)    (None, 56, 56, 256)  16640       pool1_pool[0][0]                 
__________________________________________________________________________________________________
conv2_block1_3_conv (Conv2D)    (None, 56, 56, 256)  16640       conv2_block1_2_relu[0][0]        
__________________________________________________________________________________________________
conv2_block1_0_bn (BatchNormali (None, 56, 56, 256)  1024        conv2_block1_0_conv[0][0]        
__________________________________________________________________________________________________
conv2_block1_3_bn (BatchNormali (None, 56, 56, 256)  1024        conv2_block1_3_conv[0][0]        
__________________________________________________________________________________________________
conv2_block1_add (Add)          (None, 56, 56, 256)  0           conv2_block1_0_bn[0][0]          
                                                                 conv2_block1_3_bn[0][0]          
__________________________________________________________________________________________________
conv2_block1_out (Activation)   (None, 56, 56, 256)  0           conv2_block1_add[0][0]           
__________________________________________________________________________________________________
conv2_block2_1_conv (Conv2D)    (None, 56, 56, 64)   16448       conv2_block1_out[0][0]           
__________________________________________________________________________________________________
conv2_block2_1_bn (BatchNormali (None, 56, 56, 64)   256         conv2_block2_1_conv[0][0]        
__________________________________________________________________________________________________
conv2_block2_1_relu (Activation (None, 56, 56, 64)   0           conv2_block2_1_bn[0][0]          
__________________________________________________________________________________________________
conv2_block2_2_conv (Conv2D)    (None, 56, 56, 64)   36928       conv2_block2_1_relu[0][0]        
__________________________________________________________________________________________________
conv2_block2_2_bn (BatchNormali (None, 56, 56, 64)   256         conv2_block2_2_conv[0][0]        
__________________________________________________________________________________________________
conv2_block2_2_relu (Activation (None, 56, 56, 64)   0           conv2_block2_2_bn[0][0]          
__________________________________________________________________________________________________
conv2_block2_3_conv (Conv2D)    (None, 56, 56, 256)  16640       conv2_block2_2_relu[0][0]        
__________________________________________________________________________________________________
conv2_block2_3_bn (BatchNormali (None, 56, 56, 256)  1024        conv2_block2_3_conv[0][0]        
__________________________________________________________________________________________________
conv2_block2_add (Add)          (None, 56, 56, 256)  0           conv2_block1_out[0][0]           
                                                                 conv2_block2_3_bn[0][0]          
__________________________________________________________________________________________________
conv2_block2_out (Activation)   (None, 56, 56, 256)  0           conv2_block2_add[0][0]           
__________________________________________________________________________________________________
conv2_block3_1_conv (Conv2D)    (None, 56, 56, 64)   16448       conv2_block2_out[0][0]           
__________________________________________________________________________________________________
conv2_block3_1_bn (BatchNormali (None, 56, 56, 64)   256         conv2_block3_1_conv[0][0]        
__________________________________________________________________________________________________
conv2_block3_1_relu (Activation (None, 56, 56, 64)   0           conv2_block3_1_bn[0][0]          
__________________________________________________________________________________________________
conv2_block3_2_conv (Conv2D)    (None, 56, 56, 64)   36928       conv2_block3_1_relu[0][0]        
__________________________________________________________________________________________________
conv2_block3_2_bn (BatchNormali (None, 56, 56, 64)   256         conv2_block3_2_conv[0][0]        
__________________________________________________________________________________________________
conv2_block3_2_relu (Activation (None, 56, 56, 64)   0           conv2_block3_2_bn[0][0]          
__________________________________________________________________________________________________
conv2_block3_3_conv (Conv2D)    (None, 56, 56, 256)  16640       conv2_block3_2_relu[0][0]        
__________________________________________________________________________________________________
conv2_block3_3_bn (BatchNormali (None, 56, 56, 256)  1024        conv2_block3_3_conv[0][0]        
__________________________________________________________________________________________________
conv2_block3_add (Add)          (None, 56, 56, 256)  0           conv2_block2_out[0][0]           
                                                                 conv2_block3_3_bn[0][0]          
__________________________________________________________________________________________________
conv2_block3_out (Activation)   (None, 56, 56, 256)  0           conv2_block3_add[0][0]           
__________________________________________________________________________________________________
conv3_block1_1_conv (Conv2D)    (None, 28, 28, 128)  32896       conv2_block3_out[0][0]           
__________________________________________________________________________________________________
conv3_block1_1_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block1_1_conv[0][0]        
__________________________________________________________________________________________________
conv3_block1_1_relu (Activation (None, 28, 28, 128)  0           conv3_block1_1_bn[0][0]          
__________________________________________________________________________________________________
conv3_block1_2_conv (Conv2D)    (None, 28, 28, 128)  147584      conv3_block1_1_relu[0][0]        
__________________________________________________________________________________________________
conv3_block1_2_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block1_2_conv[0][0]        
__________________________________________________________________________________________________
conv3_block1_2_relu (Activation (None, 28, 28, 128)  0           conv3_block1_2_bn[0][0]          
__________________________________________________________________________________________________
conv3_block1_0_conv (Conv2D)    (None, 28, 28, 512)  131584      conv2_block3_out[0][0]           
__________________________________________________________________________________________________
conv3_block1_3_conv (Conv2D)    (None, 28, 28, 512)  66048       conv3_block1_2_relu[0][0]        
__________________________________________________________________________________________________
conv3_block1_0_bn (BatchNormali (None, 28, 28, 512)  2048        conv3_block1_0_conv[0][0]        
__________________________________________________________________________________________________
conv3_block1_3_bn (BatchNormali (None, 28, 28, 512)  2048        conv3_block1_3_conv[0][0]        
__________________________________________________________________________________________________
conv3_block1_add (Add)          (None, 28, 28, 512)  0           conv3_block1_0_bn[0][0]          
                                                                 conv3_block1_3_bn[0][0]          
__________________________________________________________________________________________________
conv3_block1_out (Activation)   (None, 28, 28, 512)  0           conv3_block1_add[0][0]           
__________________________________________________________________________________________________
conv3_block2_1_conv (Conv2D)    (None, 28, 28, 128)  65664       conv3_block1_out[0][0]           
__________________________________________________________________________________________________
conv3_block2_1_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block2_1_conv[0][0]        
__________________________________________________________________________________________________
conv3_block2_1_relu (Activation (None, 28, 28, 128)  0           conv3_block2_1_bn[0][0]          
__________________________________________________________________________________________________
conv3_block2_2_conv (Conv2D)    (None, 28, 28, 128)  147584      conv3_block2_1_relu[0][0]        
__________________________________________________________________________________________________
conv3_block2_2_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block2_2_conv[0][0]        
__________________________________________________________________________________________________
conv3_block2_2_relu (Activation (None, 28, 28, 128)  0           conv3_block2_2_bn[0][0]          
__________________________________________________________________________________________________
conv3_block2_3_conv (Conv2D)    (None, 28, 28, 512)  66048       conv3_block2_2_relu[0][0]        
__________________________________________________________________________________________________
conv3_block2_3_bn (BatchNormali (None, 28, 28, 512)  2048        conv3_block2_3_conv[0][0]        
__________________________________________________________________________________________________
conv3_block2_add (Add)          (None, 28, 28, 512)  0           conv3_block1_out[0][0]           
                                                                 conv3_block2_3_bn[0][0]          
__________________________________________________________________________________________________
conv3_block2_out (Activation)   (None, 28, 28, 512)  0           conv3_block2_add[0][0]           
__________________________________________________________________________________________________
conv3_block3_1_conv (Conv2D)    (None, 28, 28, 128)  65664       conv3_block2_out[0][0]           
__________________________________________________________________________________________________
conv3_block3_1_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block3_1_conv[0][0]        
__________________________________________________________________________________________________
conv3_block3_1_relu (Activation (None, 28, 28, 128)  0           conv3_block3_1_bn[0][0]          
__________________________________________________________________________________________________
conv3_block3_2_conv (Conv2D)    (None, 28, 28, 128)  147584      conv3_block3_1_relu[0][0]        
__________________________________________________________________________________________________
conv3_block3_2_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block3_2_conv[0][0]        
__________________________________________________________________________________________________
conv3_block3_2_relu (Activation (None, 28, 28, 128)  0           conv3_block3_2_bn[0][0]          
__________________________________________________________________________________________________
conv3_block3_3_conv (Conv2D)    (None, 28, 28, 512)  66048       conv3_block3_2_relu[0][0]        
__________________________________________________________________________________________________
conv3_block3_3_bn (BatchNormali (None, 28, 28, 512)  2048        conv3_block3_3_conv[0][0]        
__________________________________________________________________________________________________
conv3_block3_add (Add)          (None, 28, 28, 512)  0           conv3_block2_out[0][0]           
                                                                 conv3_block3_3_bn[0][0]          
__________________________________________________________________________________________________
conv3_block3_out (Activation)   (None, 28, 28, 512)  0           conv3_block3_add[0][0]           
__________________________________________________________________________________________________
conv3_block4_1_conv (Conv2D)    (None, 28, 28, 128)  65664       conv3_block3_out[0][0]           
__________________________________________________________________________________________________
conv3_block4_1_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block4_1_conv[0][0]        
__________________________________________________________________________________________________
conv3_block4_1_relu (Activation (None, 28, 28, 128)  0           conv3_block4_1_bn[0][0]          
__________________________________________________________________________________________________
conv3_block4_2_conv (Conv2D)    (None, 28, 28, 128)  147584      conv3_block4_1_relu[0][0]        
__________________________________________________________________________________________________
conv3_block4_2_bn (BatchNormali (None, 28, 28, 128)  512         conv3_block4_2_conv[0][0]        
__________________________________________________________________________________________________
conv3_block4_2_relu (Activation (None, 28, 28, 128)  0           conv3_block4_2_bn[0][0]          
__________________________________________________________________________________________________
conv3_block4_3_conv (Conv2D)    (None, 28, 28, 512)  66048       conv3_block4_2_relu[0][0]        
__________________________________________________________________________________________________
conv3_block4_3_bn (BatchNormali (None, 28, 28, 512)  2048        conv3_block4_3_conv[0][0]        
__________________________________________________________________________________________________
conv3_block4_add (Add)          (None, 28, 28, 512)  0           conv3_block3_out[0][0]           
                                                                 conv3_block4_3_bn[0][0]          
__________________________________________________________________________________________________
conv3_block4_out (Activation)   (None, 28, 28, 512)  0           conv3_block4_add[0][0]           
__________________________________________________________________________________________________
conv4_block1_1_conv (Conv2D)    (None, 14, 14, 256)  131328      conv3_block4_out[0][0]           
__________________________________________________________________________________________________
conv4_block1_1_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block1_1_conv[0][0]        
__________________________________________________________________________________________________
conv4_block1_1_relu (Activation (None, 14, 14, 256)  0           conv4_block1_1_bn[0][0]          
__________________________________________________________________________________________________
conv4_block1_2_conv (Conv2D)    (None, 14, 14, 256)  590080      conv4_block1_1_relu[0][0]        
__________________________________________________________________________________________________
conv4_block1_2_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block1_2_conv[0][0]        
__________________________________________________________________________________________________
conv4_block1_2_relu (Activation (None, 14, 14, 256)  0           conv4_block1_2_bn[0][0]          
__________________________________________________________________________________________________
conv4_block1_0_conv (Conv2D)    (None, 14, 14, 1024) 525312      conv3_block4_out[0][0]           
__________________________________________________________________________________________________
conv4_block1_3_conv (Conv2D)    (None, 14, 14, 1024) 263168      conv4_block1_2_relu[0][0]        
__________________________________________________________________________________________________
conv4_block1_0_bn (BatchNormali (None, 14, 14, 1024) 4096        conv4_block1_0_conv[0][0]        
__________________________________________________________________________________________________
conv4_block1_3_bn (BatchNormali (None, 14, 14, 1024) 4096        conv4_block1_3_conv[0][0]        
__________________________________________________________________________________________________
conv4_block1_add (Add)          (None, 14, 14, 1024) 0           conv4_block1_0_bn[0][0]          
                                                                 conv4_block1_3_bn[0][0]          
__________________________________________________________________________________________________
conv4_block1_out (Activation)   (None, 14, 14, 1024) 0           conv4_block1_add[0][0]           
__________________________________________________________________________________________________
conv4_block2_1_conv (Conv2D)    (None, 14, 14, 256)  262400      conv4_block1_out[0][0]           
__________________________________________________________________________________________________
conv4_block2_1_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block2_1_conv[0][0]        
__________________________________________________________________________________________________
conv4_block2_1_relu (Activation (None, 14, 14, 256)  0           conv4_block2_1_bn[0][0]          
__________________________________________________________________________________________________
conv4_block2_2_conv (Conv2D)    (None, 14, 14, 256)  590080      conv4_block2_1_relu[0][0]        
__________________________________________________________________________________________________
conv4_block2_2_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block2_2_conv[0][0]        
__________________________________________________________________________________________________
conv4_block2_2_relu (Activation (None, 14, 14, 256)  0           conv4_block2_2_bn[0][0]          
__________________________________________________________________________________________________
conv4_block2_3_conv (Conv2D)    (None, 14, 14, 1024) 263168      conv4_block2_2_relu[0][0]        
__________________________________________________________________________________________________
conv4_block2_3_bn (BatchNormali (None, 14, 14, 1024) 4096        conv4_block2_3_conv[0][0]        
__________________________________________________________________________________________________
conv4_block2_add (Add)          (None, 14, 14, 1024) 0           conv4_block1_out[0][0]           
                                                                 conv4_block2_3_bn[0][0]          
__________________________________________________________________________________________________
conv4_block2_out (Activation)   (None, 14, 14, 1024) 0           conv4_block2_add[0][0]           
__________________________________________________________________________________________________
conv4_block3_1_conv (Conv2D)    (None, 14, 14, 256)  262400      conv4_block2_out[0][0]           
__________________________________________________________________________________________________
conv4_block3_1_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block3_1_conv[0][0]        
__________________________________________________________________________________________________
conv4_block3_1_relu (Activation (None, 14, 14, 256)  0           conv4_block3_1_bn[0][0]          
__________________________________________________________________________________________________
conv4_block3_2_conv (Conv2D)    (None, 14, 14, 256)  590080      conv4_block3_1_relu[0][0]        
__________________________________________________________________________________________________
conv4_block3_2_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block3_2_conv[0][0]        
__________________________________________________________________________________________________
conv4_block3_2_relu (Activation (None, 14, 14, 256)  0           conv4_block3_2_bn[0][0]          
__________________________________________________________________________________________________
conv4_block3_3_conv (Conv2D)    (None, 14, 14, 1024) 263168      conv4_block3_2_relu[0][0]        
__________________________________________________________________________________________________
conv4_block3_3_bn (BatchNormali (None, 14, 14, 1024) 4096        conv4_block3_3_conv[0][0]        
__________________________________________________________________________________________________
conv4_block3_add (Add)          (None, 14, 14, 1024) 0           conv4_block2_out[0][0]           
                                                                 conv4_block3_3_bn[0][0]          
__________________________________________________________________________________________________
conv4_block3_out (Activation)   (None, 14, 14, 1024) 0           conv4_block3_add[0][0]           
__________________________________________________________________________________________________
conv4_block4_1_conv (Conv2D)    (None, 14, 14, 256)  262400      conv4_block3_out[0][0]           
__________________________________________________________________________________________________
conv4_block4_1_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block4_1_conv[0][0]        
__________________________________________________________________________________________________
conv4_block4_1_relu (Activation (None, 14, 14, 256)  0           conv4_block4_1_bn[0][0]          
__________________________________________________________________________________________________
conv4_block4_2_conv (Conv2D)    (None, 14, 14, 256)  590080      conv4_block4_1_relu[0][0]        
__________________________________________________________________________________________________
conv4_block4_2_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block4_2_conv[0][0]        
__________________________________________________________________________________________________
conv4_block4_2_relu (Activation (None, 14, 14, 256)  0           conv4_block4_2_bn[0][0]          
__________________________________________________________________________________________________
conv4_block4_3_conv (Conv2D)    (None, 14, 14, 1024) 263168      conv4_block4_2_relu[0][0]        
__________________________________________________________________________________________________
conv4_block4_3_bn (BatchNormali (None, 14, 14, 1024) 4096        conv4_block4_3_conv[0][0]        
__________________________________________________________________________________________________
conv4_block4_add (Add)          (None, 14, 14, 1024) 0           conv4_block3_out[0][0]           
                                                                 conv4_block4_3_bn[0][0]          
__________________________________________________________________________________________________
conv4_block4_out (Activation)   (None, 14, 14, 1024) 0           conv4_block4_add[0][0]           
__________________________________________________________________________________________________
conv4_block5_1_conv (Conv2D)    (None, 14, 14, 256)  262400      conv4_block4_out[0][0]           
__________________________________________________________________________________________________
conv4_block5_1_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block5_1_conv[0][0]        
__________________________________________________________________________________________________
conv4_block5_1_relu (Activation (None, 14, 14, 256)  0           conv4_block5_1_bn[0][0]          
__________________________________________________________________________________________________
conv4_block5_2_conv (Conv2D)    (None, 14, 14, 256)  590080      conv4_block5_1_relu[0][0]        
__________________________________________________________________________________________________
conv4_block5_2_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block5_2_conv[0][0]        
__________________________________________________________________________________________________
conv4_block5_2_relu (Activation (None, 14, 14, 256)  0           conv4_block5_2_bn[0][0]          
__________________________________________________________________________________________________
conv4_block5_3_conv (Conv2D)    (None, 14, 14, 1024) 263168      conv4_block5_2_relu[0][0]        
__________________________________________________________________________________________________
conv4_block5_3_bn (BatchNormali (None, 14, 14, 1024) 4096        conv4_block5_3_conv[0][0]        
__________________________________________________________________________________________________
conv4_block5_add (Add)          (None, 14, 14, 1024) 0           conv4_block4_out[0][0]           
                                                                 conv4_block5_3_bn[0][0]          
__________________________________________________________________________________________________
conv4_block5_out (Activation)   (None, 14, 14, 1024) 0           conv4_block5_add[0][0]           
__________________________________________________________________________________________________
conv4_block6_1_conv (Conv2D)    (None, 14, 14, 256)  262400      conv4_block5_out[0][0]           
__________________________________________________________________________________________________
conv4_block6_1_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block6_1_conv[0][0]        
__________________________________________________________________________________________________
conv4_block6_1_relu (Activation (None, 14, 14, 256)  0           conv4_block6_1_bn[0][0]          
__________________________________________________________________________________________________
conv4_block6_2_conv (Conv2D)    (None, 14, 14, 256)  590080      conv4_block6_1_relu[0][0]        
__________________________________________________________________________________________________
conv4_block6_2_bn (BatchNormali (None, 14, 14, 256)  1024        conv4_block6_2_conv[0][0]        
__________________________________________________________________________________________________
conv4_block6_2_relu (Activation (None, 14, 14, 256)  0           conv4_block6_2_bn[0][0]          
__________________________________________________________________________________________________
conv4_block6_3_conv (Conv2D)    (None, 14, 14, 1024) 263168      conv4_block6_2_relu[0][0]        
__________________________________________________________________________________________________
conv4_block6_3_bn (BatchNormali (None, 14, 14, 1024) 4096        conv4_block6_3_conv[0][0]        
__________________________________________________________________________________________________
conv4_block6_add (Add)          (None, 14, 14, 1024) 0           conv4_block5_out[0][0]           
                                                                 conv4_block6_3_bn[0][0]          
__________________________________________________________________________________________________
conv4_block6_out (Activation)   (None, 14, 14, 1024) 0           conv4_block6_add[0][0]           
__________________________________________________________________________________________________
conv5_block1_1_conv (Conv2D)    (None, 7, 7, 512)    524800      conv4_block6_out[0][0]           
__________________________________________________________________________________________________
conv5_block1_1_bn (BatchNormali (None, 7, 7, 512)    2048        conv5_block1_1_conv[0][0]        
__________________________________________________________________________________________________
conv5_block1_1_relu (Activation (None, 7, 7, 512)    0           conv5_block1_1_bn[0][0]          
__________________________________________________________________________________________________
conv5_block1_2_conv (Conv2D)    (None, 7, 7, 512)    2359808     conv5_block1_1_relu[0][0]        
__________________________________________________________________________________________________
conv5_block1_2_bn (BatchNormali (None, 7, 7, 512)    2048        conv5_block1_2_conv[0][0]        
__________________________________________________________________________________________________
conv5_block1_2_relu (Activation (None, 7, 7, 512)    0           conv5_block1_2_bn[0][0]          
__________________________________________________________________________________________________
conv5_block1_0_conv (Conv2D)    (None, 7, 7, 2048)   2099200     conv4_block6_out[0][0]           
__________________________________________________________________________________________________
conv5_block1_3_conv (Conv2D)    (None, 7, 7, 2048)   1050624     conv5_block1_2_relu[0][0]        
__________________________________________________________________________________________________
conv5_block1_0_bn (BatchNormali (None, 7, 7, 2048)   8192        conv5_block1_0_conv[0][0]        
__________________________________________________________________________________________________
conv5_block1_3_bn (BatchNormali (None, 7, 7, 2048)   8192        conv5_block1_3_conv[0][0]        
__________________________________________________________________________________________________
conv5_block1_add (Add)          (None, 7, 7, 2048)   0           conv5_block1_0_bn[0][0]          
                                                                 conv5_block1_3_bn[0][0]          
__________________________________________________________________________________________________
conv5_block1_out (Activation)   (None, 7, 7, 2048)   0           conv5_block1_add[0][0]           
__________________________________________________________________________________________________
conv5_block2_1_conv (Conv2D)    (None, 7, 7, 512)    1049088     conv5_block1_out[0][0]           
__________________________________________________________________________________________________
conv5_block2_1_bn (BatchNormali (None, 7, 7, 512)    2048        conv5_block2_1_conv[0][0]        
__________________________________________________________________________________________________
conv5_block2_1_relu (Activation (None, 7, 7, 512)    0           conv5_block2_1_bn[0][0]          
__________________________________________________________________________________________________
conv5_block2_2_conv (Conv2D)    (None, 7, 7, 512)    2359808     conv5_block2_1_relu[0][0]        
__________________________________________________________________________________________________
conv5_block2_2_bn (BatchNormali (None, 7, 7, 512)    2048        conv5_block2_2_conv[0][0]        
__________________________________________________________________________________________________
conv5_block2_2_relu (Activation (None, 7, 7, 512)    0           conv5_block2_2_bn[0][0]          
__________________________________________________________________________________________________
conv5_block2_3_conv (Conv2D)    (None, 7, 7, 2048)   1050624     conv5_block2_2_relu[0][0]        
__________________________________________________________________________________________________
conv5_block2_3_bn (BatchNormali (None, 7, 7, 2048)   8192        conv5_block2_3_conv[0][0]        
__________________________________________________________________________________________________
conv5_block2_add (Add)          (None, 7, 7, 2048)   0           conv5_block1_out[0][0]           
                                                                 conv5_block2_3_bn[0][0]          
__________________________________________________________________________________________________
conv5_block2_out (Activation)   (None, 7, 7, 2048)   0           conv5_block2_add[0][0]           
__________________________________________________________________________________________________
conv5_block3_1_conv (Conv2D)    (None, 7, 7, 512)    1049088     conv5_block2_out[0][0]           
__________________________________________________________________________________________________
conv5_block3_1_bn (BatchNormali (None, 7, 7, 512)    2048        conv5_block3_1_conv[0][0]        
__________________________________________________________________________________________________
conv5_block3_1_relu (Activation (None, 7, 7, 512)    0           conv5_block3_1_bn[0][0]          
__________________________________________________________________________________________________
conv5_block3_2_conv (Conv2D)    (None, 7, 7, 512)    2359808     conv5_block3_1_relu[0][0]        
__________________________________________________________________________________________________
conv5_block3_2_bn (BatchNormali (None, 7, 7, 512)    2048        conv5_block3_2_conv[0][0]        
__________________________________________________________________________________________________
conv5_block3_2_relu (Activation (None, 7, 7, 512)    0           conv5_block3_2_bn[0][0]          
__________________________________________________________________________________________________
conv5_block3_3_conv (Conv2D)    (None, 7, 7, 2048)   1050624     conv5_block3_2_relu[0][0]        
__________________________________________________________________________________________________
conv5_block3_3_bn (BatchNormali (None, 7, 7, 2048)   8192        conv5_block3_3_conv[0][0]        
__________________________________________________________________________________________________
conv5_block3_add (Add)          (None, 7, 7, 2048)   0           conv5_block2_out[0][0]           
                                                                 conv5_block3_3_bn[0][0]          
__________________________________________________________________________________________________
conv5_block3_out (Activation)   (None, 7, 7, 2048)   0           conv5_block3_add[0][0]           
__________________________________________________________________________________________________
flatten_2 (Flatten)             (None, 100352)       0           conv5_block3_out[0][0]           
__________________________________________________________________________________________________
dropout_6 (Dropout)             (None, 100352)       0           flatten_2[0][0]                  
__________________________________________________________________________________________________
dense_4 (Dense)                 (None, 10)           1003530     dropout_6[0][0]                  
==================================================================================================
Total params: 24,591,242
Trainable params: 1,003,530
Non-trainable params: 23,587,712
__________________________________________________________________________________________________
</code></pre>
</div>
</div>
<div id="9f7aae1c" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.324785,&quot;end_time&quot;:&quot;2023-01-11T18:50:42.136464&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:40.811679&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos el modelo compilado procedemos a entrenarlo durante
100 epochs dado que tenemos EarlyStopping, lo que hara que se detenga
antes de llegar a las 100 epochs.</p>
</div>
<div id="59a51f4d" class="cell code" data-execution_count="34"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T18:50:44.924804Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T18:50:44.924286Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:18:26.963151Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:18:26.961993Z&quot;}"
data-papermill="{&quot;duration&quot;:1663.516262,&quot;end_time&quot;:&quot;2023-01-11T19:18:26.965876&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T18:50:43.449614&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb54"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>history_resnet50 <span class="op">=</span> model_resnet50.fit(train_generator, validation_data<span class="op">=</span>val_generator, epochs<span class="op">=</span><span class="dv">100</span>, verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>cbs)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
655/655 [==============================] - 280s 423ms/step - loss: 4.8333 - auc: 0.9184 - val_loss: 3.4369 - val_auc: 0.9528
Epoch 2/100
655/655 [==============================] - 277s 422ms/step - loss: 5.0587 - auc: 0.9399 - val_loss: 4.1397 - val_auc: 0.9593
Epoch 3/100
655/655 [==============================] - 276s 421ms/step - loss: 5.0243 - auc: 0.9471 - val_loss: 4.7457 - val_auc: 0.9589
Epoch 4/100
655/655 [==============================] - 277s 424ms/step - loss: 5.1185 - auc: 0.9521 - val_loss: 4.9728 - val_auc: 0.9624
Epoch 5/100
655/655 [==============================] - 276s 422ms/step - loss: 4.8672 - auc: 0.9562 - val_loss: 5.4058 - val_auc: 0.9630
Epoch 6/100
655/655 [==============================] - 275s 420ms/step - loss: 4.7443 - auc: 0.9579 - val_loss: 6.0654 - val_auc: 0.9601
</code></pre>
</div>
</div>
<div id="98e77d26" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.922754,&quot;end_time&quot;:&quot;2023-01-11T19:18:30.328977&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:28.406223&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Dicho modelo consigue un resultado en el conjunto de validación de
<code>0.9641</code>, un resalto muy bueno para nuestro problema. Además,
realiza el entrenamiento en pocas epochs. A continuación, veremos cómo
evoluciona dicho entrenamiento de una forma más gráfica.</p>
</div>
<div id="e86e273a" class="cell code" data-execution_count="35"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:18:33.856438Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:18:33.856062Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:18:34.285432Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:18:34.284432Z&quot;}"
data-papermill="{&quot;duration&quot;:2.062971,&quot;end_time&quot;:&quot;2023-01-11T19:18:34.287757&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:32.224786&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb56"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> np.mean(history_resnet50.history[<span class="st">&#39;val_auc&#39;</span>])</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> np.mean(history_resnet50.history[<span class="st">&#39;val_loss&#39;</span>])</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> np.mean(history_resnet50.history[<span class="st">&#39;auc&#39;</span>])</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> np.mean(history_resnet50.history[<span class="st">&#39;loss&#39;</span>])</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&quot;ggplot&quot;</span>)</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>plt.plot(history_resnet50.history[<span class="st">&#39;val_loss&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>plt.plot(history_resnet50.history[<span class="st">&#39;loss&#39;</span>], marker <span class="op">=</span> <span class="st">&#39;o&#39;</span>)</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_loss&quot;</span>, <span class="st">&quot;loss&quot;</span>])</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Losses</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_loss<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Loss&quot;</span>)</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>plt.plot(history_resnet50.history[<span class="st">&#39;val_auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>plt.plot(history_resnet50.history[<span class="st">&#39;auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_auc&quot;</span>, <span class="st">&quot;auc&quot;</span>])</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;AUCs</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_acc<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>acc<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;AUC&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="35">
<pre><code>Text(0, 0.5, &#39;AUC&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/4e0a3c31e22267da41b5a83959bedaf7c9d961ac.png" /></p>
</div>
</div>
<div id="2a54a367" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.528659,&quot;end_time&quot;:&quot;2023-01-11T19:18:37.430897&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:35.902238&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Como podemos observar en las gráficas nuestro modelo tiene un mínimo
de varianza dado que existe una pequeña diferencia entre el conjunto de
entrenamiento y de validación. Además, encontramos que nuestro modelo
tiene un poco de sesgo dado que el error obtenido tanto en entrenamiento
como en validación es algo elevado al óptimo.</p>
</div>
<div id="50661a77" class="cell code" data-execution_count="36"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:18:40.923721Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:18:40.923296Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:18:41.349009Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:18:41.348032Z&quot;}"
data-papermill="{&quot;duration&quot;:2.285196,&quot;end_time&quot;:&quot;2023-01-11T19:18:41.351756&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:39.066560&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb58"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>model_resnet50.save(<span class="st">&quot;model_resnet50.h5&quot;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/opt/conda/lib/python3.7/site-packages/keras/utils/generic_utils.py:497: CustomMaskWarning:

Custom mask layers require a config and must override get_config. When loading, the custom mask layer must be passed to the custom_objects argument.

</code></pre>
</div>
</div>
<div id="025a03cd" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.572024,&quot;end_time&quot;:&quot;2023-01-11T19:18:44.482282&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:42.910258&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Por último, dado que nuestro modelo consigue un buen resultado sobre
el conjunto de validación decidimos guardarnos el modelo.</p>
<h3 id="422-red-neuronal-efficientnetb7">4.2.2 Red Neuronal:
EfficientNetB7</h3>
<p>La segunda red preentrenada que utilizaremos es la EfficientNetB7, al
igual que sucedia con la ResNet50 importaremos la red y mantendremos los
pesos originales. Por lo tanto, lo primero que tenemos que hacer es
cargarla.</p>
</div>
<div id="ee8410b5" class="cell code" data-execution_count="37"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:18:47.482041Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:18:47.481649Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:18:54.229256Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:18:54.228263Z&quot;}"
data-papermill="{&quot;duration&quot;:8.287825,&quot;end_time&quot;:&quot;2023-01-11T19:18:54.231715&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:45.943890&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb60"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications <span class="im">import</span> EfficientNetB7</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>model_efficientnetb7 <span class="op">=</span> EfficientNetB7(</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>      input_shape <span class="op">=</span> (<span class="dv">224</span>,<span class="dv">224</span>,<span class="dv">3</span>),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>      include_top <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>      weights <span class="op">=</span> <span class="st">&#39;imagenet&#39;</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Downloading data from https://storage.googleapis.com/keras-applications/efficientnetb7_notop.h5
258080768/258076736 [==============================] - 1s 0us/step
258088960/258076736 [==============================] - 1s 0us/step
</code></pre>
</div>
</div>
<div id="29f4f309" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.529979,&quot;end_time&quot;:&quot;2023-01-11T19:18:57.274415&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:55.744436&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez cargada la red EfficientNetB7 lo que haremos será congelar
las capas intermedias para que no modifiquen sus pesos.</p>
</div>
<div id="7a970cfc" class="cell code" data-execution_count="38"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:19:00.275805Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:19:00.275450Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:19:00.302495Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:19:00.301593Z&quot;}"
data-papermill="{&quot;duration&quot;:1.479277,&quot;end_time&quot;:&quot;2023-01-11T19:19:00.304724&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:18:58.825447&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb62"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> layers <span class="kw">in</span> model_efficientnetb7.layers:</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    layers.trainable <span class="op">=</span> <span class="va">False</span></span></code></pre></div>
</div>
<div id="0f0e0ca5" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.409987,&quot;end_time&quot;:&quot;2023-01-11T19:19:04.454463&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:19:02.044476&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Después de congelar dichas capas crearemos la salida de nuestra red.
Para ello tendremos una primera capa oculta de tipo Dense conectada con
una última capa Dense encargada de generar la salida y la clasificación.
Además, entre medias de las dos capas encontramos una capa Dropout
obligando a la red a ser más robusta y generalizar mejor.</p>
</div>
<div id="abc78556" class="cell code" data-execution_count="39"
data-collapsed="true"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:19:07.535429Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:19:07.535035Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:19:07.699015Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:19:07.698124Z&quot;}"
data-jupyter="{&quot;outputs_hidden&quot;:true}"
data-papermill="{&quot;duration&quot;:1.729092,&quot;end_time&quot;:&quot;2023-01-11T19:19:07.710344&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:19:05.981252&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb63"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> keras.layers <span class="im">import</span>  Dropout</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Flatten()(model_efficientnetb7.output)</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Dropout(<span class="fl">0.5</span>)(y)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Dense(<span class="dv">10</span>, activation <span class="op">=</span> <span class="st">&quot;softmax&quot;</span>)(y)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>model_efficientnetb7 <span class="op">=</span> keras.Model(model_efficientnetb7.<span class="bu">input</span>, y)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>model_efficientnetb7.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;categorical_crossentropy&quot;</span>, optimizer <span class="op">=</span> <span class="st">&quot;adam&quot;</span>, metrics <span class="op">=</span> <span class="st">&quot;AUC&quot;</span>)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>model_efficientnetb7.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;model_1&quot;
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
input_2 (InputLayer)            [(None, 224, 224, 3) 0                                            
__________________________________________________________________________________________________
rescaling (Rescaling)           (None, 224, 224, 3)  0           input_2[0][0]                    
__________________________________________________________________________________________________
normalization (Normalization)   (None, 224, 224, 3)  7           rescaling[0][0]                  
__________________________________________________________________________________________________
stem_conv_pad (ZeroPadding2D)   (None, 225, 225, 3)  0           normalization[0][0]              
__________________________________________________________________________________________________
stem_conv (Conv2D)              (None, 112, 112, 64) 1728        stem_conv_pad[0][0]              
__________________________________________________________________________________________________
stem_bn (BatchNormalization)    (None, 112, 112, 64) 256         stem_conv[0][0]                  
__________________________________________________________________________________________________
stem_activation (Activation)    (None, 112, 112, 64) 0           stem_bn[0][0]                    
__________________________________________________________________________________________________
block1a_dwconv (DepthwiseConv2D (None, 112, 112, 64) 576         stem_activation[0][0]            
__________________________________________________________________________________________________
block1a_bn (BatchNormalization) (None, 112, 112, 64) 256         block1a_dwconv[0][0]             
__________________________________________________________________________________________________
block1a_activation (Activation) (None, 112, 112, 64) 0           block1a_bn[0][0]                 
__________________________________________________________________________________________________
block1a_se_squeeze (GlobalAvera (None, 64)           0           block1a_activation[0][0]         
__________________________________________________________________________________________________
block1a_se_reshape (Reshape)    (None, 1, 1, 64)     0           block1a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block1a_se_reduce (Conv2D)      (None, 1, 1, 16)     1040        block1a_se_reshape[0][0]         
__________________________________________________________________________________________________
block1a_se_expand (Conv2D)      (None, 1, 1, 64)     1088        block1a_se_reduce[0][0]          
__________________________________________________________________________________________________
block1a_se_excite (Multiply)    (None, 112, 112, 64) 0           block1a_activation[0][0]         
                                                                 block1a_se_expand[0][0]          
__________________________________________________________________________________________________
block1a_project_conv (Conv2D)   (None, 112, 112, 32) 2048        block1a_se_excite[0][0]          
__________________________________________________________________________________________________
block1a_project_bn (BatchNormal (None, 112, 112, 32) 128         block1a_project_conv[0][0]       
__________________________________________________________________________________________________
block1b_dwconv (DepthwiseConv2D (None, 112, 112, 32) 288         block1a_project_bn[0][0]         
__________________________________________________________________________________________________
block1b_bn (BatchNormalization) (None, 112, 112, 32) 128         block1b_dwconv[0][0]             
__________________________________________________________________________________________________
block1b_activation (Activation) (None, 112, 112, 32) 0           block1b_bn[0][0]                 
__________________________________________________________________________________________________
block1b_se_squeeze (GlobalAvera (None, 32)           0           block1b_activation[0][0]         
__________________________________________________________________________________________________
block1b_se_reshape (Reshape)    (None, 1, 1, 32)     0           block1b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block1b_se_reduce (Conv2D)      (None, 1, 1, 8)      264         block1b_se_reshape[0][0]         
__________________________________________________________________________________________________
block1b_se_expand (Conv2D)      (None, 1, 1, 32)     288         block1b_se_reduce[0][0]          
__________________________________________________________________________________________________
block1b_se_excite (Multiply)    (None, 112, 112, 32) 0           block1b_activation[0][0]         
                                                                 block1b_se_expand[0][0]          
__________________________________________________________________________________________________
block1b_project_conv (Conv2D)   (None, 112, 112, 32) 1024        block1b_se_excite[0][0]          
__________________________________________________________________________________________________
block1b_project_bn (BatchNormal (None, 112, 112, 32) 128         block1b_project_conv[0][0]       
__________________________________________________________________________________________________
block1b_drop (Dropout)          (None, 112, 112, 32) 0           block1b_project_bn[0][0]         
__________________________________________________________________________________________________
block1b_add (Add)               (None, 112, 112, 32) 0           block1b_drop[0][0]               
                                                                 block1a_project_bn[0][0]         
__________________________________________________________________________________________________
block1c_dwconv (DepthwiseConv2D (None, 112, 112, 32) 288         block1b_add[0][0]                
__________________________________________________________________________________________________
block1c_bn (BatchNormalization) (None, 112, 112, 32) 128         block1c_dwconv[0][0]             
__________________________________________________________________________________________________
block1c_activation (Activation) (None, 112, 112, 32) 0           block1c_bn[0][0]                 
__________________________________________________________________________________________________
block1c_se_squeeze (GlobalAvera (None, 32)           0           block1c_activation[0][0]         
__________________________________________________________________________________________________
block1c_se_reshape (Reshape)    (None, 1, 1, 32)     0           block1c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block1c_se_reduce (Conv2D)      (None, 1, 1, 8)      264         block1c_se_reshape[0][0]         
__________________________________________________________________________________________________
block1c_se_expand (Conv2D)      (None, 1, 1, 32)     288         block1c_se_reduce[0][0]          
__________________________________________________________________________________________________
block1c_se_excite (Multiply)    (None, 112, 112, 32) 0           block1c_activation[0][0]         
                                                                 block1c_se_expand[0][0]          
__________________________________________________________________________________________________
block1c_project_conv (Conv2D)   (None, 112, 112, 32) 1024        block1c_se_excite[0][0]          
__________________________________________________________________________________________________
block1c_project_bn (BatchNormal (None, 112, 112, 32) 128         block1c_project_conv[0][0]       
__________________________________________________________________________________________________
block1c_drop (Dropout)          (None, 112, 112, 32) 0           block1c_project_bn[0][0]         
__________________________________________________________________________________________________
block1c_add (Add)               (None, 112, 112, 32) 0           block1c_drop[0][0]               
                                                                 block1b_add[0][0]                
__________________________________________________________________________________________________
block1d_dwconv (DepthwiseConv2D (None, 112, 112, 32) 288         block1c_add[0][0]                
__________________________________________________________________________________________________
block1d_bn (BatchNormalization) (None, 112, 112, 32) 128         block1d_dwconv[0][0]             
__________________________________________________________________________________________________
block1d_activation (Activation) (None, 112, 112, 32) 0           block1d_bn[0][0]                 
__________________________________________________________________________________________________
block1d_se_squeeze (GlobalAvera (None, 32)           0           block1d_activation[0][0]         
__________________________________________________________________________________________________
block1d_se_reshape (Reshape)    (None, 1, 1, 32)     0           block1d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block1d_se_reduce (Conv2D)      (None, 1, 1, 8)      264         block1d_se_reshape[0][0]         
__________________________________________________________________________________________________
block1d_se_expand (Conv2D)      (None, 1, 1, 32)     288         block1d_se_reduce[0][0]          
__________________________________________________________________________________________________
block1d_se_excite (Multiply)    (None, 112, 112, 32) 0           block1d_activation[0][0]         
                                                                 block1d_se_expand[0][0]          
__________________________________________________________________________________________________
block1d_project_conv (Conv2D)   (None, 112, 112, 32) 1024        block1d_se_excite[0][0]          
__________________________________________________________________________________________________
block1d_project_bn (BatchNormal (None, 112, 112, 32) 128         block1d_project_conv[0][0]       
__________________________________________________________________________________________________
block1d_drop (Dropout)          (None, 112, 112, 32) 0           block1d_project_bn[0][0]         
__________________________________________________________________________________________________
block1d_add (Add)               (None, 112, 112, 32) 0           block1d_drop[0][0]               
                                                                 block1c_add[0][0]                
__________________________________________________________________________________________________
block2a_expand_conv (Conv2D)    (None, 112, 112, 192 6144        block1d_add[0][0]                
__________________________________________________________________________________________________
block2a_expand_bn (BatchNormali (None, 112, 112, 192 768         block2a_expand_conv[0][0]        
__________________________________________________________________________________________________
block2a_expand_activation (Acti (None, 112, 112, 192 0           block2a_expand_bn[0][0]          
__________________________________________________________________________________________________
block2a_dwconv_pad (ZeroPadding (None, 113, 113, 192 0           block2a_expand_activation[0][0]  
__________________________________________________________________________________________________
block2a_dwconv (DepthwiseConv2D (None, 56, 56, 192)  1728        block2a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block2a_bn (BatchNormalization) (None, 56, 56, 192)  768         block2a_dwconv[0][0]             
__________________________________________________________________________________________________
block2a_activation (Activation) (None, 56, 56, 192)  0           block2a_bn[0][0]                 
__________________________________________________________________________________________________
block2a_se_squeeze (GlobalAvera (None, 192)          0           block2a_activation[0][0]         
__________________________________________________________________________________________________
block2a_se_reshape (Reshape)    (None, 1, 1, 192)    0           block2a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2a_se_reduce (Conv2D)      (None, 1, 1, 8)      1544        block2a_se_reshape[0][0]         
__________________________________________________________________________________________________
block2a_se_expand (Conv2D)      (None, 1, 1, 192)    1728        block2a_se_reduce[0][0]          
__________________________________________________________________________________________________
block2a_se_excite (Multiply)    (None, 56, 56, 192)  0           block2a_activation[0][0]         
                                                                 block2a_se_expand[0][0]          
__________________________________________________________________________________________________
block2a_project_conv (Conv2D)   (None, 56, 56, 48)   9216        block2a_se_excite[0][0]          
__________________________________________________________________________________________________
block2a_project_bn (BatchNormal (None, 56, 56, 48)   192         block2a_project_conv[0][0]       
__________________________________________________________________________________________________
block2b_expand_conv (Conv2D)    (None, 56, 56, 288)  13824       block2a_project_bn[0][0]         
__________________________________________________________________________________________________
block2b_expand_bn (BatchNormali (None, 56, 56, 288)  1152        block2b_expand_conv[0][0]        
__________________________________________________________________________________________________
block2b_expand_activation (Acti (None, 56, 56, 288)  0           block2b_expand_bn[0][0]          
__________________________________________________________________________________________________
block2b_dwconv (DepthwiseConv2D (None, 56, 56, 288)  2592        block2b_expand_activation[0][0]  
__________________________________________________________________________________________________
block2b_bn (BatchNormalization) (None, 56, 56, 288)  1152        block2b_dwconv[0][0]             
__________________________________________________________________________________________________
block2b_activation (Activation) (None, 56, 56, 288)  0           block2b_bn[0][0]                 
__________________________________________________________________________________________________
block2b_se_squeeze (GlobalAvera (None, 288)          0           block2b_activation[0][0]         
__________________________________________________________________________________________________
block2b_se_reshape (Reshape)    (None, 1, 1, 288)    0           block2b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2b_se_reduce (Conv2D)      (None, 1, 1, 12)     3468        block2b_se_reshape[0][0]         
__________________________________________________________________________________________________
block2b_se_expand (Conv2D)      (None, 1, 1, 288)    3744        block2b_se_reduce[0][0]          
__________________________________________________________________________________________________
block2b_se_excite (Multiply)    (None, 56, 56, 288)  0           block2b_activation[0][0]         
                                                                 block2b_se_expand[0][0]          
__________________________________________________________________________________________________
block2b_project_conv (Conv2D)   (None, 56, 56, 48)   13824       block2b_se_excite[0][0]          
__________________________________________________________________________________________________
block2b_project_bn (BatchNormal (None, 56, 56, 48)   192         block2b_project_conv[0][0]       
__________________________________________________________________________________________________
block2b_drop (Dropout)          (None, 56, 56, 48)   0           block2b_project_bn[0][0]         
__________________________________________________________________________________________________
block2b_add (Add)               (None, 56, 56, 48)   0           block2b_drop[0][0]               
                                                                 block2a_project_bn[0][0]         
__________________________________________________________________________________________________
block2c_expand_conv (Conv2D)    (None, 56, 56, 288)  13824       block2b_add[0][0]                
__________________________________________________________________________________________________
block2c_expand_bn (BatchNormali (None, 56, 56, 288)  1152        block2c_expand_conv[0][0]        
__________________________________________________________________________________________________
block2c_expand_activation (Acti (None, 56, 56, 288)  0           block2c_expand_bn[0][0]          
__________________________________________________________________________________________________
block2c_dwconv (DepthwiseConv2D (None, 56, 56, 288)  2592        block2c_expand_activation[0][0]  
__________________________________________________________________________________________________
block2c_bn (BatchNormalization) (None, 56, 56, 288)  1152        block2c_dwconv[0][0]             
__________________________________________________________________________________________________
block2c_activation (Activation) (None, 56, 56, 288)  0           block2c_bn[0][0]                 
__________________________________________________________________________________________________
block2c_se_squeeze (GlobalAvera (None, 288)          0           block2c_activation[0][0]         
__________________________________________________________________________________________________
block2c_se_reshape (Reshape)    (None, 1, 1, 288)    0           block2c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2c_se_reduce (Conv2D)      (None, 1, 1, 12)     3468        block2c_se_reshape[0][0]         
__________________________________________________________________________________________________
block2c_se_expand (Conv2D)      (None, 1, 1, 288)    3744        block2c_se_reduce[0][0]          
__________________________________________________________________________________________________
block2c_se_excite (Multiply)    (None, 56, 56, 288)  0           block2c_activation[0][0]         
                                                                 block2c_se_expand[0][0]          
__________________________________________________________________________________________________
block2c_project_conv (Conv2D)   (None, 56, 56, 48)   13824       block2c_se_excite[0][0]          
__________________________________________________________________________________________________
block2c_project_bn (BatchNormal (None, 56, 56, 48)   192         block2c_project_conv[0][0]       
__________________________________________________________________________________________________
block2c_drop (Dropout)          (None, 56, 56, 48)   0           block2c_project_bn[0][0]         
__________________________________________________________________________________________________
block2c_add (Add)               (None, 56, 56, 48)   0           block2c_drop[0][0]               
                                                                 block2b_add[0][0]                
__________________________________________________________________________________________________
block2d_expand_conv (Conv2D)    (None, 56, 56, 288)  13824       block2c_add[0][0]                
__________________________________________________________________________________________________
block2d_expand_bn (BatchNormali (None, 56, 56, 288)  1152        block2d_expand_conv[0][0]        
__________________________________________________________________________________________________
block2d_expand_activation (Acti (None, 56, 56, 288)  0           block2d_expand_bn[0][0]          
__________________________________________________________________________________________________
block2d_dwconv (DepthwiseConv2D (None, 56, 56, 288)  2592        block2d_expand_activation[0][0]  
__________________________________________________________________________________________________
block2d_bn (BatchNormalization) (None, 56, 56, 288)  1152        block2d_dwconv[0][0]             
__________________________________________________________________________________________________
block2d_activation (Activation) (None, 56, 56, 288)  0           block2d_bn[0][0]                 
__________________________________________________________________________________________________
block2d_se_squeeze (GlobalAvera (None, 288)          0           block2d_activation[0][0]         
__________________________________________________________________________________________________
block2d_se_reshape (Reshape)    (None, 1, 1, 288)    0           block2d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2d_se_reduce (Conv2D)      (None, 1, 1, 12)     3468        block2d_se_reshape[0][0]         
__________________________________________________________________________________________________
block2d_se_expand (Conv2D)      (None, 1, 1, 288)    3744        block2d_se_reduce[0][0]          
__________________________________________________________________________________________________
block2d_se_excite (Multiply)    (None, 56, 56, 288)  0           block2d_activation[0][0]         
                                                                 block2d_se_expand[0][0]          
__________________________________________________________________________________________________
block2d_project_conv (Conv2D)   (None, 56, 56, 48)   13824       block2d_se_excite[0][0]          
__________________________________________________________________________________________________
block2d_project_bn (BatchNormal (None, 56, 56, 48)   192         block2d_project_conv[0][0]       
__________________________________________________________________________________________________
block2d_drop (Dropout)          (None, 56, 56, 48)   0           block2d_project_bn[0][0]         
__________________________________________________________________________________________________
block2d_add (Add)               (None, 56, 56, 48)   0           block2d_drop[0][0]               
                                                                 block2c_add[0][0]                
__________________________________________________________________________________________________
block2e_expand_conv (Conv2D)    (None, 56, 56, 288)  13824       block2d_add[0][0]                
__________________________________________________________________________________________________
block2e_expand_bn (BatchNormali (None, 56, 56, 288)  1152        block2e_expand_conv[0][0]        
__________________________________________________________________________________________________
block2e_expand_activation (Acti (None, 56, 56, 288)  0           block2e_expand_bn[0][0]          
__________________________________________________________________________________________________
block2e_dwconv (DepthwiseConv2D (None, 56, 56, 288)  2592        block2e_expand_activation[0][0]  
__________________________________________________________________________________________________
block2e_bn (BatchNormalization) (None, 56, 56, 288)  1152        block2e_dwconv[0][0]             
__________________________________________________________________________________________________
block2e_activation (Activation) (None, 56, 56, 288)  0           block2e_bn[0][0]                 
__________________________________________________________________________________________________
block2e_se_squeeze (GlobalAvera (None, 288)          0           block2e_activation[0][0]         
__________________________________________________________________________________________________
block2e_se_reshape (Reshape)    (None, 1, 1, 288)    0           block2e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2e_se_reduce (Conv2D)      (None, 1, 1, 12)     3468        block2e_se_reshape[0][0]         
__________________________________________________________________________________________________
block2e_se_expand (Conv2D)      (None, 1, 1, 288)    3744        block2e_se_reduce[0][0]          
__________________________________________________________________________________________________
block2e_se_excite (Multiply)    (None, 56, 56, 288)  0           block2e_activation[0][0]         
                                                                 block2e_se_expand[0][0]          
__________________________________________________________________________________________________
block2e_project_conv (Conv2D)   (None, 56, 56, 48)   13824       block2e_se_excite[0][0]          
__________________________________________________________________________________________________
block2e_project_bn (BatchNormal (None, 56, 56, 48)   192         block2e_project_conv[0][0]       
__________________________________________________________________________________________________
block2e_drop (Dropout)          (None, 56, 56, 48)   0           block2e_project_bn[0][0]         
__________________________________________________________________________________________________
block2e_add (Add)               (None, 56, 56, 48)   0           block2e_drop[0][0]               
                                                                 block2d_add[0][0]                
__________________________________________________________________________________________________
block2f_expand_conv (Conv2D)    (None, 56, 56, 288)  13824       block2e_add[0][0]                
__________________________________________________________________________________________________
block2f_expand_bn (BatchNormali (None, 56, 56, 288)  1152        block2f_expand_conv[0][0]        
__________________________________________________________________________________________________
block2f_expand_activation (Acti (None, 56, 56, 288)  0           block2f_expand_bn[0][0]          
__________________________________________________________________________________________________
block2f_dwconv (DepthwiseConv2D (None, 56, 56, 288)  2592        block2f_expand_activation[0][0]  
__________________________________________________________________________________________________
block2f_bn (BatchNormalization) (None, 56, 56, 288)  1152        block2f_dwconv[0][0]             
__________________________________________________________________________________________________
block2f_activation (Activation) (None, 56, 56, 288)  0           block2f_bn[0][0]                 
__________________________________________________________________________________________________
block2f_se_squeeze (GlobalAvera (None, 288)          0           block2f_activation[0][0]         
__________________________________________________________________________________________________
block2f_se_reshape (Reshape)    (None, 1, 1, 288)    0           block2f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2f_se_reduce (Conv2D)      (None, 1, 1, 12)     3468        block2f_se_reshape[0][0]         
__________________________________________________________________________________________________
block2f_se_expand (Conv2D)      (None, 1, 1, 288)    3744        block2f_se_reduce[0][0]          
__________________________________________________________________________________________________
block2f_se_excite (Multiply)    (None, 56, 56, 288)  0           block2f_activation[0][0]         
                                                                 block2f_se_expand[0][0]          
__________________________________________________________________________________________________
block2f_project_conv (Conv2D)   (None, 56, 56, 48)   13824       block2f_se_excite[0][0]          
__________________________________________________________________________________________________
block2f_project_bn (BatchNormal (None, 56, 56, 48)   192         block2f_project_conv[0][0]       
__________________________________________________________________________________________________
block2f_drop (Dropout)          (None, 56, 56, 48)   0           block2f_project_bn[0][0]         
__________________________________________________________________________________________________
block2f_add (Add)               (None, 56, 56, 48)   0           block2f_drop[0][0]               
                                                                 block2e_add[0][0]                
__________________________________________________________________________________________________
block2g_expand_conv (Conv2D)    (None, 56, 56, 288)  13824       block2f_add[0][0]                
__________________________________________________________________________________________________
block2g_expand_bn (BatchNormali (None, 56, 56, 288)  1152        block2g_expand_conv[0][0]        
__________________________________________________________________________________________________
block2g_expand_activation (Acti (None, 56, 56, 288)  0           block2g_expand_bn[0][0]          
__________________________________________________________________________________________________
block2g_dwconv (DepthwiseConv2D (None, 56, 56, 288)  2592        block2g_expand_activation[0][0]  
__________________________________________________________________________________________________
block2g_bn (BatchNormalization) (None, 56, 56, 288)  1152        block2g_dwconv[0][0]             
__________________________________________________________________________________________________
block2g_activation (Activation) (None, 56, 56, 288)  0           block2g_bn[0][0]                 
__________________________________________________________________________________________________
block2g_se_squeeze (GlobalAvera (None, 288)          0           block2g_activation[0][0]         
__________________________________________________________________________________________________
block2g_se_reshape (Reshape)    (None, 1, 1, 288)    0           block2g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2g_se_reduce (Conv2D)      (None, 1, 1, 12)     3468        block2g_se_reshape[0][0]         
__________________________________________________________________________________________________
block2g_se_expand (Conv2D)      (None, 1, 1, 288)    3744        block2g_se_reduce[0][0]          
__________________________________________________________________________________________________
block2g_se_excite (Multiply)    (None, 56, 56, 288)  0           block2g_activation[0][0]         
                                                                 block2g_se_expand[0][0]          
__________________________________________________________________________________________________
block2g_project_conv (Conv2D)   (None, 56, 56, 48)   13824       block2g_se_excite[0][0]          
__________________________________________________________________________________________________
block2g_project_bn (BatchNormal (None, 56, 56, 48)   192         block2g_project_conv[0][0]       
__________________________________________________________________________________________________
block2g_drop (Dropout)          (None, 56, 56, 48)   0           block2g_project_bn[0][0]         
__________________________________________________________________________________________________
block2g_add (Add)               (None, 56, 56, 48)   0           block2g_drop[0][0]               
                                                                 block2f_add[0][0]                
__________________________________________________________________________________________________
block3a_expand_conv (Conv2D)    (None, 56, 56, 288)  13824       block2g_add[0][0]                
__________________________________________________________________________________________________
block3a_expand_bn (BatchNormali (None, 56, 56, 288)  1152        block3a_expand_conv[0][0]        
__________________________________________________________________________________________________
block3a_expand_activation (Acti (None, 56, 56, 288)  0           block3a_expand_bn[0][0]          
__________________________________________________________________________________________________
block3a_dwconv_pad (ZeroPadding (None, 59, 59, 288)  0           block3a_expand_activation[0][0]  
__________________________________________________________________________________________________
block3a_dwconv (DepthwiseConv2D (None, 28, 28, 288)  7200        block3a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block3a_bn (BatchNormalization) (None, 28, 28, 288)  1152        block3a_dwconv[0][0]             
__________________________________________________________________________________________________
block3a_activation (Activation) (None, 28, 28, 288)  0           block3a_bn[0][0]                 
__________________________________________________________________________________________________
block3a_se_squeeze (GlobalAvera (None, 288)          0           block3a_activation[0][0]         
__________________________________________________________________________________________________
block3a_se_reshape (Reshape)    (None, 1, 1, 288)    0           block3a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3a_se_reduce (Conv2D)      (None, 1, 1, 12)     3468        block3a_se_reshape[0][0]         
__________________________________________________________________________________________________
block3a_se_expand (Conv2D)      (None, 1, 1, 288)    3744        block3a_se_reduce[0][0]          
__________________________________________________________________________________________________
block3a_se_excite (Multiply)    (None, 28, 28, 288)  0           block3a_activation[0][0]         
                                                                 block3a_se_expand[0][0]          
__________________________________________________________________________________________________
block3a_project_conv (Conv2D)   (None, 28, 28, 80)   23040       block3a_se_excite[0][0]          
__________________________________________________________________________________________________
block3a_project_bn (BatchNormal (None, 28, 28, 80)   320         block3a_project_conv[0][0]       
__________________________________________________________________________________________________
block3b_expand_conv (Conv2D)    (None, 28, 28, 480)  38400       block3a_project_bn[0][0]         
__________________________________________________________________________________________________
block3b_expand_bn (BatchNormali (None, 28, 28, 480)  1920        block3b_expand_conv[0][0]        
__________________________________________________________________________________________________
block3b_expand_activation (Acti (None, 28, 28, 480)  0           block3b_expand_bn[0][0]          
__________________________________________________________________________________________________
block3b_dwconv (DepthwiseConv2D (None, 28, 28, 480)  12000       block3b_expand_activation[0][0]  
__________________________________________________________________________________________________
block3b_bn (BatchNormalization) (None, 28, 28, 480)  1920        block3b_dwconv[0][0]             
__________________________________________________________________________________________________
block3b_activation (Activation) (None, 28, 28, 480)  0           block3b_bn[0][0]                 
__________________________________________________________________________________________________
block3b_se_squeeze (GlobalAvera (None, 480)          0           block3b_activation[0][0]         
__________________________________________________________________________________________________
block3b_se_reshape (Reshape)    (None, 1, 1, 480)    0           block3b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3b_se_reduce (Conv2D)      (None, 1, 1, 20)     9620        block3b_se_reshape[0][0]         
__________________________________________________________________________________________________
block3b_se_expand (Conv2D)      (None, 1, 1, 480)    10080       block3b_se_reduce[0][0]          
__________________________________________________________________________________________________
block3b_se_excite (Multiply)    (None, 28, 28, 480)  0           block3b_activation[0][0]         
                                                                 block3b_se_expand[0][0]          
__________________________________________________________________________________________________
block3b_project_conv (Conv2D)   (None, 28, 28, 80)   38400       block3b_se_excite[0][0]          
__________________________________________________________________________________________________
block3b_project_bn (BatchNormal (None, 28, 28, 80)   320         block3b_project_conv[0][0]       
__________________________________________________________________________________________________
block3b_drop (Dropout)          (None, 28, 28, 80)   0           block3b_project_bn[0][0]         
__________________________________________________________________________________________________
block3b_add (Add)               (None, 28, 28, 80)   0           block3b_drop[0][0]               
                                                                 block3a_project_bn[0][0]         
__________________________________________________________________________________________________
block3c_expand_conv (Conv2D)    (None, 28, 28, 480)  38400       block3b_add[0][0]                
__________________________________________________________________________________________________
block3c_expand_bn (BatchNormali (None, 28, 28, 480)  1920        block3c_expand_conv[0][0]        
__________________________________________________________________________________________________
block3c_expand_activation (Acti (None, 28, 28, 480)  0           block3c_expand_bn[0][0]          
__________________________________________________________________________________________________
block3c_dwconv (DepthwiseConv2D (None, 28, 28, 480)  12000       block3c_expand_activation[0][0]  
__________________________________________________________________________________________________
block3c_bn (BatchNormalization) (None, 28, 28, 480)  1920        block3c_dwconv[0][0]             
__________________________________________________________________________________________________
block3c_activation (Activation) (None, 28, 28, 480)  0           block3c_bn[0][0]                 
__________________________________________________________________________________________________
block3c_se_squeeze (GlobalAvera (None, 480)          0           block3c_activation[0][0]         
__________________________________________________________________________________________________
block3c_se_reshape (Reshape)    (None, 1, 1, 480)    0           block3c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3c_se_reduce (Conv2D)      (None, 1, 1, 20)     9620        block3c_se_reshape[0][0]         
__________________________________________________________________________________________________
block3c_se_expand (Conv2D)      (None, 1, 1, 480)    10080       block3c_se_reduce[0][0]          
__________________________________________________________________________________________________
block3c_se_excite (Multiply)    (None, 28, 28, 480)  0           block3c_activation[0][0]         
                                                                 block3c_se_expand[0][0]          
__________________________________________________________________________________________________
block3c_project_conv (Conv2D)   (None, 28, 28, 80)   38400       block3c_se_excite[0][0]          
__________________________________________________________________________________________________
block3c_project_bn (BatchNormal (None, 28, 28, 80)   320         block3c_project_conv[0][0]       
__________________________________________________________________________________________________
block3c_drop (Dropout)          (None, 28, 28, 80)   0           block3c_project_bn[0][0]         
__________________________________________________________________________________________________
block3c_add (Add)               (None, 28, 28, 80)   0           block3c_drop[0][0]               
                                                                 block3b_add[0][0]                
__________________________________________________________________________________________________
block3d_expand_conv (Conv2D)    (None, 28, 28, 480)  38400       block3c_add[0][0]                
__________________________________________________________________________________________________
block3d_expand_bn (BatchNormali (None, 28, 28, 480)  1920        block3d_expand_conv[0][0]        
__________________________________________________________________________________________________
block3d_expand_activation (Acti (None, 28, 28, 480)  0           block3d_expand_bn[0][0]          
__________________________________________________________________________________________________
block3d_dwconv (DepthwiseConv2D (None, 28, 28, 480)  12000       block3d_expand_activation[0][0]  
__________________________________________________________________________________________________
block3d_bn (BatchNormalization) (None, 28, 28, 480)  1920        block3d_dwconv[0][0]             
__________________________________________________________________________________________________
block3d_activation (Activation) (None, 28, 28, 480)  0           block3d_bn[0][0]                 
__________________________________________________________________________________________________
block3d_se_squeeze (GlobalAvera (None, 480)          0           block3d_activation[0][0]         
__________________________________________________________________________________________________
block3d_se_reshape (Reshape)    (None, 1, 1, 480)    0           block3d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3d_se_reduce (Conv2D)      (None, 1, 1, 20)     9620        block3d_se_reshape[0][0]         
__________________________________________________________________________________________________
block3d_se_expand (Conv2D)      (None, 1, 1, 480)    10080       block3d_se_reduce[0][0]          
__________________________________________________________________________________________________
block3d_se_excite (Multiply)    (None, 28, 28, 480)  0           block3d_activation[0][0]         
                                                                 block3d_se_expand[0][0]          
__________________________________________________________________________________________________
block3d_project_conv (Conv2D)   (None, 28, 28, 80)   38400       block3d_se_excite[0][0]          
__________________________________________________________________________________________________
block3d_project_bn (BatchNormal (None, 28, 28, 80)   320         block3d_project_conv[0][0]       
__________________________________________________________________________________________________
block3d_drop (Dropout)          (None, 28, 28, 80)   0           block3d_project_bn[0][0]         
__________________________________________________________________________________________________
block3d_add (Add)               (None, 28, 28, 80)   0           block3d_drop[0][0]               
                                                                 block3c_add[0][0]                
__________________________________________________________________________________________________
block3e_expand_conv (Conv2D)    (None, 28, 28, 480)  38400       block3d_add[0][0]                
__________________________________________________________________________________________________
block3e_expand_bn (BatchNormali (None, 28, 28, 480)  1920        block3e_expand_conv[0][0]        
__________________________________________________________________________________________________
block3e_expand_activation (Acti (None, 28, 28, 480)  0           block3e_expand_bn[0][0]          
__________________________________________________________________________________________________
block3e_dwconv (DepthwiseConv2D (None, 28, 28, 480)  12000       block3e_expand_activation[0][0]  
__________________________________________________________________________________________________
block3e_bn (BatchNormalization) (None, 28, 28, 480)  1920        block3e_dwconv[0][0]             
__________________________________________________________________________________________________
block3e_activation (Activation) (None, 28, 28, 480)  0           block3e_bn[0][0]                 
__________________________________________________________________________________________________
block3e_se_squeeze (GlobalAvera (None, 480)          0           block3e_activation[0][0]         
__________________________________________________________________________________________________
block3e_se_reshape (Reshape)    (None, 1, 1, 480)    0           block3e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3e_se_reduce (Conv2D)      (None, 1, 1, 20)     9620        block3e_se_reshape[0][0]         
__________________________________________________________________________________________________
block3e_se_expand (Conv2D)      (None, 1, 1, 480)    10080       block3e_se_reduce[0][0]          
__________________________________________________________________________________________________
block3e_se_excite (Multiply)    (None, 28, 28, 480)  0           block3e_activation[0][0]         
                                                                 block3e_se_expand[0][0]          
__________________________________________________________________________________________________
block3e_project_conv (Conv2D)   (None, 28, 28, 80)   38400       block3e_se_excite[0][0]          
__________________________________________________________________________________________________
block3e_project_bn (BatchNormal (None, 28, 28, 80)   320         block3e_project_conv[0][0]       
__________________________________________________________________________________________________
block3e_drop (Dropout)          (None, 28, 28, 80)   0           block3e_project_bn[0][0]         
__________________________________________________________________________________________________
block3e_add (Add)               (None, 28, 28, 80)   0           block3e_drop[0][0]               
                                                                 block3d_add[0][0]                
__________________________________________________________________________________________________
block3f_expand_conv (Conv2D)    (None, 28, 28, 480)  38400       block3e_add[0][0]                
__________________________________________________________________________________________________
block3f_expand_bn (BatchNormali (None, 28, 28, 480)  1920        block3f_expand_conv[0][0]        
__________________________________________________________________________________________________
block3f_expand_activation (Acti (None, 28, 28, 480)  0           block3f_expand_bn[0][0]          
__________________________________________________________________________________________________
block3f_dwconv (DepthwiseConv2D (None, 28, 28, 480)  12000       block3f_expand_activation[0][0]  
__________________________________________________________________________________________________
block3f_bn (BatchNormalization) (None, 28, 28, 480)  1920        block3f_dwconv[0][0]             
__________________________________________________________________________________________________
block3f_activation (Activation) (None, 28, 28, 480)  0           block3f_bn[0][0]                 
__________________________________________________________________________________________________
block3f_se_squeeze (GlobalAvera (None, 480)          0           block3f_activation[0][0]         
__________________________________________________________________________________________________
block3f_se_reshape (Reshape)    (None, 1, 1, 480)    0           block3f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3f_se_reduce (Conv2D)      (None, 1, 1, 20)     9620        block3f_se_reshape[0][0]         
__________________________________________________________________________________________________
block3f_se_expand (Conv2D)      (None, 1, 1, 480)    10080       block3f_se_reduce[0][0]          
__________________________________________________________________________________________________
block3f_se_excite (Multiply)    (None, 28, 28, 480)  0           block3f_activation[0][0]         
                                                                 block3f_se_expand[0][0]          
__________________________________________________________________________________________________
block3f_project_conv (Conv2D)   (None, 28, 28, 80)   38400       block3f_se_excite[0][0]          
__________________________________________________________________________________________________
block3f_project_bn (BatchNormal (None, 28, 28, 80)   320         block3f_project_conv[0][0]       
__________________________________________________________________________________________________
block3f_drop (Dropout)          (None, 28, 28, 80)   0           block3f_project_bn[0][0]         
__________________________________________________________________________________________________
block3f_add (Add)               (None, 28, 28, 80)   0           block3f_drop[0][0]               
                                                                 block3e_add[0][0]                
__________________________________________________________________________________________________
block3g_expand_conv (Conv2D)    (None, 28, 28, 480)  38400       block3f_add[0][0]                
__________________________________________________________________________________________________
block3g_expand_bn (BatchNormali (None, 28, 28, 480)  1920        block3g_expand_conv[0][0]        
__________________________________________________________________________________________________
block3g_expand_activation (Acti (None, 28, 28, 480)  0           block3g_expand_bn[0][0]          
__________________________________________________________________________________________________
block3g_dwconv (DepthwiseConv2D (None, 28, 28, 480)  12000       block3g_expand_activation[0][0]  
__________________________________________________________________________________________________
block3g_bn (BatchNormalization) (None, 28, 28, 480)  1920        block3g_dwconv[0][0]             
__________________________________________________________________________________________________
block3g_activation (Activation) (None, 28, 28, 480)  0           block3g_bn[0][0]                 
__________________________________________________________________________________________________
block3g_se_squeeze (GlobalAvera (None, 480)          0           block3g_activation[0][0]         
__________________________________________________________________________________________________
block3g_se_reshape (Reshape)    (None, 1, 1, 480)    0           block3g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3g_se_reduce (Conv2D)      (None, 1, 1, 20)     9620        block3g_se_reshape[0][0]         
__________________________________________________________________________________________________
block3g_se_expand (Conv2D)      (None, 1, 1, 480)    10080       block3g_se_reduce[0][0]          
__________________________________________________________________________________________________
block3g_se_excite (Multiply)    (None, 28, 28, 480)  0           block3g_activation[0][0]         
                                                                 block3g_se_expand[0][0]          
__________________________________________________________________________________________________
block3g_project_conv (Conv2D)   (None, 28, 28, 80)   38400       block3g_se_excite[0][0]          
__________________________________________________________________________________________________
block3g_project_bn (BatchNormal (None, 28, 28, 80)   320         block3g_project_conv[0][0]       
__________________________________________________________________________________________________
block3g_drop (Dropout)          (None, 28, 28, 80)   0           block3g_project_bn[0][0]         
__________________________________________________________________________________________________
block3g_add (Add)               (None, 28, 28, 80)   0           block3g_drop[0][0]               
                                                                 block3f_add[0][0]                
__________________________________________________________________________________________________
block4a_expand_conv (Conv2D)    (None, 28, 28, 480)  38400       block3g_add[0][0]                
__________________________________________________________________________________________________
block4a_expand_bn (BatchNormali (None, 28, 28, 480)  1920        block4a_expand_conv[0][0]        
__________________________________________________________________________________________________
block4a_expand_activation (Acti (None, 28, 28, 480)  0           block4a_expand_bn[0][0]          
__________________________________________________________________________________________________
block4a_dwconv_pad (ZeroPadding (None, 29, 29, 480)  0           block4a_expand_activation[0][0]  
__________________________________________________________________________________________________
block4a_dwconv (DepthwiseConv2D (None, 14, 14, 480)  4320        block4a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block4a_bn (BatchNormalization) (None, 14, 14, 480)  1920        block4a_dwconv[0][0]             
__________________________________________________________________________________________________
block4a_activation (Activation) (None, 14, 14, 480)  0           block4a_bn[0][0]                 
__________________________________________________________________________________________________
block4a_se_squeeze (GlobalAvera (None, 480)          0           block4a_activation[0][0]         
__________________________________________________________________________________________________
block4a_se_reshape (Reshape)    (None, 1, 1, 480)    0           block4a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4a_se_reduce (Conv2D)      (None, 1, 1, 20)     9620        block4a_se_reshape[0][0]         
__________________________________________________________________________________________________
block4a_se_expand (Conv2D)      (None, 1, 1, 480)    10080       block4a_se_reduce[0][0]          
__________________________________________________________________________________________________
block4a_se_excite (Multiply)    (None, 14, 14, 480)  0           block4a_activation[0][0]         
                                                                 block4a_se_expand[0][0]          
__________________________________________________________________________________________________
block4a_project_conv (Conv2D)   (None, 14, 14, 160)  76800       block4a_se_excite[0][0]          
__________________________________________________________________________________________________
block4a_project_bn (BatchNormal (None, 14, 14, 160)  640         block4a_project_conv[0][0]       
__________________________________________________________________________________________________
block4b_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4a_project_bn[0][0]         
__________________________________________________________________________________________________
block4b_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4b_expand_conv[0][0]        
__________________________________________________________________________________________________
block4b_expand_activation (Acti (None, 14, 14, 960)  0           block4b_expand_bn[0][0]          
__________________________________________________________________________________________________
block4b_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4b_expand_activation[0][0]  
__________________________________________________________________________________________________
block4b_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4b_dwconv[0][0]             
__________________________________________________________________________________________________
block4b_activation (Activation) (None, 14, 14, 960)  0           block4b_bn[0][0]                 
__________________________________________________________________________________________________
block4b_se_squeeze (GlobalAvera (None, 960)          0           block4b_activation[0][0]         
__________________________________________________________________________________________________
block4b_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4b_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4b_se_reshape[0][0]         
__________________________________________________________________________________________________
block4b_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4b_se_reduce[0][0]          
__________________________________________________________________________________________________
block4b_se_excite (Multiply)    (None, 14, 14, 960)  0           block4b_activation[0][0]         
                                                                 block4b_se_expand[0][0]          
__________________________________________________________________________________________________
block4b_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4b_se_excite[0][0]          
__________________________________________________________________________________________________
block4b_project_bn (BatchNormal (None, 14, 14, 160)  640         block4b_project_conv[0][0]       
__________________________________________________________________________________________________
block4b_drop (Dropout)          (None, 14, 14, 160)  0           block4b_project_bn[0][0]         
__________________________________________________________________________________________________
block4b_add (Add)               (None, 14, 14, 160)  0           block4b_drop[0][0]               
                                                                 block4a_project_bn[0][0]         
__________________________________________________________________________________________________
block4c_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4b_add[0][0]                
__________________________________________________________________________________________________
block4c_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4c_expand_conv[0][0]        
__________________________________________________________________________________________________
block4c_expand_activation (Acti (None, 14, 14, 960)  0           block4c_expand_bn[0][0]          
__________________________________________________________________________________________________
block4c_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4c_expand_activation[0][0]  
__________________________________________________________________________________________________
block4c_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4c_dwconv[0][0]             
__________________________________________________________________________________________________
block4c_activation (Activation) (None, 14, 14, 960)  0           block4c_bn[0][0]                 
__________________________________________________________________________________________________
block4c_se_squeeze (GlobalAvera (None, 960)          0           block4c_activation[0][0]         
__________________________________________________________________________________________________
block4c_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4c_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4c_se_reshape[0][0]         
__________________________________________________________________________________________________
block4c_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4c_se_reduce[0][0]          
__________________________________________________________________________________________________
block4c_se_excite (Multiply)    (None, 14, 14, 960)  0           block4c_activation[0][0]         
                                                                 block4c_se_expand[0][0]          
__________________________________________________________________________________________________
block4c_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4c_se_excite[0][0]          
__________________________________________________________________________________________________
block4c_project_bn (BatchNormal (None, 14, 14, 160)  640         block4c_project_conv[0][0]       
__________________________________________________________________________________________________
block4c_drop (Dropout)          (None, 14, 14, 160)  0           block4c_project_bn[0][0]         
__________________________________________________________________________________________________
block4c_add (Add)               (None, 14, 14, 160)  0           block4c_drop[0][0]               
                                                                 block4b_add[0][0]                
__________________________________________________________________________________________________
block4d_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4c_add[0][0]                
__________________________________________________________________________________________________
block4d_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4d_expand_conv[0][0]        
__________________________________________________________________________________________________
block4d_expand_activation (Acti (None, 14, 14, 960)  0           block4d_expand_bn[0][0]          
__________________________________________________________________________________________________
block4d_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4d_expand_activation[0][0]  
__________________________________________________________________________________________________
block4d_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4d_dwconv[0][0]             
__________________________________________________________________________________________________
block4d_activation (Activation) (None, 14, 14, 960)  0           block4d_bn[0][0]                 
__________________________________________________________________________________________________
block4d_se_squeeze (GlobalAvera (None, 960)          0           block4d_activation[0][0]         
__________________________________________________________________________________________________
block4d_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4d_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4d_se_reshape[0][0]         
__________________________________________________________________________________________________
block4d_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4d_se_reduce[0][0]          
__________________________________________________________________________________________________
block4d_se_excite (Multiply)    (None, 14, 14, 960)  0           block4d_activation[0][0]         
                                                                 block4d_se_expand[0][0]          
__________________________________________________________________________________________________
block4d_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4d_se_excite[0][0]          
__________________________________________________________________________________________________
block4d_project_bn (BatchNormal (None, 14, 14, 160)  640         block4d_project_conv[0][0]       
__________________________________________________________________________________________________
block4d_drop (Dropout)          (None, 14, 14, 160)  0           block4d_project_bn[0][0]         
__________________________________________________________________________________________________
block4d_add (Add)               (None, 14, 14, 160)  0           block4d_drop[0][0]               
                                                                 block4c_add[0][0]                
__________________________________________________________________________________________________
block4e_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4d_add[0][0]                
__________________________________________________________________________________________________
block4e_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4e_expand_conv[0][0]        
__________________________________________________________________________________________________
block4e_expand_activation (Acti (None, 14, 14, 960)  0           block4e_expand_bn[0][0]          
__________________________________________________________________________________________________
block4e_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4e_expand_activation[0][0]  
__________________________________________________________________________________________________
block4e_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4e_dwconv[0][0]             
__________________________________________________________________________________________________
block4e_activation (Activation) (None, 14, 14, 960)  0           block4e_bn[0][0]                 
__________________________________________________________________________________________________
block4e_se_squeeze (GlobalAvera (None, 960)          0           block4e_activation[0][0]         
__________________________________________________________________________________________________
block4e_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4e_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4e_se_reshape[0][0]         
__________________________________________________________________________________________________
block4e_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4e_se_reduce[0][0]          
__________________________________________________________________________________________________
block4e_se_excite (Multiply)    (None, 14, 14, 960)  0           block4e_activation[0][0]         
                                                                 block4e_se_expand[0][0]          
__________________________________________________________________________________________________
block4e_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4e_se_excite[0][0]          
__________________________________________________________________________________________________
block4e_project_bn (BatchNormal (None, 14, 14, 160)  640         block4e_project_conv[0][0]       
__________________________________________________________________________________________________
block4e_drop (Dropout)          (None, 14, 14, 160)  0           block4e_project_bn[0][0]         
__________________________________________________________________________________________________
block4e_add (Add)               (None, 14, 14, 160)  0           block4e_drop[0][0]               
                                                                 block4d_add[0][0]                
__________________________________________________________________________________________________
block4f_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4e_add[0][0]                
__________________________________________________________________________________________________
block4f_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4f_expand_conv[0][0]        
__________________________________________________________________________________________________
block4f_expand_activation (Acti (None, 14, 14, 960)  0           block4f_expand_bn[0][0]          
__________________________________________________________________________________________________
block4f_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4f_expand_activation[0][0]  
__________________________________________________________________________________________________
block4f_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4f_dwconv[0][0]             
__________________________________________________________________________________________________
block4f_activation (Activation) (None, 14, 14, 960)  0           block4f_bn[0][0]                 
__________________________________________________________________________________________________
block4f_se_squeeze (GlobalAvera (None, 960)          0           block4f_activation[0][0]         
__________________________________________________________________________________________________
block4f_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4f_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4f_se_reshape[0][0]         
__________________________________________________________________________________________________
block4f_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4f_se_reduce[0][0]          
__________________________________________________________________________________________________
block4f_se_excite (Multiply)    (None, 14, 14, 960)  0           block4f_activation[0][0]         
                                                                 block4f_se_expand[0][0]          
__________________________________________________________________________________________________
block4f_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4f_se_excite[0][0]          
__________________________________________________________________________________________________
block4f_project_bn (BatchNormal (None, 14, 14, 160)  640         block4f_project_conv[0][0]       
__________________________________________________________________________________________________
block4f_drop (Dropout)          (None, 14, 14, 160)  0           block4f_project_bn[0][0]         
__________________________________________________________________________________________________
block4f_add (Add)               (None, 14, 14, 160)  0           block4f_drop[0][0]               
                                                                 block4e_add[0][0]                
__________________________________________________________________________________________________
block4g_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4f_add[0][0]                
__________________________________________________________________________________________________
block4g_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4g_expand_conv[0][0]        
__________________________________________________________________________________________________
block4g_expand_activation (Acti (None, 14, 14, 960)  0           block4g_expand_bn[0][0]          
__________________________________________________________________________________________________
block4g_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4g_expand_activation[0][0]  
__________________________________________________________________________________________________
block4g_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4g_dwconv[0][0]             
__________________________________________________________________________________________________
block4g_activation (Activation) (None, 14, 14, 960)  0           block4g_bn[0][0]                 
__________________________________________________________________________________________________
block4g_se_squeeze (GlobalAvera (None, 960)          0           block4g_activation[0][0]         
__________________________________________________________________________________________________
block4g_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4g_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4g_se_reshape[0][0]         
__________________________________________________________________________________________________
block4g_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4g_se_reduce[0][0]          
__________________________________________________________________________________________________
block4g_se_excite (Multiply)    (None, 14, 14, 960)  0           block4g_activation[0][0]         
                                                                 block4g_se_expand[0][0]          
__________________________________________________________________________________________________
block4g_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4g_se_excite[0][0]          
__________________________________________________________________________________________________
block4g_project_bn (BatchNormal (None, 14, 14, 160)  640         block4g_project_conv[0][0]       
__________________________________________________________________________________________________
block4g_drop (Dropout)          (None, 14, 14, 160)  0           block4g_project_bn[0][0]         
__________________________________________________________________________________________________
block4g_add (Add)               (None, 14, 14, 160)  0           block4g_drop[0][0]               
                                                                 block4f_add[0][0]                
__________________________________________________________________________________________________
block4h_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4g_add[0][0]                
__________________________________________________________________________________________________
block4h_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4h_expand_conv[0][0]        
__________________________________________________________________________________________________
block4h_expand_activation (Acti (None, 14, 14, 960)  0           block4h_expand_bn[0][0]          
__________________________________________________________________________________________________
block4h_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4h_expand_activation[0][0]  
__________________________________________________________________________________________________
block4h_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4h_dwconv[0][0]             
__________________________________________________________________________________________________
block4h_activation (Activation) (None, 14, 14, 960)  0           block4h_bn[0][0]                 
__________________________________________________________________________________________________
block4h_se_squeeze (GlobalAvera (None, 960)          0           block4h_activation[0][0]         
__________________________________________________________________________________________________
block4h_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4h_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4h_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4h_se_reshape[0][0]         
__________________________________________________________________________________________________
block4h_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4h_se_reduce[0][0]          
__________________________________________________________________________________________________
block4h_se_excite (Multiply)    (None, 14, 14, 960)  0           block4h_activation[0][0]         
                                                                 block4h_se_expand[0][0]          
__________________________________________________________________________________________________
block4h_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4h_se_excite[0][0]          
__________________________________________________________________________________________________
block4h_project_bn (BatchNormal (None, 14, 14, 160)  640         block4h_project_conv[0][0]       
__________________________________________________________________________________________________
block4h_drop (Dropout)          (None, 14, 14, 160)  0           block4h_project_bn[0][0]         
__________________________________________________________________________________________________
block4h_add (Add)               (None, 14, 14, 160)  0           block4h_drop[0][0]               
                                                                 block4g_add[0][0]                
__________________________________________________________________________________________________
block4i_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4h_add[0][0]                
__________________________________________________________________________________________________
block4i_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4i_expand_conv[0][0]        
__________________________________________________________________________________________________
block4i_expand_activation (Acti (None, 14, 14, 960)  0           block4i_expand_bn[0][0]          
__________________________________________________________________________________________________
block4i_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4i_expand_activation[0][0]  
__________________________________________________________________________________________________
block4i_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4i_dwconv[0][0]             
__________________________________________________________________________________________________
block4i_activation (Activation) (None, 14, 14, 960)  0           block4i_bn[0][0]                 
__________________________________________________________________________________________________
block4i_se_squeeze (GlobalAvera (None, 960)          0           block4i_activation[0][0]         
__________________________________________________________________________________________________
block4i_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4i_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4i_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4i_se_reshape[0][0]         
__________________________________________________________________________________________________
block4i_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4i_se_reduce[0][0]          
__________________________________________________________________________________________________
block4i_se_excite (Multiply)    (None, 14, 14, 960)  0           block4i_activation[0][0]         
                                                                 block4i_se_expand[0][0]          
__________________________________________________________________________________________________
block4i_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4i_se_excite[0][0]          
__________________________________________________________________________________________________
block4i_project_bn (BatchNormal (None, 14, 14, 160)  640         block4i_project_conv[0][0]       
__________________________________________________________________________________________________
block4i_drop (Dropout)          (None, 14, 14, 160)  0           block4i_project_bn[0][0]         
__________________________________________________________________________________________________
block4i_add (Add)               (None, 14, 14, 160)  0           block4i_drop[0][0]               
                                                                 block4h_add[0][0]                
__________________________________________________________________________________________________
block4j_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4i_add[0][0]                
__________________________________________________________________________________________________
block4j_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block4j_expand_conv[0][0]        
__________________________________________________________________________________________________
block4j_expand_activation (Acti (None, 14, 14, 960)  0           block4j_expand_bn[0][0]          
__________________________________________________________________________________________________
block4j_dwconv (DepthwiseConv2D (None, 14, 14, 960)  8640        block4j_expand_activation[0][0]  
__________________________________________________________________________________________________
block4j_bn (BatchNormalization) (None, 14, 14, 960)  3840        block4j_dwconv[0][0]             
__________________________________________________________________________________________________
block4j_activation (Activation) (None, 14, 14, 960)  0           block4j_bn[0][0]                 
__________________________________________________________________________________________________
block4j_se_squeeze (GlobalAvera (None, 960)          0           block4j_activation[0][0]         
__________________________________________________________________________________________________
block4j_se_reshape (Reshape)    (None, 1, 1, 960)    0           block4j_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4j_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block4j_se_reshape[0][0]         
__________________________________________________________________________________________________
block4j_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block4j_se_reduce[0][0]          
__________________________________________________________________________________________________
block4j_se_excite (Multiply)    (None, 14, 14, 960)  0           block4j_activation[0][0]         
                                                                 block4j_se_expand[0][0]          
__________________________________________________________________________________________________
block4j_project_conv (Conv2D)   (None, 14, 14, 160)  153600      block4j_se_excite[0][0]          
__________________________________________________________________________________________________
block4j_project_bn (BatchNormal (None, 14, 14, 160)  640         block4j_project_conv[0][0]       
__________________________________________________________________________________________________
block4j_drop (Dropout)          (None, 14, 14, 160)  0           block4j_project_bn[0][0]         
__________________________________________________________________________________________________
block4j_add (Add)               (None, 14, 14, 160)  0           block4j_drop[0][0]               
                                                                 block4i_add[0][0]                
__________________________________________________________________________________________________
block5a_expand_conv (Conv2D)    (None, 14, 14, 960)  153600      block4j_add[0][0]                
__________________________________________________________________________________________________
block5a_expand_bn (BatchNormali (None, 14, 14, 960)  3840        block5a_expand_conv[0][0]        
__________________________________________________________________________________________________
block5a_expand_activation (Acti (None, 14, 14, 960)  0           block5a_expand_bn[0][0]          
__________________________________________________________________________________________________
block5a_dwconv (DepthwiseConv2D (None, 14, 14, 960)  24000       block5a_expand_activation[0][0]  
__________________________________________________________________________________________________
block5a_bn (BatchNormalization) (None, 14, 14, 960)  3840        block5a_dwconv[0][0]             
__________________________________________________________________________________________________
block5a_activation (Activation) (None, 14, 14, 960)  0           block5a_bn[0][0]                 
__________________________________________________________________________________________________
block5a_se_squeeze (GlobalAvera (None, 960)          0           block5a_activation[0][0]         
__________________________________________________________________________________________________
block5a_se_reshape (Reshape)    (None, 1, 1, 960)    0           block5a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5a_se_reduce (Conv2D)      (None, 1, 1, 40)     38440       block5a_se_reshape[0][0]         
__________________________________________________________________________________________________
block5a_se_expand (Conv2D)      (None, 1, 1, 960)    39360       block5a_se_reduce[0][0]          
__________________________________________________________________________________________________
block5a_se_excite (Multiply)    (None, 14, 14, 960)  0           block5a_activation[0][0]         
                                                                 block5a_se_expand[0][0]          
__________________________________________________________________________________________________
block5a_project_conv (Conv2D)   (None, 14, 14, 224)  215040      block5a_se_excite[0][0]          
__________________________________________________________________________________________________
block5a_project_bn (BatchNormal (None, 14, 14, 224)  896         block5a_project_conv[0][0]       
__________________________________________________________________________________________________
block5b_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5a_project_bn[0][0]         
__________________________________________________________________________________________________
block5b_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5b_expand_conv[0][0]        
__________________________________________________________________________________________________
block5b_expand_activation (Acti (None, 14, 14, 1344) 0           block5b_expand_bn[0][0]          
__________________________________________________________________________________________________
block5b_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5b_expand_activation[0][0]  
__________________________________________________________________________________________________
block5b_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5b_dwconv[0][0]             
__________________________________________________________________________________________________
block5b_activation (Activation) (None, 14, 14, 1344) 0           block5b_bn[0][0]                 
__________________________________________________________________________________________________
block5b_se_squeeze (GlobalAvera (None, 1344)         0           block5b_activation[0][0]         
__________________________________________________________________________________________________
block5b_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5b_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5b_se_reshape[0][0]         
__________________________________________________________________________________________________
block5b_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5b_se_reduce[0][0]          
__________________________________________________________________________________________________
block5b_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5b_activation[0][0]         
                                                                 block5b_se_expand[0][0]          
__________________________________________________________________________________________________
block5b_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5b_se_excite[0][0]          
__________________________________________________________________________________________________
block5b_project_bn (BatchNormal (None, 14, 14, 224)  896         block5b_project_conv[0][0]       
__________________________________________________________________________________________________
block5b_drop (Dropout)          (None, 14, 14, 224)  0           block5b_project_bn[0][0]         
__________________________________________________________________________________________________
block5b_add (Add)               (None, 14, 14, 224)  0           block5b_drop[0][0]               
                                                                 block5a_project_bn[0][0]         
__________________________________________________________________________________________________
block5c_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5b_add[0][0]                
__________________________________________________________________________________________________
block5c_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5c_expand_conv[0][0]        
__________________________________________________________________________________________________
block5c_expand_activation (Acti (None, 14, 14, 1344) 0           block5c_expand_bn[0][0]          
__________________________________________________________________________________________________
block5c_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5c_expand_activation[0][0]  
__________________________________________________________________________________________________
block5c_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5c_dwconv[0][0]             
__________________________________________________________________________________________________
block5c_activation (Activation) (None, 14, 14, 1344) 0           block5c_bn[0][0]                 
__________________________________________________________________________________________________
block5c_se_squeeze (GlobalAvera (None, 1344)         0           block5c_activation[0][0]         
__________________________________________________________________________________________________
block5c_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5c_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5c_se_reshape[0][0]         
__________________________________________________________________________________________________
block5c_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5c_se_reduce[0][0]          
__________________________________________________________________________________________________
block5c_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5c_activation[0][0]         
                                                                 block5c_se_expand[0][0]          
__________________________________________________________________________________________________
block5c_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5c_se_excite[0][0]          
__________________________________________________________________________________________________
block5c_project_bn (BatchNormal (None, 14, 14, 224)  896         block5c_project_conv[0][0]       
__________________________________________________________________________________________________
block5c_drop (Dropout)          (None, 14, 14, 224)  0           block5c_project_bn[0][0]         
__________________________________________________________________________________________________
block5c_add (Add)               (None, 14, 14, 224)  0           block5c_drop[0][0]               
                                                                 block5b_add[0][0]                
__________________________________________________________________________________________________
block5d_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5c_add[0][0]                
__________________________________________________________________________________________________
block5d_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5d_expand_conv[0][0]        
__________________________________________________________________________________________________
block5d_expand_activation (Acti (None, 14, 14, 1344) 0           block5d_expand_bn[0][0]          
__________________________________________________________________________________________________
block5d_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5d_expand_activation[0][0]  
__________________________________________________________________________________________________
block5d_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5d_dwconv[0][0]             
__________________________________________________________________________________________________
block5d_activation (Activation) (None, 14, 14, 1344) 0           block5d_bn[0][0]                 
__________________________________________________________________________________________________
block5d_se_squeeze (GlobalAvera (None, 1344)         0           block5d_activation[0][0]         
__________________________________________________________________________________________________
block5d_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5d_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5d_se_reshape[0][0]         
__________________________________________________________________________________________________
block5d_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5d_se_reduce[0][0]          
__________________________________________________________________________________________________
block5d_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5d_activation[0][0]         
                                                                 block5d_se_expand[0][0]          
__________________________________________________________________________________________________
block5d_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5d_se_excite[0][0]          
__________________________________________________________________________________________________
block5d_project_bn (BatchNormal (None, 14, 14, 224)  896         block5d_project_conv[0][0]       
__________________________________________________________________________________________________
block5d_drop (Dropout)          (None, 14, 14, 224)  0           block5d_project_bn[0][0]         
__________________________________________________________________________________________________
block5d_add (Add)               (None, 14, 14, 224)  0           block5d_drop[0][0]               
                                                                 block5c_add[0][0]                
__________________________________________________________________________________________________
block5e_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5d_add[0][0]                
__________________________________________________________________________________________________
block5e_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5e_expand_conv[0][0]        
__________________________________________________________________________________________________
block5e_expand_activation (Acti (None, 14, 14, 1344) 0           block5e_expand_bn[0][0]          
__________________________________________________________________________________________________
block5e_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5e_expand_activation[0][0]  
__________________________________________________________________________________________________
block5e_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5e_dwconv[0][0]             
__________________________________________________________________________________________________
block5e_activation (Activation) (None, 14, 14, 1344) 0           block5e_bn[0][0]                 
__________________________________________________________________________________________________
block5e_se_squeeze (GlobalAvera (None, 1344)         0           block5e_activation[0][0]         
__________________________________________________________________________________________________
block5e_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5e_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5e_se_reshape[0][0]         
__________________________________________________________________________________________________
block5e_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5e_se_reduce[0][0]          
__________________________________________________________________________________________________
block5e_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5e_activation[0][0]         
                                                                 block5e_se_expand[0][0]          
__________________________________________________________________________________________________
block5e_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5e_se_excite[0][0]          
__________________________________________________________________________________________________
block5e_project_bn (BatchNormal (None, 14, 14, 224)  896         block5e_project_conv[0][0]       
__________________________________________________________________________________________________
block5e_drop (Dropout)          (None, 14, 14, 224)  0           block5e_project_bn[0][0]         
__________________________________________________________________________________________________
block5e_add (Add)               (None, 14, 14, 224)  0           block5e_drop[0][0]               
                                                                 block5d_add[0][0]                
__________________________________________________________________________________________________
block5f_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5e_add[0][0]                
__________________________________________________________________________________________________
block5f_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5f_expand_conv[0][0]        
__________________________________________________________________________________________________
block5f_expand_activation (Acti (None, 14, 14, 1344) 0           block5f_expand_bn[0][0]          
__________________________________________________________________________________________________
block5f_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5f_expand_activation[0][0]  
__________________________________________________________________________________________________
block5f_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5f_dwconv[0][0]             
__________________________________________________________________________________________________
block5f_activation (Activation) (None, 14, 14, 1344) 0           block5f_bn[0][0]                 
__________________________________________________________________________________________________
block5f_se_squeeze (GlobalAvera (None, 1344)         0           block5f_activation[0][0]         
__________________________________________________________________________________________________
block5f_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5f_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5f_se_reshape[0][0]         
__________________________________________________________________________________________________
block5f_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5f_se_reduce[0][0]          
__________________________________________________________________________________________________
block5f_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5f_activation[0][0]         
                                                                 block5f_se_expand[0][0]          
__________________________________________________________________________________________________
block5f_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5f_se_excite[0][0]          
__________________________________________________________________________________________________
block5f_project_bn (BatchNormal (None, 14, 14, 224)  896         block5f_project_conv[0][0]       
__________________________________________________________________________________________________
block5f_drop (Dropout)          (None, 14, 14, 224)  0           block5f_project_bn[0][0]         
__________________________________________________________________________________________________
block5f_add (Add)               (None, 14, 14, 224)  0           block5f_drop[0][0]               
                                                                 block5e_add[0][0]                
__________________________________________________________________________________________________
block5g_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5f_add[0][0]                
__________________________________________________________________________________________________
block5g_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5g_expand_conv[0][0]        
__________________________________________________________________________________________________
block5g_expand_activation (Acti (None, 14, 14, 1344) 0           block5g_expand_bn[0][0]          
__________________________________________________________________________________________________
block5g_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5g_expand_activation[0][0]  
__________________________________________________________________________________________________
block5g_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5g_dwconv[0][0]             
__________________________________________________________________________________________________
block5g_activation (Activation) (None, 14, 14, 1344) 0           block5g_bn[0][0]                 
__________________________________________________________________________________________________
block5g_se_squeeze (GlobalAvera (None, 1344)         0           block5g_activation[0][0]         
__________________________________________________________________________________________________
block5g_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5g_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5g_se_reshape[0][0]         
__________________________________________________________________________________________________
block5g_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5g_se_reduce[0][0]          
__________________________________________________________________________________________________
block5g_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5g_activation[0][0]         
                                                                 block5g_se_expand[0][0]          
__________________________________________________________________________________________________
block5g_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5g_se_excite[0][0]          
__________________________________________________________________________________________________
block5g_project_bn (BatchNormal (None, 14, 14, 224)  896         block5g_project_conv[0][0]       
__________________________________________________________________________________________________
block5g_drop (Dropout)          (None, 14, 14, 224)  0           block5g_project_bn[0][0]         
__________________________________________________________________________________________________
block5g_add (Add)               (None, 14, 14, 224)  0           block5g_drop[0][0]               
                                                                 block5f_add[0][0]                
__________________________________________________________________________________________________
block5h_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5g_add[0][0]                
__________________________________________________________________________________________________
block5h_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5h_expand_conv[0][0]        
__________________________________________________________________________________________________
block5h_expand_activation (Acti (None, 14, 14, 1344) 0           block5h_expand_bn[0][0]          
__________________________________________________________________________________________________
block5h_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5h_expand_activation[0][0]  
__________________________________________________________________________________________________
block5h_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5h_dwconv[0][0]             
__________________________________________________________________________________________________
block5h_activation (Activation) (None, 14, 14, 1344) 0           block5h_bn[0][0]                 
__________________________________________________________________________________________________
block5h_se_squeeze (GlobalAvera (None, 1344)         0           block5h_activation[0][0]         
__________________________________________________________________________________________________
block5h_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5h_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5h_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5h_se_reshape[0][0]         
__________________________________________________________________________________________________
block5h_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5h_se_reduce[0][0]          
__________________________________________________________________________________________________
block5h_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5h_activation[0][0]         
                                                                 block5h_se_expand[0][0]          
__________________________________________________________________________________________________
block5h_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5h_se_excite[0][0]          
__________________________________________________________________________________________________
block5h_project_bn (BatchNormal (None, 14, 14, 224)  896         block5h_project_conv[0][0]       
__________________________________________________________________________________________________
block5h_drop (Dropout)          (None, 14, 14, 224)  0           block5h_project_bn[0][0]         
__________________________________________________________________________________________________
block5h_add (Add)               (None, 14, 14, 224)  0           block5h_drop[0][0]               
                                                                 block5g_add[0][0]                
__________________________________________________________________________________________________
block5i_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5h_add[0][0]                
__________________________________________________________________________________________________
block5i_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5i_expand_conv[0][0]        
__________________________________________________________________________________________________
block5i_expand_activation (Acti (None, 14, 14, 1344) 0           block5i_expand_bn[0][0]          
__________________________________________________________________________________________________
block5i_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5i_expand_activation[0][0]  
__________________________________________________________________________________________________
block5i_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5i_dwconv[0][0]             
__________________________________________________________________________________________________
block5i_activation (Activation) (None, 14, 14, 1344) 0           block5i_bn[0][0]                 
__________________________________________________________________________________________________
block5i_se_squeeze (GlobalAvera (None, 1344)         0           block5i_activation[0][0]         
__________________________________________________________________________________________________
block5i_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5i_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5i_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5i_se_reshape[0][0]         
__________________________________________________________________________________________________
block5i_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5i_se_reduce[0][0]          
__________________________________________________________________________________________________
block5i_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5i_activation[0][0]         
                                                                 block5i_se_expand[0][0]          
__________________________________________________________________________________________________
block5i_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5i_se_excite[0][0]          
__________________________________________________________________________________________________
block5i_project_bn (BatchNormal (None, 14, 14, 224)  896         block5i_project_conv[0][0]       
__________________________________________________________________________________________________
block5i_drop (Dropout)          (None, 14, 14, 224)  0           block5i_project_bn[0][0]         
__________________________________________________________________________________________________
block5i_add (Add)               (None, 14, 14, 224)  0           block5i_drop[0][0]               
                                                                 block5h_add[0][0]                
__________________________________________________________________________________________________
block5j_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5i_add[0][0]                
__________________________________________________________________________________________________
block5j_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block5j_expand_conv[0][0]        
__________________________________________________________________________________________________
block5j_expand_activation (Acti (None, 14, 14, 1344) 0           block5j_expand_bn[0][0]          
__________________________________________________________________________________________________
block5j_dwconv (DepthwiseConv2D (None, 14, 14, 1344) 33600       block5j_expand_activation[0][0]  
__________________________________________________________________________________________________
block5j_bn (BatchNormalization) (None, 14, 14, 1344) 5376        block5j_dwconv[0][0]             
__________________________________________________________________________________________________
block5j_activation (Activation) (None, 14, 14, 1344) 0           block5j_bn[0][0]                 
__________________________________________________________________________________________________
block5j_se_squeeze (GlobalAvera (None, 1344)         0           block5j_activation[0][0]         
__________________________________________________________________________________________________
block5j_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block5j_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5j_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block5j_se_reshape[0][0]         
__________________________________________________________________________________________________
block5j_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block5j_se_reduce[0][0]          
__________________________________________________________________________________________________
block5j_se_excite (Multiply)    (None, 14, 14, 1344) 0           block5j_activation[0][0]         
                                                                 block5j_se_expand[0][0]          
__________________________________________________________________________________________________
block5j_project_conv (Conv2D)   (None, 14, 14, 224)  301056      block5j_se_excite[0][0]          
__________________________________________________________________________________________________
block5j_project_bn (BatchNormal (None, 14, 14, 224)  896         block5j_project_conv[0][0]       
__________________________________________________________________________________________________
block5j_drop (Dropout)          (None, 14, 14, 224)  0           block5j_project_bn[0][0]         
__________________________________________________________________________________________________
block5j_add (Add)               (None, 14, 14, 224)  0           block5j_drop[0][0]               
                                                                 block5i_add[0][0]                
__________________________________________________________________________________________________
block6a_expand_conv (Conv2D)    (None, 14, 14, 1344) 301056      block5j_add[0][0]                
__________________________________________________________________________________________________
block6a_expand_bn (BatchNormali (None, 14, 14, 1344) 5376        block6a_expand_conv[0][0]        
__________________________________________________________________________________________________
block6a_expand_activation (Acti (None, 14, 14, 1344) 0           block6a_expand_bn[0][0]          
__________________________________________________________________________________________________
block6a_dwconv_pad (ZeroPadding (None, 17, 17, 1344) 0           block6a_expand_activation[0][0]  
__________________________________________________________________________________________________
block6a_dwconv (DepthwiseConv2D (None, 7, 7, 1344)   33600       block6a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block6a_bn (BatchNormalization) (None, 7, 7, 1344)   5376        block6a_dwconv[0][0]             
__________________________________________________________________________________________________
block6a_activation (Activation) (None, 7, 7, 1344)   0           block6a_bn[0][0]                 
__________________________________________________________________________________________________
block6a_se_squeeze (GlobalAvera (None, 1344)         0           block6a_activation[0][0]         
__________________________________________________________________________________________________
block6a_se_reshape (Reshape)    (None, 1, 1, 1344)   0           block6a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6a_se_reduce (Conv2D)      (None, 1, 1, 56)     75320       block6a_se_reshape[0][0]         
__________________________________________________________________________________________________
block6a_se_expand (Conv2D)      (None, 1, 1, 1344)   76608       block6a_se_reduce[0][0]          
__________________________________________________________________________________________________
block6a_se_excite (Multiply)    (None, 7, 7, 1344)   0           block6a_activation[0][0]         
                                                                 block6a_se_expand[0][0]          
__________________________________________________________________________________________________
block6a_project_conv (Conv2D)   (None, 7, 7, 384)    516096      block6a_se_excite[0][0]          
__________________________________________________________________________________________________
block6a_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6a_project_conv[0][0]       
__________________________________________________________________________________________________
block6b_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6a_project_bn[0][0]         
__________________________________________________________________________________________________
block6b_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6b_expand_conv[0][0]        
__________________________________________________________________________________________________
block6b_expand_activation (Acti (None, 7, 7, 2304)   0           block6b_expand_bn[0][0]          
__________________________________________________________________________________________________
block6b_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6b_expand_activation[0][0]  
__________________________________________________________________________________________________
block6b_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6b_dwconv[0][0]             
__________________________________________________________________________________________________
block6b_activation (Activation) (None, 7, 7, 2304)   0           block6b_bn[0][0]                 
__________________________________________________________________________________________________
block6b_se_squeeze (GlobalAvera (None, 2304)         0           block6b_activation[0][0]         
__________________________________________________________________________________________________
block6b_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6b_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6b_se_reshape[0][0]         
__________________________________________________________________________________________________
block6b_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6b_se_reduce[0][0]          
__________________________________________________________________________________________________
block6b_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6b_activation[0][0]         
                                                                 block6b_se_expand[0][0]          
__________________________________________________________________________________________________
block6b_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6b_se_excite[0][0]          
__________________________________________________________________________________________________
block6b_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6b_project_conv[0][0]       
__________________________________________________________________________________________________
block6b_drop (Dropout)          (None, 7, 7, 384)    0           block6b_project_bn[0][0]         
__________________________________________________________________________________________________
block6b_add (Add)               (None, 7, 7, 384)    0           block6b_drop[0][0]               
                                                                 block6a_project_bn[0][0]         
__________________________________________________________________________________________________
block6c_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6b_add[0][0]                
__________________________________________________________________________________________________
block6c_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6c_expand_conv[0][0]        
__________________________________________________________________________________________________
block6c_expand_activation (Acti (None, 7, 7, 2304)   0           block6c_expand_bn[0][0]          
__________________________________________________________________________________________________
block6c_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6c_expand_activation[0][0]  
__________________________________________________________________________________________________
block6c_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6c_dwconv[0][0]             
__________________________________________________________________________________________________
block6c_activation (Activation) (None, 7, 7, 2304)   0           block6c_bn[0][0]                 
__________________________________________________________________________________________________
block6c_se_squeeze (GlobalAvera (None, 2304)         0           block6c_activation[0][0]         
__________________________________________________________________________________________________
block6c_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6c_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6c_se_reshape[0][0]         
__________________________________________________________________________________________________
block6c_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6c_se_reduce[0][0]          
__________________________________________________________________________________________________
block6c_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6c_activation[0][0]         
                                                                 block6c_se_expand[0][0]          
__________________________________________________________________________________________________
block6c_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6c_se_excite[0][0]          
__________________________________________________________________________________________________
block6c_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6c_project_conv[0][0]       
__________________________________________________________________________________________________
block6c_drop (Dropout)          (None, 7, 7, 384)    0           block6c_project_bn[0][0]         
__________________________________________________________________________________________________
block6c_add (Add)               (None, 7, 7, 384)    0           block6c_drop[0][0]               
                                                                 block6b_add[0][0]                
__________________________________________________________________________________________________
block6d_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6c_add[0][0]                
__________________________________________________________________________________________________
block6d_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6d_expand_conv[0][0]        
__________________________________________________________________________________________________
block6d_expand_activation (Acti (None, 7, 7, 2304)   0           block6d_expand_bn[0][0]          
__________________________________________________________________________________________________
block6d_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6d_expand_activation[0][0]  
__________________________________________________________________________________________________
block6d_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6d_dwconv[0][0]             
__________________________________________________________________________________________________
block6d_activation (Activation) (None, 7, 7, 2304)   0           block6d_bn[0][0]                 
__________________________________________________________________________________________________
block6d_se_squeeze (GlobalAvera (None, 2304)         0           block6d_activation[0][0]         
__________________________________________________________________________________________________
block6d_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6d_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6d_se_reshape[0][0]         
__________________________________________________________________________________________________
block6d_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6d_se_reduce[0][0]          
__________________________________________________________________________________________________
block6d_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6d_activation[0][0]         
                                                                 block6d_se_expand[0][0]          
__________________________________________________________________________________________________
block6d_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6d_se_excite[0][0]          
__________________________________________________________________________________________________
block6d_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6d_project_conv[0][0]       
__________________________________________________________________________________________________
block6d_drop (Dropout)          (None, 7, 7, 384)    0           block6d_project_bn[0][0]         
__________________________________________________________________________________________________
block6d_add (Add)               (None, 7, 7, 384)    0           block6d_drop[0][0]               
                                                                 block6c_add[0][0]                
__________________________________________________________________________________________________
block6e_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6d_add[0][0]                
__________________________________________________________________________________________________
block6e_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6e_expand_conv[0][0]        
__________________________________________________________________________________________________
block6e_expand_activation (Acti (None, 7, 7, 2304)   0           block6e_expand_bn[0][0]          
__________________________________________________________________________________________________
block6e_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6e_expand_activation[0][0]  
__________________________________________________________________________________________________
block6e_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6e_dwconv[0][0]             
__________________________________________________________________________________________________
block6e_activation (Activation) (None, 7, 7, 2304)   0           block6e_bn[0][0]                 
__________________________________________________________________________________________________
block6e_se_squeeze (GlobalAvera (None, 2304)         0           block6e_activation[0][0]         
__________________________________________________________________________________________________
block6e_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6e_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6e_se_reshape[0][0]         
__________________________________________________________________________________________________
block6e_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6e_se_reduce[0][0]          
__________________________________________________________________________________________________
block6e_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6e_activation[0][0]         
                                                                 block6e_se_expand[0][0]          
__________________________________________________________________________________________________
block6e_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6e_se_excite[0][0]          
__________________________________________________________________________________________________
block6e_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6e_project_conv[0][0]       
__________________________________________________________________________________________________
block6e_drop (Dropout)          (None, 7, 7, 384)    0           block6e_project_bn[0][0]         
__________________________________________________________________________________________________
block6e_add (Add)               (None, 7, 7, 384)    0           block6e_drop[0][0]               
                                                                 block6d_add[0][0]                
__________________________________________________________________________________________________
block6f_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6e_add[0][0]                
__________________________________________________________________________________________________
block6f_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6f_expand_conv[0][0]        
__________________________________________________________________________________________________
block6f_expand_activation (Acti (None, 7, 7, 2304)   0           block6f_expand_bn[0][0]          
__________________________________________________________________________________________________
block6f_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6f_expand_activation[0][0]  
__________________________________________________________________________________________________
block6f_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6f_dwconv[0][0]             
__________________________________________________________________________________________________
block6f_activation (Activation) (None, 7, 7, 2304)   0           block6f_bn[0][0]                 
__________________________________________________________________________________________________
block6f_se_squeeze (GlobalAvera (None, 2304)         0           block6f_activation[0][0]         
__________________________________________________________________________________________________
block6f_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6f_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6f_se_reshape[0][0]         
__________________________________________________________________________________________________
block6f_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6f_se_reduce[0][0]          
__________________________________________________________________________________________________
block6f_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6f_activation[0][0]         
                                                                 block6f_se_expand[0][0]          
__________________________________________________________________________________________________
block6f_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6f_se_excite[0][0]          
__________________________________________________________________________________________________
block6f_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6f_project_conv[0][0]       
__________________________________________________________________________________________________
block6f_drop (Dropout)          (None, 7, 7, 384)    0           block6f_project_bn[0][0]         
__________________________________________________________________________________________________
block6f_add (Add)               (None, 7, 7, 384)    0           block6f_drop[0][0]               
                                                                 block6e_add[0][0]                
__________________________________________________________________________________________________
block6g_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6f_add[0][0]                
__________________________________________________________________________________________________
block6g_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6g_expand_conv[0][0]        
__________________________________________________________________________________________________
block6g_expand_activation (Acti (None, 7, 7, 2304)   0           block6g_expand_bn[0][0]          
__________________________________________________________________________________________________
block6g_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6g_expand_activation[0][0]  
__________________________________________________________________________________________________
block6g_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6g_dwconv[0][0]             
__________________________________________________________________________________________________
block6g_activation (Activation) (None, 7, 7, 2304)   0           block6g_bn[0][0]                 
__________________________________________________________________________________________________
block6g_se_squeeze (GlobalAvera (None, 2304)         0           block6g_activation[0][0]         
__________________________________________________________________________________________________
block6g_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6g_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6g_se_reshape[0][0]         
__________________________________________________________________________________________________
block6g_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6g_se_reduce[0][0]          
__________________________________________________________________________________________________
block6g_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6g_activation[0][0]         
                                                                 block6g_se_expand[0][0]          
__________________________________________________________________________________________________
block6g_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6g_se_excite[0][0]          
__________________________________________________________________________________________________
block6g_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6g_project_conv[0][0]       
__________________________________________________________________________________________________
block6g_drop (Dropout)          (None, 7, 7, 384)    0           block6g_project_bn[0][0]         
__________________________________________________________________________________________________
block6g_add (Add)               (None, 7, 7, 384)    0           block6g_drop[0][0]               
                                                                 block6f_add[0][0]                
__________________________________________________________________________________________________
block6h_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6g_add[0][0]                
__________________________________________________________________________________________________
block6h_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6h_expand_conv[0][0]        
__________________________________________________________________________________________________
block6h_expand_activation (Acti (None, 7, 7, 2304)   0           block6h_expand_bn[0][0]          
__________________________________________________________________________________________________
block6h_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6h_expand_activation[0][0]  
__________________________________________________________________________________________________
block6h_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6h_dwconv[0][0]             
__________________________________________________________________________________________________
block6h_activation (Activation) (None, 7, 7, 2304)   0           block6h_bn[0][0]                 
__________________________________________________________________________________________________
block6h_se_squeeze (GlobalAvera (None, 2304)         0           block6h_activation[0][0]         
__________________________________________________________________________________________________
block6h_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6h_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6h_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6h_se_reshape[0][0]         
__________________________________________________________________________________________________
block6h_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6h_se_reduce[0][0]          
__________________________________________________________________________________________________
block6h_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6h_activation[0][0]         
                                                                 block6h_se_expand[0][0]          
__________________________________________________________________________________________________
block6h_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6h_se_excite[0][0]          
__________________________________________________________________________________________________
block6h_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6h_project_conv[0][0]       
__________________________________________________________________________________________________
block6h_drop (Dropout)          (None, 7, 7, 384)    0           block6h_project_bn[0][0]         
__________________________________________________________________________________________________
block6h_add (Add)               (None, 7, 7, 384)    0           block6h_drop[0][0]               
                                                                 block6g_add[0][0]                
__________________________________________________________________________________________________
block6i_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6h_add[0][0]                
__________________________________________________________________________________________________
block6i_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6i_expand_conv[0][0]        
__________________________________________________________________________________________________
block6i_expand_activation (Acti (None, 7, 7, 2304)   0           block6i_expand_bn[0][0]          
__________________________________________________________________________________________________
block6i_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6i_expand_activation[0][0]  
__________________________________________________________________________________________________
block6i_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6i_dwconv[0][0]             
__________________________________________________________________________________________________
block6i_activation (Activation) (None, 7, 7, 2304)   0           block6i_bn[0][0]                 
__________________________________________________________________________________________________
block6i_se_squeeze (GlobalAvera (None, 2304)         0           block6i_activation[0][0]         
__________________________________________________________________________________________________
block6i_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6i_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6i_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6i_se_reshape[0][0]         
__________________________________________________________________________________________________
block6i_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6i_se_reduce[0][0]          
__________________________________________________________________________________________________
block6i_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6i_activation[0][0]         
                                                                 block6i_se_expand[0][0]          
__________________________________________________________________________________________________
block6i_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6i_se_excite[0][0]          
__________________________________________________________________________________________________
block6i_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6i_project_conv[0][0]       
__________________________________________________________________________________________________
block6i_drop (Dropout)          (None, 7, 7, 384)    0           block6i_project_bn[0][0]         
__________________________________________________________________________________________________
block6i_add (Add)               (None, 7, 7, 384)    0           block6i_drop[0][0]               
                                                                 block6h_add[0][0]                
__________________________________________________________________________________________________
block6j_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6i_add[0][0]                
__________________________________________________________________________________________________
block6j_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6j_expand_conv[0][0]        
__________________________________________________________________________________________________
block6j_expand_activation (Acti (None, 7, 7, 2304)   0           block6j_expand_bn[0][0]          
__________________________________________________________________________________________________
block6j_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6j_expand_activation[0][0]  
__________________________________________________________________________________________________
block6j_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6j_dwconv[0][0]             
__________________________________________________________________________________________________
block6j_activation (Activation) (None, 7, 7, 2304)   0           block6j_bn[0][0]                 
__________________________________________________________________________________________________
block6j_se_squeeze (GlobalAvera (None, 2304)         0           block6j_activation[0][0]         
__________________________________________________________________________________________________
block6j_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6j_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6j_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6j_se_reshape[0][0]         
__________________________________________________________________________________________________
block6j_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6j_se_reduce[0][0]          
__________________________________________________________________________________________________
block6j_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6j_activation[0][0]         
                                                                 block6j_se_expand[0][0]          
__________________________________________________________________________________________________
block6j_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6j_se_excite[0][0]          
__________________________________________________________________________________________________
block6j_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6j_project_conv[0][0]       
__________________________________________________________________________________________________
block6j_drop (Dropout)          (None, 7, 7, 384)    0           block6j_project_bn[0][0]         
__________________________________________________________________________________________________
block6j_add (Add)               (None, 7, 7, 384)    0           block6j_drop[0][0]               
                                                                 block6i_add[0][0]                
__________________________________________________________________________________________________
block6k_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6j_add[0][0]                
__________________________________________________________________________________________________
block6k_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6k_expand_conv[0][0]        
__________________________________________________________________________________________________
block6k_expand_activation (Acti (None, 7, 7, 2304)   0           block6k_expand_bn[0][0]          
__________________________________________________________________________________________________
block6k_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6k_expand_activation[0][0]  
__________________________________________________________________________________________________
block6k_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6k_dwconv[0][0]             
__________________________________________________________________________________________________
block6k_activation (Activation) (None, 7, 7, 2304)   0           block6k_bn[0][0]                 
__________________________________________________________________________________________________
block6k_se_squeeze (GlobalAvera (None, 2304)         0           block6k_activation[0][0]         
__________________________________________________________________________________________________
block6k_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6k_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6k_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6k_se_reshape[0][0]         
__________________________________________________________________________________________________
block6k_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6k_se_reduce[0][0]          
__________________________________________________________________________________________________
block6k_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6k_activation[0][0]         
                                                                 block6k_se_expand[0][0]          
__________________________________________________________________________________________________
block6k_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6k_se_excite[0][0]          
__________________________________________________________________________________________________
block6k_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6k_project_conv[0][0]       
__________________________________________________________________________________________________
block6k_drop (Dropout)          (None, 7, 7, 384)    0           block6k_project_bn[0][0]         
__________________________________________________________________________________________________
block6k_add (Add)               (None, 7, 7, 384)    0           block6k_drop[0][0]               
                                                                 block6j_add[0][0]                
__________________________________________________________________________________________________
block6l_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6k_add[0][0]                
__________________________________________________________________________________________________
block6l_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6l_expand_conv[0][0]        
__________________________________________________________________________________________________
block6l_expand_activation (Acti (None, 7, 7, 2304)   0           block6l_expand_bn[0][0]          
__________________________________________________________________________________________________
block6l_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6l_expand_activation[0][0]  
__________________________________________________________________________________________________
block6l_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6l_dwconv[0][0]             
__________________________________________________________________________________________________
block6l_activation (Activation) (None, 7, 7, 2304)   0           block6l_bn[0][0]                 
__________________________________________________________________________________________________
block6l_se_squeeze (GlobalAvera (None, 2304)         0           block6l_activation[0][0]         
__________________________________________________________________________________________________
block6l_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6l_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6l_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6l_se_reshape[0][0]         
__________________________________________________________________________________________________
block6l_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6l_se_reduce[0][0]          
__________________________________________________________________________________________________
block6l_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6l_activation[0][0]         
                                                                 block6l_se_expand[0][0]          
__________________________________________________________________________________________________
block6l_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6l_se_excite[0][0]          
__________________________________________________________________________________________________
block6l_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6l_project_conv[0][0]       
__________________________________________________________________________________________________
block6l_drop (Dropout)          (None, 7, 7, 384)    0           block6l_project_bn[0][0]         
__________________________________________________________________________________________________
block6l_add (Add)               (None, 7, 7, 384)    0           block6l_drop[0][0]               
                                                                 block6k_add[0][0]                
__________________________________________________________________________________________________
block6m_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6l_add[0][0]                
__________________________________________________________________________________________________
block6m_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block6m_expand_conv[0][0]        
__________________________________________________________________________________________________
block6m_expand_activation (Acti (None, 7, 7, 2304)   0           block6m_expand_bn[0][0]          
__________________________________________________________________________________________________
block6m_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   57600       block6m_expand_activation[0][0]  
__________________________________________________________________________________________________
block6m_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block6m_dwconv[0][0]             
__________________________________________________________________________________________________
block6m_activation (Activation) (None, 7, 7, 2304)   0           block6m_bn[0][0]                 
__________________________________________________________________________________________________
block6m_se_squeeze (GlobalAvera (None, 2304)         0           block6m_activation[0][0]         
__________________________________________________________________________________________________
block6m_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block6m_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6m_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block6m_se_reshape[0][0]         
__________________________________________________________________________________________________
block6m_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block6m_se_reduce[0][0]          
__________________________________________________________________________________________________
block6m_se_excite (Multiply)    (None, 7, 7, 2304)   0           block6m_activation[0][0]         
                                                                 block6m_se_expand[0][0]          
__________________________________________________________________________________________________
block6m_project_conv (Conv2D)   (None, 7, 7, 384)    884736      block6m_se_excite[0][0]          
__________________________________________________________________________________________________
block6m_project_bn (BatchNormal (None, 7, 7, 384)    1536        block6m_project_conv[0][0]       
__________________________________________________________________________________________________
block6m_drop (Dropout)          (None, 7, 7, 384)    0           block6m_project_bn[0][0]         
__________________________________________________________________________________________________
block6m_add (Add)               (None, 7, 7, 384)    0           block6m_drop[0][0]               
                                                                 block6l_add[0][0]                
__________________________________________________________________________________________________
block7a_expand_conv (Conv2D)    (None, 7, 7, 2304)   884736      block6m_add[0][0]                
__________________________________________________________________________________________________
block7a_expand_bn (BatchNormali (None, 7, 7, 2304)   9216        block7a_expand_conv[0][0]        
__________________________________________________________________________________________________
block7a_expand_activation (Acti (None, 7, 7, 2304)   0           block7a_expand_bn[0][0]          
__________________________________________________________________________________________________
block7a_dwconv (DepthwiseConv2D (None, 7, 7, 2304)   20736       block7a_expand_activation[0][0]  
__________________________________________________________________________________________________
block7a_bn (BatchNormalization) (None, 7, 7, 2304)   9216        block7a_dwconv[0][0]             
__________________________________________________________________________________________________
block7a_activation (Activation) (None, 7, 7, 2304)   0           block7a_bn[0][0]                 
__________________________________________________________________________________________________
block7a_se_squeeze (GlobalAvera (None, 2304)         0           block7a_activation[0][0]         
__________________________________________________________________________________________________
block7a_se_reshape (Reshape)    (None, 1, 1, 2304)   0           block7a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block7a_se_reduce (Conv2D)      (None, 1, 1, 96)     221280      block7a_se_reshape[0][0]         
__________________________________________________________________________________________________
block7a_se_expand (Conv2D)      (None, 1, 1, 2304)   223488      block7a_se_reduce[0][0]          
__________________________________________________________________________________________________
block7a_se_excite (Multiply)    (None, 7, 7, 2304)   0           block7a_activation[0][0]         
                                                                 block7a_se_expand[0][0]          
__________________________________________________________________________________________________
block7a_project_conv (Conv2D)   (None, 7, 7, 640)    1474560     block7a_se_excite[0][0]          
__________________________________________________________________________________________________
block7a_project_bn (BatchNormal (None, 7, 7, 640)    2560        block7a_project_conv[0][0]       
__________________________________________________________________________________________________
block7b_expand_conv (Conv2D)    (None, 7, 7, 3840)   2457600     block7a_project_bn[0][0]         
__________________________________________________________________________________________________
block7b_expand_bn (BatchNormali (None, 7, 7, 3840)   15360       block7b_expand_conv[0][0]        
__________________________________________________________________________________________________
block7b_expand_activation (Acti (None, 7, 7, 3840)   0           block7b_expand_bn[0][0]          
__________________________________________________________________________________________________
block7b_dwconv (DepthwiseConv2D (None, 7, 7, 3840)   34560       block7b_expand_activation[0][0]  
__________________________________________________________________________________________________
block7b_bn (BatchNormalization) (None, 7, 7, 3840)   15360       block7b_dwconv[0][0]             
__________________________________________________________________________________________________
block7b_activation (Activation) (None, 7, 7, 3840)   0           block7b_bn[0][0]                 
__________________________________________________________________________________________________
block7b_se_squeeze (GlobalAvera (None, 3840)         0           block7b_activation[0][0]         
__________________________________________________________________________________________________
block7b_se_reshape (Reshape)    (None, 1, 1, 3840)   0           block7b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block7b_se_reduce (Conv2D)      (None, 1, 1, 160)    614560      block7b_se_reshape[0][0]         
__________________________________________________________________________________________________
block7b_se_expand (Conv2D)      (None, 1, 1, 3840)   618240      block7b_se_reduce[0][0]          
__________________________________________________________________________________________________
block7b_se_excite (Multiply)    (None, 7, 7, 3840)   0           block7b_activation[0][0]         
                                                                 block7b_se_expand[0][0]          
__________________________________________________________________________________________________
block7b_project_conv (Conv2D)   (None, 7, 7, 640)    2457600     block7b_se_excite[0][0]          
__________________________________________________________________________________________________
block7b_project_bn (BatchNormal (None, 7, 7, 640)    2560        block7b_project_conv[0][0]       
__________________________________________________________________________________________________
block7b_drop (Dropout)          (None, 7, 7, 640)    0           block7b_project_bn[0][0]         
__________________________________________________________________________________________________
block7b_add (Add)               (None, 7, 7, 640)    0           block7b_drop[0][0]               
                                                                 block7a_project_bn[0][0]         
__________________________________________________________________________________________________
block7c_expand_conv (Conv2D)    (None, 7, 7, 3840)   2457600     block7b_add[0][0]                
__________________________________________________________________________________________________
block7c_expand_bn (BatchNormali (None, 7, 7, 3840)   15360       block7c_expand_conv[0][0]        
__________________________________________________________________________________________________
block7c_expand_activation (Acti (None, 7, 7, 3840)   0           block7c_expand_bn[0][0]          
__________________________________________________________________________________________________
block7c_dwconv (DepthwiseConv2D (None, 7, 7, 3840)   34560       block7c_expand_activation[0][0]  
__________________________________________________________________________________________________
block7c_bn (BatchNormalization) (None, 7, 7, 3840)   15360       block7c_dwconv[0][0]             
__________________________________________________________________________________________________
block7c_activation (Activation) (None, 7, 7, 3840)   0           block7c_bn[0][0]                 
__________________________________________________________________________________________________
block7c_se_squeeze (GlobalAvera (None, 3840)         0           block7c_activation[0][0]         
__________________________________________________________________________________________________
block7c_se_reshape (Reshape)    (None, 1, 1, 3840)   0           block7c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block7c_se_reduce (Conv2D)      (None, 1, 1, 160)    614560      block7c_se_reshape[0][0]         
__________________________________________________________________________________________________
block7c_se_expand (Conv2D)      (None, 1, 1, 3840)   618240      block7c_se_reduce[0][0]          
__________________________________________________________________________________________________
block7c_se_excite (Multiply)    (None, 7, 7, 3840)   0           block7c_activation[0][0]         
                                                                 block7c_se_expand[0][0]          
__________________________________________________________________________________________________
block7c_project_conv (Conv2D)   (None, 7, 7, 640)    2457600     block7c_se_excite[0][0]          
__________________________________________________________________________________________________
block7c_project_bn (BatchNormal (None, 7, 7, 640)    2560        block7c_project_conv[0][0]       
__________________________________________________________________________________________________
block7c_drop (Dropout)          (None, 7, 7, 640)    0           block7c_project_bn[0][0]         
__________________________________________________________________________________________________
block7c_add (Add)               (None, 7, 7, 640)    0           block7c_drop[0][0]               
                                                                 block7b_add[0][0]                
__________________________________________________________________________________________________
block7d_expand_conv (Conv2D)    (None, 7, 7, 3840)   2457600     block7c_add[0][0]                
__________________________________________________________________________________________________
block7d_expand_bn (BatchNormali (None, 7, 7, 3840)   15360       block7d_expand_conv[0][0]        
__________________________________________________________________________________________________
block7d_expand_activation (Acti (None, 7, 7, 3840)   0           block7d_expand_bn[0][0]          
__________________________________________________________________________________________________
block7d_dwconv (DepthwiseConv2D (None, 7, 7, 3840)   34560       block7d_expand_activation[0][0]  
__________________________________________________________________________________________________
block7d_bn (BatchNormalization) (None, 7, 7, 3840)   15360       block7d_dwconv[0][0]             
__________________________________________________________________________________________________
block7d_activation (Activation) (None, 7, 7, 3840)   0           block7d_bn[0][0]                 
__________________________________________________________________________________________________
block7d_se_squeeze (GlobalAvera (None, 3840)         0           block7d_activation[0][0]         
__________________________________________________________________________________________________
block7d_se_reshape (Reshape)    (None, 1, 1, 3840)   0           block7d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block7d_se_reduce (Conv2D)      (None, 1, 1, 160)    614560      block7d_se_reshape[0][0]         
__________________________________________________________________________________________________
block7d_se_expand (Conv2D)      (None, 1, 1, 3840)   618240      block7d_se_reduce[0][0]          
__________________________________________________________________________________________________
block7d_se_excite (Multiply)    (None, 7, 7, 3840)   0           block7d_activation[0][0]         
                                                                 block7d_se_expand[0][0]          
__________________________________________________________________________________________________
block7d_project_conv (Conv2D)   (None, 7, 7, 640)    2457600     block7d_se_excite[0][0]          
__________________________________________________________________________________________________
block7d_project_bn (BatchNormal (None, 7, 7, 640)    2560        block7d_project_conv[0][0]       
__________________________________________________________________________________________________
block7d_drop (Dropout)          (None, 7, 7, 640)    0           block7d_project_bn[0][0]         
__________________________________________________________________________________________________
block7d_add (Add)               (None, 7, 7, 640)    0           block7d_drop[0][0]               
                                                                 block7c_add[0][0]                
__________________________________________________________________________________________________
top_conv (Conv2D)               (None, 7, 7, 2560)   1638400     block7d_add[0][0]                
__________________________________________________________________________________________________
top_bn (BatchNormalization)     (None, 7, 7, 2560)   10240       top_conv[0][0]                   
__________________________________________________________________________________________________
top_activation (Activation)     (None, 7, 7, 2560)   0           top_bn[0][0]                     
__________________________________________________________________________________________________
flatten_3 (Flatten)             (None, 125440)       0           top_activation[0][0]             
__________________________________________________________________________________________________
dropout_7 (Dropout)             (None, 125440)       0           flatten_3[0][0]                  
__________________________________________________________________________________________________
dense_5 (Dense)                 (None, 10)           1254410     dropout_7[0][0]                  
==================================================================================================
Total params: 65,352,097
Trainable params: 1,254,410
Non-trainable params: 64,097,687
__________________________________________________________________________________________________
</code></pre>
</div>
</div>
<div id="5ea3ddcc" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.526527,&quot;end_time&quot;:&quot;2023-01-11T19:19:10.733741&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:19:09.207214&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos el modelo diseñado procedemos a realizar el
entrenamiento de la misma forma que lo llevamos haciendo a lo largo del
proyecto, entrenaremos durante 100 epochs esperando que el EarlyStopping
paralice el entrenamiento antes.</p>
</div>
<div id="2cf69438" class="cell code" data-execution_count="40"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:19:14.125756Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:19:14.125142Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:56:12.318357Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:56:12.317309Z&quot;}"
data-papermill="{&quot;duration&quot;:2221.826955,&quot;end_time&quot;:&quot;2023-01-11T19:56:14.084454&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:19:12.257499&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb65"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>history_efficientnetb7 <span class="op">=</span> model_efficientnetb7.fit_generator(train_generator,validation_data<span class="op">=</span>val_generator,epochs<span class="op">=</span><span class="dv">100</span>,verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>cbs)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/opt/conda/lib/python3.7/site-packages/keras/engine/training.py:1972: UserWarning:

`Model.fit_generator` is deprecated and will be removed in a future version. Please use `Model.fit`, which supports generators.

</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
655/655 [==============================] - 377s 549ms/step - loss: 1.3871 - auc: 0.9667 - val_loss: 1.1296 - val_auc: 0.9807
Epoch 2/100
655/655 [==============================] - 342s 522ms/step - loss: 1.3066 - auc: 0.9750 - val_loss: 1.5293 - val_auc: 0.9777
Epoch 3/100
655/655 [==============================] - 341s 520ms/step - loss: 1.2885 - auc: 0.9777 - val_loss: 1.4032 - val_auc: 0.9818
Epoch 4/100
655/655 [==============================] - 348s 530ms/step - loss: 1.2191 - auc: 0.9799 - val_loss: 1.9259 - val_auc: 0.9767
Epoch 5/100
655/655 [==============================] - 359s 547ms/step - loss: 1.2676 - auc: 0.9812 - val_loss: 1.6012 - val_auc: 0.9807
Epoch 6/100
655/655 [==============================] - 349s 533ms/step - loss: 1.2055 - auc: 0.9821 - val_loss: 1.6671 - val_auc: 0.9835
</code></pre>
</div>
</div>
<div id="0f949eb2" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.757744,&quot;end_time&quot;:&quot;2023-01-11T19:56:17.853052&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:56:16.095308&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez realizado el entrenamiento podemos observar cómo el mejor
resultado obtenido sobre el conjunto de validación es de
<code>0.9824</code>, lo que es sin duda un muy buen resultado siendo el
mejor resultado hasta el momento. Por lo tanto, lo que realizaremos a
continuación será guardarnos dicho modelo.</p>
</div>
<div id="10b189e3" class="cell code" data-execution_count="41"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:56:21.427796Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:56:21.427402Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:56:46.247138Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:56:46.246105Z&quot;}"
data-papermill="{&quot;duration&quot;:26.620175,&quot;end_time&quot;:&quot;2023-01-11T19:56:46.249937&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:56:19.629762&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb68"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>model_efficientnetb7.save(<span class="st">&quot;model_efficientnetb7.h5&quot;</span>)</span></code></pre></div>
</div>
<div id="38b890a3" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.91983,&quot;end_time&quot;:&quot;2023-01-11T19:56:49.946691&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:56:48.026861&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Dado que ya tenemos guardado nuestro modelo lo siguiente que haremos
será mostrar gráficamente cómo se ha evolucionado el entrenamiento.</p>
</div>
<div id="724ada47" class="cell code" data-execution_count="42"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:56:53.506745Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:56:53.506374Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:56:53.938834Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:56:53.937909Z&quot;}"
data-papermill="{&quot;duration&quot;:2.195511,&quot;end_time&quot;:&quot;2023-01-11T19:56:53.941242&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:56:51.745731&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb69"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> np.mean(history_efficientnetb7.history[<span class="st">&#39;val_auc&#39;</span>])</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> np.mean(history_efficientnetb7.history[<span class="st">&#39;val_loss&#39;</span>])</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> np.mean(history_efficientnetb7.history[<span class="st">&#39;auc&#39;</span>])</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> np.mean(history_efficientnetb7.history[<span class="st">&#39;loss&#39;</span>])</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&quot;ggplot&quot;</span>)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb7.history[<span class="st">&#39;val_loss&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb7.history[<span class="st">&#39;loss&#39;</span>], marker <span class="op">=</span> <span class="st">&#39;o&#39;</span>)</span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_loss&quot;</span>, <span class="st">&quot;loss&quot;</span>])</span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Losses</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_loss<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb69-13"><a href="#cb69-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb69-14"><a href="#cb69-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Loss&quot;</span>)</span>
<span id="cb69-15"><a href="#cb69-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-16"><a href="#cb69-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb69-17"><a href="#cb69-17" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb7.history[<span class="st">&#39;val_auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb69-18"><a href="#cb69-18" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb7.history[<span class="st">&#39;auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb69-19"><a href="#cb69-19" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_auc&quot;</span>, <span class="st">&quot;auc&quot;</span>])</span>
<span id="cb69-20"><a href="#cb69-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;AUCs</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_acc<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>acc<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb69-21"><a href="#cb69-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb69-22"><a href="#cb69-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;AUC&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="42">
<pre><code>Text(0, 0.5, &#39;AUC&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/1bcefc3c108751241f7fefe7c99a4f69cd15e76c.png" /></p>
</div>
</div>
<div id="0ec3df50" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.807389,&quot;end_time&quot;:&quot;2023-01-11T19:56:57.685042&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:56:55.877653&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar en la gráfica de pérdida cómo existe un mínimo de
varianza al existir una pequeña diferencia entre el conjunto de
entrenamiento y validación. En cuanto al sesgo vemos cómo en este modelo
es mucho más reducido que en el modelo anterior acercandose mucho más al
resultado óptimo. En conclusión este modelo parece mejor sobre el
conjunto de validación que el modelo de ResNet50.</p>
<h3 id="423-red-neuronal-efficientnetb5">4.2.3 Red Neuronal:
EfficientNetB5</h3>
<p>La última red preentrenada que probaremos es la EfficientNetB5, el
motivo de seleccionar otra red del grupo EfficientNet se debe al muy
buen resultado obtenido con su hermana la EfficientNetB7. Por lo tanto,
lo primero que haremos será cargar dicha red preentrenada.</p>
</div>
<div id="0a2665f1" class="cell code" data-execution_count="43"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:57:01.918601Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:57:01.918236Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:57:06.443058Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:57:06.442049Z&quot;}"
data-papermill="{&quot;duration&quot;:6.880837,&quot;end_time&quot;:&quot;2023-01-11T19:57:06.445776&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:56:59.564939&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb71"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tensorflow.keras.applications <span class="im">import</span> EfficientNetB5</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>model_efficientnetb5 <span class="op">=</span> EfficientNetB5(</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>      input_shape <span class="op">=</span> (<span class="dv">224</span>,<span class="dv">224</span>,<span class="dv">3</span>),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>      include_top <span class="op">=</span> <span class="va">False</span>,</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>      weights <span class="op">=</span> <span class="st">&#39;imagenet&#39;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Downloading data from https://storage.googleapis.com/keras-applications/efficientnetb5_notop.h5
115269632/115263384 [==============================] - 1s 0us/step
115277824/115263384 [==============================] - 1s 0us/step
</code></pre>
</div>
</div>
<div id="bb46bb2f" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.792807,&quot;end_time&quot;:&quot;2023-01-11T19:57:10.010288&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:57:08.217481&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos cargada la red seguiremos el mismo proceso que en las
otras redes, congelaremos las capas intermedias para que mantengan los
pesos originales.</p>
</div>
<div id="7b1921d9" class="cell code" data-execution_count="44"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:57:13.738935Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:57:13.738560Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:57:13.759126Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:57:13.758262Z&quot;}"
data-papermill="{&quot;duration&quot;:1.805388,&quot;end_time&quot;:&quot;2023-01-11T19:57:13.761322&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:57:11.955934&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb73"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> layers <span class="kw">in</span> model_efficientnetb5.layers:</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    layers.trainable <span class="op">=</span> <span class="va">False</span></span></code></pre></div>
</div>
<div id="31451d60" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.884599,&quot;end_time&quot;:&quot;2023-01-11T19:57:17.397557&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:57:15.512958&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>A continuación, se realizará el mismo procedimiento para conseguir la
salida y por tanto la clasificación. Tendremos una capa oculta Dense
conectada con la salida de nuestro modelo, seguida de esta capa Dense
encontraremos la última capa encargada de ofrecer la clasificación. Al
igual que en el resto de modelos encontramos que existe una capa Dropout
entre las dos últimas capas Dense para forzar a nuestro modelo
generalizar y no sobreajustar.</p>
</div>
<div id="6fdc352d" class="cell code" data-execution_count="45"
data-collapsed="true"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:57:20.839268Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:57:20.838884Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T19:57:20.981896Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T19:57:20.980705Z&quot;}"
data-jupyter="{&quot;outputs_hidden&quot;:true}"
data-papermill="{&quot;duration&quot;:1.830762,&quot;end_time&quot;:&quot;2023-01-11T19:57:20.997354&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:57:19.166592&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb74"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Flatten()(model_efficientnetb5.output)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Dropout(<span class="fl">0.5</span>)(y)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> Dense(<span class="dv">10</span>, activation <span class="op">=</span> <span class="st">&quot;softmax&quot;</span>)(y)</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>model_efficientnetb5 <span class="op">=</span> keras.Model(model_efficientnetb5.<span class="bu">input</span>, y)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>model_efficientnetb5.<span class="bu">compile</span>(loss <span class="op">=</span> <span class="st">&quot;categorical_crossentropy&quot;</span>, optimizer <span class="op">=</span> <span class="st">&quot;adam&quot;</span>, metrics <span class="op">=</span> <span class="st">&quot;AUC&quot;</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>model_efficientnetb5.summary()</span></code></pre></div>
<div class="output stream stdout">
<pre><code>Model: &quot;model_2&quot;
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
input_3 (InputLayer)            [(None, 224, 224, 3) 0                                            
__________________________________________________________________________________________________
rescaling_1 (Rescaling)         (None, 224, 224, 3)  0           input_3[0][0]                    
__________________________________________________________________________________________________
normalization_1 (Normalization) (None, 224, 224, 3)  7           rescaling_1[0][0]                
__________________________________________________________________________________________________
stem_conv_pad (ZeroPadding2D)   (None, 225, 225, 3)  0           normalization_1[0][0]            
__________________________________________________________________________________________________
stem_conv (Conv2D)              (None, 112, 112, 48) 1296        stem_conv_pad[0][0]              
__________________________________________________________________________________________________
stem_bn (BatchNormalization)    (None, 112, 112, 48) 192         stem_conv[0][0]                  
__________________________________________________________________________________________________
stem_activation (Activation)    (None, 112, 112, 48) 0           stem_bn[0][0]                    
__________________________________________________________________________________________________
block1a_dwconv (DepthwiseConv2D (None, 112, 112, 48) 432         stem_activation[0][0]            
__________________________________________________________________________________________________
block1a_bn (BatchNormalization) (None, 112, 112, 48) 192         block1a_dwconv[0][0]             
__________________________________________________________________________________________________
block1a_activation (Activation) (None, 112, 112, 48) 0           block1a_bn[0][0]                 
__________________________________________________________________________________________________
block1a_se_squeeze (GlobalAvera (None, 48)           0           block1a_activation[0][0]         
__________________________________________________________________________________________________
block1a_se_reshape (Reshape)    (None, 1, 1, 48)     0           block1a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block1a_se_reduce (Conv2D)      (None, 1, 1, 12)     588         block1a_se_reshape[0][0]         
__________________________________________________________________________________________________
block1a_se_expand (Conv2D)      (None, 1, 1, 48)     624         block1a_se_reduce[0][0]          
__________________________________________________________________________________________________
block1a_se_excite (Multiply)    (None, 112, 112, 48) 0           block1a_activation[0][0]         
                                                                 block1a_se_expand[0][0]          
__________________________________________________________________________________________________
block1a_project_conv (Conv2D)   (None, 112, 112, 24) 1152        block1a_se_excite[0][0]          
__________________________________________________________________________________________________
block1a_project_bn (BatchNormal (None, 112, 112, 24) 96          block1a_project_conv[0][0]       
__________________________________________________________________________________________________
block1b_dwconv (DepthwiseConv2D (None, 112, 112, 24) 216         block1a_project_bn[0][0]         
__________________________________________________________________________________________________
block1b_bn (BatchNormalization) (None, 112, 112, 24) 96          block1b_dwconv[0][0]             
__________________________________________________________________________________________________
block1b_activation (Activation) (None, 112, 112, 24) 0           block1b_bn[0][0]                 
__________________________________________________________________________________________________
block1b_se_squeeze (GlobalAvera (None, 24)           0           block1b_activation[0][0]         
__________________________________________________________________________________________________
block1b_se_reshape (Reshape)    (None, 1, 1, 24)     0           block1b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block1b_se_reduce (Conv2D)      (None, 1, 1, 6)      150         block1b_se_reshape[0][0]         
__________________________________________________________________________________________________
block1b_se_expand (Conv2D)      (None, 1, 1, 24)     168         block1b_se_reduce[0][0]          
__________________________________________________________________________________________________
block1b_se_excite (Multiply)    (None, 112, 112, 24) 0           block1b_activation[0][0]         
                                                                 block1b_se_expand[0][0]          
__________________________________________________________________________________________________
block1b_project_conv (Conv2D)   (None, 112, 112, 24) 576         block1b_se_excite[0][0]          
__________________________________________________________________________________________________
block1b_project_bn (BatchNormal (None, 112, 112, 24) 96          block1b_project_conv[0][0]       
__________________________________________________________________________________________________
block1b_drop (Dropout)          (None, 112, 112, 24) 0           block1b_project_bn[0][0]         
__________________________________________________________________________________________________
block1b_add (Add)               (None, 112, 112, 24) 0           block1b_drop[0][0]               
                                                                 block1a_project_bn[0][0]         
__________________________________________________________________________________________________
block1c_dwconv (DepthwiseConv2D (None, 112, 112, 24) 216         block1b_add[0][0]                
__________________________________________________________________________________________________
block1c_bn (BatchNormalization) (None, 112, 112, 24) 96          block1c_dwconv[0][0]             
__________________________________________________________________________________________________
block1c_activation (Activation) (None, 112, 112, 24) 0           block1c_bn[0][0]                 
__________________________________________________________________________________________________
block1c_se_squeeze (GlobalAvera (None, 24)           0           block1c_activation[0][0]         
__________________________________________________________________________________________________
block1c_se_reshape (Reshape)    (None, 1, 1, 24)     0           block1c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block1c_se_reduce (Conv2D)      (None, 1, 1, 6)      150         block1c_se_reshape[0][0]         
__________________________________________________________________________________________________
block1c_se_expand (Conv2D)      (None, 1, 1, 24)     168         block1c_se_reduce[0][0]          
__________________________________________________________________________________________________
block1c_se_excite (Multiply)    (None, 112, 112, 24) 0           block1c_activation[0][0]         
                                                                 block1c_se_expand[0][0]          
__________________________________________________________________________________________________
block1c_project_conv (Conv2D)   (None, 112, 112, 24) 576         block1c_se_excite[0][0]          
__________________________________________________________________________________________________
block1c_project_bn (BatchNormal (None, 112, 112, 24) 96          block1c_project_conv[0][0]       
__________________________________________________________________________________________________
block1c_drop (Dropout)          (None, 112, 112, 24) 0           block1c_project_bn[0][0]         
__________________________________________________________________________________________________
block1c_add (Add)               (None, 112, 112, 24) 0           block1c_drop[0][0]               
                                                                 block1b_add[0][0]                
__________________________________________________________________________________________________
block2a_expand_conv (Conv2D)    (None, 112, 112, 144 3456        block1c_add[0][0]                
__________________________________________________________________________________________________
block2a_expand_bn (BatchNormali (None, 112, 112, 144 576         block2a_expand_conv[0][0]        
__________________________________________________________________________________________________
block2a_expand_activation (Acti (None, 112, 112, 144 0           block2a_expand_bn[0][0]          
__________________________________________________________________________________________________
block2a_dwconv_pad (ZeroPadding (None, 113, 113, 144 0           block2a_expand_activation[0][0]  
__________________________________________________________________________________________________
block2a_dwconv (DepthwiseConv2D (None, 56, 56, 144)  1296        block2a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block2a_bn (BatchNormalization) (None, 56, 56, 144)  576         block2a_dwconv[0][0]             
__________________________________________________________________________________________________
block2a_activation (Activation) (None, 56, 56, 144)  0           block2a_bn[0][0]                 
__________________________________________________________________________________________________
block2a_se_squeeze (GlobalAvera (None, 144)          0           block2a_activation[0][0]         
__________________________________________________________________________________________________
block2a_se_reshape (Reshape)    (None, 1, 1, 144)    0           block2a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2a_se_reduce (Conv2D)      (None, 1, 1, 6)      870         block2a_se_reshape[0][0]         
__________________________________________________________________________________________________
block2a_se_expand (Conv2D)      (None, 1, 1, 144)    1008        block2a_se_reduce[0][0]          
__________________________________________________________________________________________________
block2a_se_excite (Multiply)    (None, 56, 56, 144)  0           block2a_activation[0][0]         
                                                                 block2a_se_expand[0][0]          
__________________________________________________________________________________________________
block2a_project_conv (Conv2D)   (None, 56, 56, 40)   5760        block2a_se_excite[0][0]          
__________________________________________________________________________________________________
block2a_project_bn (BatchNormal (None, 56, 56, 40)   160         block2a_project_conv[0][0]       
__________________________________________________________________________________________________
block2b_expand_conv (Conv2D)    (None, 56, 56, 240)  9600        block2a_project_bn[0][0]         
__________________________________________________________________________________________________
block2b_expand_bn (BatchNormali (None, 56, 56, 240)  960         block2b_expand_conv[0][0]        
__________________________________________________________________________________________________
block2b_expand_activation (Acti (None, 56, 56, 240)  0           block2b_expand_bn[0][0]          
__________________________________________________________________________________________________
block2b_dwconv (DepthwiseConv2D (None, 56, 56, 240)  2160        block2b_expand_activation[0][0]  
__________________________________________________________________________________________________
block2b_bn (BatchNormalization) (None, 56, 56, 240)  960         block2b_dwconv[0][0]             
__________________________________________________________________________________________________
block2b_activation (Activation) (None, 56, 56, 240)  0           block2b_bn[0][0]                 
__________________________________________________________________________________________________
block2b_se_squeeze (GlobalAvera (None, 240)          0           block2b_activation[0][0]         
__________________________________________________________________________________________________
block2b_se_reshape (Reshape)    (None, 1, 1, 240)    0           block2b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2b_se_reduce (Conv2D)      (None, 1, 1, 10)     2410        block2b_se_reshape[0][0]         
__________________________________________________________________________________________________
block2b_se_expand (Conv2D)      (None, 1, 1, 240)    2640        block2b_se_reduce[0][0]          
__________________________________________________________________________________________________
block2b_se_excite (Multiply)    (None, 56, 56, 240)  0           block2b_activation[0][0]         
                                                                 block2b_se_expand[0][0]          
__________________________________________________________________________________________________
block2b_project_conv (Conv2D)   (None, 56, 56, 40)   9600        block2b_se_excite[0][0]          
__________________________________________________________________________________________________
block2b_project_bn (BatchNormal (None, 56, 56, 40)   160         block2b_project_conv[0][0]       
__________________________________________________________________________________________________
block2b_drop (Dropout)          (None, 56, 56, 40)   0           block2b_project_bn[0][0]         
__________________________________________________________________________________________________
block2b_add (Add)               (None, 56, 56, 40)   0           block2b_drop[0][0]               
                                                                 block2a_project_bn[0][0]         
__________________________________________________________________________________________________
block2c_expand_conv (Conv2D)    (None, 56, 56, 240)  9600        block2b_add[0][0]                
__________________________________________________________________________________________________
block2c_expand_bn (BatchNormali (None, 56, 56, 240)  960         block2c_expand_conv[0][0]        
__________________________________________________________________________________________________
block2c_expand_activation (Acti (None, 56, 56, 240)  0           block2c_expand_bn[0][0]          
__________________________________________________________________________________________________
block2c_dwconv (DepthwiseConv2D (None, 56, 56, 240)  2160        block2c_expand_activation[0][0]  
__________________________________________________________________________________________________
block2c_bn (BatchNormalization) (None, 56, 56, 240)  960         block2c_dwconv[0][0]             
__________________________________________________________________________________________________
block2c_activation (Activation) (None, 56, 56, 240)  0           block2c_bn[0][0]                 
__________________________________________________________________________________________________
block2c_se_squeeze (GlobalAvera (None, 240)          0           block2c_activation[0][0]         
__________________________________________________________________________________________________
block2c_se_reshape (Reshape)    (None, 1, 1, 240)    0           block2c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2c_se_reduce (Conv2D)      (None, 1, 1, 10)     2410        block2c_se_reshape[0][0]         
__________________________________________________________________________________________________
block2c_se_expand (Conv2D)      (None, 1, 1, 240)    2640        block2c_se_reduce[0][0]          
__________________________________________________________________________________________________
block2c_se_excite (Multiply)    (None, 56, 56, 240)  0           block2c_activation[0][0]         
                                                                 block2c_se_expand[0][0]          
__________________________________________________________________________________________________
block2c_project_conv (Conv2D)   (None, 56, 56, 40)   9600        block2c_se_excite[0][0]          
__________________________________________________________________________________________________
block2c_project_bn (BatchNormal (None, 56, 56, 40)   160         block2c_project_conv[0][0]       
__________________________________________________________________________________________________
block2c_drop (Dropout)          (None, 56, 56, 40)   0           block2c_project_bn[0][0]         
__________________________________________________________________________________________________
block2c_add (Add)               (None, 56, 56, 40)   0           block2c_drop[0][0]               
                                                                 block2b_add[0][0]                
__________________________________________________________________________________________________
block2d_expand_conv (Conv2D)    (None, 56, 56, 240)  9600        block2c_add[0][0]                
__________________________________________________________________________________________________
block2d_expand_bn (BatchNormali (None, 56, 56, 240)  960         block2d_expand_conv[0][0]        
__________________________________________________________________________________________________
block2d_expand_activation (Acti (None, 56, 56, 240)  0           block2d_expand_bn[0][0]          
__________________________________________________________________________________________________
block2d_dwconv (DepthwiseConv2D (None, 56, 56, 240)  2160        block2d_expand_activation[0][0]  
__________________________________________________________________________________________________
block2d_bn (BatchNormalization) (None, 56, 56, 240)  960         block2d_dwconv[0][0]             
__________________________________________________________________________________________________
block2d_activation (Activation) (None, 56, 56, 240)  0           block2d_bn[0][0]                 
__________________________________________________________________________________________________
block2d_se_squeeze (GlobalAvera (None, 240)          0           block2d_activation[0][0]         
__________________________________________________________________________________________________
block2d_se_reshape (Reshape)    (None, 1, 1, 240)    0           block2d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2d_se_reduce (Conv2D)      (None, 1, 1, 10)     2410        block2d_se_reshape[0][0]         
__________________________________________________________________________________________________
block2d_se_expand (Conv2D)      (None, 1, 1, 240)    2640        block2d_se_reduce[0][0]          
__________________________________________________________________________________________________
block2d_se_excite (Multiply)    (None, 56, 56, 240)  0           block2d_activation[0][0]         
                                                                 block2d_se_expand[0][0]          
__________________________________________________________________________________________________
block2d_project_conv (Conv2D)   (None, 56, 56, 40)   9600        block2d_se_excite[0][0]          
__________________________________________________________________________________________________
block2d_project_bn (BatchNormal (None, 56, 56, 40)   160         block2d_project_conv[0][0]       
__________________________________________________________________________________________________
block2d_drop (Dropout)          (None, 56, 56, 40)   0           block2d_project_bn[0][0]         
__________________________________________________________________________________________________
block2d_add (Add)               (None, 56, 56, 40)   0           block2d_drop[0][0]               
                                                                 block2c_add[0][0]                
__________________________________________________________________________________________________
block2e_expand_conv (Conv2D)    (None, 56, 56, 240)  9600        block2d_add[0][0]                
__________________________________________________________________________________________________
block2e_expand_bn (BatchNormali (None, 56, 56, 240)  960         block2e_expand_conv[0][0]        
__________________________________________________________________________________________________
block2e_expand_activation (Acti (None, 56, 56, 240)  0           block2e_expand_bn[0][0]          
__________________________________________________________________________________________________
block2e_dwconv (DepthwiseConv2D (None, 56, 56, 240)  2160        block2e_expand_activation[0][0]  
__________________________________________________________________________________________________
block2e_bn (BatchNormalization) (None, 56, 56, 240)  960         block2e_dwconv[0][0]             
__________________________________________________________________________________________________
block2e_activation (Activation) (None, 56, 56, 240)  0           block2e_bn[0][0]                 
__________________________________________________________________________________________________
block2e_se_squeeze (GlobalAvera (None, 240)          0           block2e_activation[0][0]         
__________________________________________________________________________________________________
block2e_se_reshape (Reshape)    (None, 1, 1, 240)    0           block2e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block2e_se_reduce (Conv2D)      (None, 1, 1, 10)     2410        block2e_se_reshape[0][0]         
__________________________________________________________________________________________________
block2e_se_expand (Conv2D)      (None, 1, 1, 240)    2640        block2e_se_reduce[0][0]          
__________________________________________________________________________________________________
block2e_se_excite (Multiply)    (None, 56, 56, 240)  0           block2e_activation[0][0]         
                                                                 block2e_se_expand[0][0]          
__________________________________________________________________________________________________
block2e_project_conv (Conv2D)   (None, 56, 56, 40)   9600        block2e_se_excite[0][0]          
__________________________________________________________________________________________________
block2e_project_bn (BatchNormal (None, 56, 56, 40)   160         block2e_project_conv[0][0]       
__________________________________________________________________________________________________
block2e_drop (Dropout)          (None, 56, 56, 40)   0           block2e_project_bn[0][0]         
__________________________________________________________________________________________________
block2e_add (Add)               (None, 56, 56, 40)   0           block2e_drop[0][0]               
                                                                 block2d_add[0][0]                
__________________________________________________________________________________________________
block3a_expand_conv (Conv2D)    (None, 56, 56, 240)  9600        block2e_add[0][0]                
__________________________________________________________________________________________________
block3a_expand_bn (BatchNormali (None, 56, 56, 240)  960         block3a_expand_conv[0][0]        
__________________________________________________________________________________________________
block3a_expand_activation (Acti (None, 56, 56, 240)  0           block3a_expand_bn[0][0]          
__________________________________________________________________________________________________
block3a_dwconv_pad (ZeroPadding (None, 59, 59, 240)  0           block3a_expand_activation[0][0]  
__________________________________________________________________________________________________
block3a_dwconv (DepthwiseConv2D (None, 28, 28, 240)  6000        block3a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block3a_bn (BatchNormalization) (None, 28, 28, 240)  960         block3a_dwconv[0][0]             
__________________________________________________________________________________________________
block3a_activation (Activation) (None, 28, 28, 240)  0           block3a_bn[0][0]                 
__________________________________________________________________________________________________
block3a_se_squeeze (GlobalAvera (None, 240)          0           block3a_activation[0][0]         
__________________________________________________________________________________________________
block3a_se_reshape (Reshape)    (None, 1, 1, 240)    0           block3a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3a_se_reduce (Conv2D)      (None, 1, 1, 10)     2410        block3a_se_reshape[0][0]         
__________________________________________________________________________________________________
block3a_se_expand (Conv2D)      (None, 1, 1, 240)    2640        block3a_se_reduce[0][0]          
__________________________________________________________________________________________________
block3a_se_excite (Multiply)    (None, 28, 28, 240)  0           block3a_activation[0][0]         
                                                                 block3a_se_expand[0][0]          
__________________________________________________________________________________________________
block3a_project_conv (Conv2D)   (None, 28, 28, 64)   15360       block3a_se_excite[0][0]          
__________________________________________________________________________________________________
block3a_project_bn (BatchNormal (None, 28, 28, 64)   256         block3a_project_conv[0][0]       
__________________________________________________________________________________________________
block3b_expand_conv (Conv2D)    (None, 28, 28, 384)  24576       block3a_project_bn[0][0]         
__________________________________________________________________________________________________
block3b_expand_bn (BatchNormali (None, 28, 28, 384)  1536        block3b_expand_conv[0][0]        
__________________________________________________________________________________________________
block3b_expand_activation (Acti (None, 28, 28, 384)  0           block3b_expand_bn[0][0]          
__________________________________________________________________________________________________
block3b_dwconv (DepthwiseConv2D (None, 28, 28, 384)  9600        block3b_expand_activation[0][0]  
__________________________________________________________________________________________________
block3b_bn (BatchNormalization) (None, 28, 28, 384)  1536        block3b_dwconv[0][0]             
__________________________________________________________________________________________________
block3b_activation (Activation) (None, 28, 28, 384)  0           block3b_bn[0][0]                 
__________________________________________________________________________________________________
block3b_se_squeeze (GlobalAvera (None, 384)          0           block3b_activation[0][0]         
__________________________________________________________________________________________________
block3b_se_reshape (Reshape)    (None, 1, 1, 384)    0           block3b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3b_se_reduce (Conv2D)      (None, 1, 1, 16)     6160        block3b_se_reshape[0][0]         
__________________________________________________________________________________________________
block3b_se_expand (Conv2D)      (None, 1, 1, 384)    6528        block3b_se_reduce[0][0]          
__________________________________________________________________________________________________
block3b_se_excite (Multiply)    (None, 28, 28, 384)  0           block3b_activation[0][0]         
                                                                 block3b_se_expand[0][0]          
__________________________________________________________________________________________________
block3b_project_conv (Conv2D)   (None, 28, 28, 64)   24576       block3b_se_excite[0][0]          
__________________________________________________________________________________________________
block3b_project_bn (BatchNormal (None, 28, 28, 64)   256         block3b_project_conv[0][0]       
__________________________________________________________________________________________________
block3b_drop (Dropout)          (None, 28, 28, 64)   0           block3b_project_bn[0][0]         
__________________________________________________________________________________________________
block3b_add (Add)               (None, 28, 28, 64)   0           block3b_drop[0][0]               
                                                                 block3a_project_bn[0][0]         
__________________________________________________________________________________________________
block3c_expand_conv (Conv2D)    (None, 28, 28, 384)  24576       block3b_add[0][0]                
__________________________________________________________________________________________________
block3c_expand_bn (BatchNormali (None, 28, 28, 384)  1536        block3c_expand_conv[0][0]        
__________________________________________________________________________________________________
block3c_expand_activation (Acti (None, 28, 28, 384)  0           block3c_expand_bn[0][0]          
__________________________________________________________________________________________________
block3c_dwconv (DepthwiseConv2D (None, 28, 28, 384)  9600        block3c_expand_activation[0][0]  
__________________________________________________________________________________________________
block3c_bn (BatchNormalization) (None, 28, 28, 384)  1536        block3c_dwconv[0][0]             
__________________________________________________________________________________________________
block3c_activation (Activation) (None, 28, 28, 384)  0           block3c_bn[0][0]                 
__________________________________________________________________________________________________
block3c_se_squeeze (GlobalAvera (None, 384)          0           block3c_activation[0][0]         
__________________________________________________________________________________________________
block3c_se_reshape (Reshape)    (None, 1, 1, 384)    0           block3c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3c_se_reduce (Conv2D)      (None, 1, 1, 16)     6160        block3c_se_reshape[0][0]         
__________________________________________________________________________________________________
block3c_se_expand (Conv2D)      (None, 1, 1, 384)    6528        block3c_se_reduce[0][0]          
__________________________________________________________________________________________________
block3c_se_excite (Multiply)    (None, 28, 28, 384)  0           block3c_activation[0][0]         
                                                                 block3c_se_expand[0][0]          
__________________________________________________________________________________________________
block3c_project_conv (Conv2D)   (None, 28, 28, 64)   24576       block3c_se_excite[0][0]          
__________________________________________________________________________________________________
block3c_project_bn (BatchNormal (None, 28, 28, 64)   256         block3c_project_conv[0][0]       
__________________________________________________________________________________________________
block3c_drop (Dropout)          (None, 28, 28, 64)   0           block3c_project_bn[0][0]         
__________________________________________________________________________________________________
block3c_add (Add)               (None, 28, 28, 64)   0           block3c_drop[0][0]               
                                                                 block3b_add[0][0]                
__________________________________________________________________________________________________
block3d_expand_conv (Conv2D)    (None, 28, 28, 384)  24576       block3c_add[0][0]                
__________________________________________________________________________________________________
block3d_expand_bn (BatchNormali (None, 28, 28, 384)  1536        block3d_expand_conv[0][0]        
__________________________________________________________________________________________________
block3d_expand_activation (Acti (None, 28, 28, 384)  0           block3d_expand_bn[0][0]          
__________________________________________________________________________________________________
block3d_dwconv (DepthwiseConv2D (None, 28, 28, 384)  9600        block3d_expand_activation[0][0]  
__________________________________________________________________________________________________
block3d_bn (BatchNormalization) (None, 28, 28, 384)  1536        block3d_dwconv[0][0]             
__________________________________________________________________________________________________
block3d_activation (Activation) (None, 28, 28, 384)  0           block3d_bn[0][0]                 
__________________________________________________________________________________________________
block3d_se_squeeze (GlobalAvera (None, 384)          0           block3d_activation[0][0]         
__________________________________________________________________________________________________
block3d_se_reshape (Reshape)    (None, 1, 1, 384)    0           block3d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3d_se_reduce (Conv2D)      (None, 1, 1, 16)     6160        block3d_se_reshape[0][0]         
__________________________________________________________________________________________________
block3d_se_expand (Conv2D)      (None, 1, 1, 384)    6528        block3d_se_reduce[0][0]          
__________________________________________________________________________________________________
block3d_se_excite (Multiply)    (None, 28, 28, 384)  0           block3d_activation[0][0]         
                                                                 block3d_se_expand[0][0]          
__________________________________________________________________________________________________
block3d_project_conv (Conv2D)   (None, 28, 28, 64)   24576       block3d_se_excite[0][0]          
__________________________________________________________________________________________________
block3d_project_bn (BatchNormal (None, 28, 28, 64)   256         block3d_project_conv[0][0]       
__________________________________________________________________________________________________
block3d_drop (Dropout)          (None, 28, 28, 64)   0           block3d_project_bn[0][0]         
__________________________________________________________________________________________________
block3d_add (Add)               (None, 28, 28, 64)   0           block3d_drop[0][0]               
                                                                 block3c_add[0][0]                
__________________________________________________________________________________________________
block3e_expand_conv (Conv2D)    (None, 28, 28, 384)  24576       block3d_add[0][0]                
__________________________________________________________________________________________________
block3e_expand_bn (BatchNormali (None, 28, 28, 384)  1536        block3e_expand_conv[0][0]        
__________________________________________________________________________________________________
block3e_expand_activation (Acti (None, 28, 28, 384)  0           block3e_expand_bn[0][0]          
__________________________________________________________________________________________________
block3e_dwconv (DepthwiseConv2D (None, 28, 28, 384)  9600        block3e_expand_activation[0][0]  
__________________________________________________________________________________________________
block3e_bn (BatchNormalization) (None, 28, 28, 384)  1536        block3e_dwconv[0][0]             
__________________________________________________________________________________________________
block3e_activation (Activation) (None, 28, 28, 384)  0           block3e_bn[0][0]                 
__________________________________________________________________________________________________
block3e_se_squeeze (GlobalAvera (None, 384)          0           block3e_activation[0][0]         
__________________________________________________________________________________________________
block3e_se_reshape (Reshape)    (None, 1, 1, 384)    0           block3e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block3e_se_reduce (Conv2D)      (None, 1, 1, 16)     6160        block3e_se_reshape[0][0]         
__________________________________________________________________________________________________
block3e_se_expand (Conv2D)      (None, 1, 1, 384)    6528        block3e_se_reduce[0][0]          
__________________________________________________________________________________________________
block3e_se_excite (Multiply)    (None, 28, 28, 384)  0           block3e_activation[0][0]         
                                                                 block3e_se_expand[0][0]          
__________________________________________________________________________________________________
block3e_project_conv (Conv2D)   (None, 28, 28, 64)   24576       block3e_se_excite[0][0]          
__________________________________________________________________________________________________
block3e_project_bn (BatchNormal (None, 28, 28, 64)   256         block3e_project_conv[0][0]       
__________________________________________________________________________________________________
block3e_drop (Dropout)          (None, 28, 28, 64)   0           block3e_project_bn[0][0]         
__________________________________________________________________________________________________
block3e_add (Add)               (None, 28, 28, 64)   0           block3e_drop[0][0]               
                                                                 block3d_add[0][0]                
__________________________________________________________________________________________________
block4a_expand_conv (Conv2D)    (None, 28, 28, 384)  24576       block3e_add[0][0]                
__________________________________________________________________________________________________
block4a_expand_bn (BatchNormali (None, 28, 28, 384)  1536        block4a_expand_conv[0][0]        
__________________________________________________________________________________________________
block4a_expand_activation (Acti (None, 28, 28, 384)  0           block4a_expand_bn[0][0]          
__________________________________________________________________________________________________
block4a_dwconv_pad (ZeroPadding (None, 29, 29, 384)  0           block4a_expand_activation[0][0]  
__________________________________________________________________________________________________
block4a_dwconv (DepthwiseConv2D (None, 14, 14, 384)  3456        block4a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block4a_bn (BatchNormalization) (None, 14, 14, 384)  1536        block4a_dwconv[0][0]             
__________________________________________________________________________________________________
block4a_activation (Activation) (None, 14, 14, 384)  0           block4a_bn[0][0]                 
__________________________________________________________________________________________________
block4a_se_squeeze (GlobalAvera (None, 384)          0           block4a_activation[0][0]         
__________________________________________________________________________________________________
block4a_se_reshape (Reshape)    (None, 1, 1, 384)    0           block4a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4a_se_reduce (Conv2D)      (None, 1, 1, 16)     6160        block4a_se_reshape[0][0]         
__________________________________________________________________________________________________
block4a_se_expand (Conv2D)      (None, 1, 1, 384)    6528        block4a_se_reduce[0][0]          
__________________________________________________________________________________________________
block4a_se_excite (Multiply)    (None, 14, 14, 384)  0           block4a_activation[0][0]         
                                                                 block4a_se_expand[0][0]          
__________________________________________________________________________________________________
block4a_project_conv (Conv2D)   (None, 14, 14, 128)  49152       block4a_se_excite[0][0]          
__________________________________________________________________________________________________
block4a_project_bn (BatchNormal (None, 14, 14, 128)  512         block4a_project_conv[0][0]       
__________________________________________________________________________________________________
block4b_expand_conv (Conv2D)    (None, 14, 14, 768)  98304       block4a_project_bn[0][0]         
__________________________________________________________________________________________________
block4b_expand_bn (BatchNormali (None, 14, 14, 768)  3072        block4b_expand_conv[0][0]        
__________________________________________________________________________________________________
block4b_expand_activation (Acti (None, 14, 14, 768)  0           block4b_expand_bn[0][0]          
__________________________________________________________________________________________________
block4b_dwconv (DepthwiseConv2D (None, 14, 14, 768)  6912        block4b_expand_activation[0][0]  
__________________________________________________________________________________________________
block4b_bn (BatchNormalization) (None, 14, 14, 768)  3072        block4b_dwconv[0][0]             
__________________________________________________________________________________________________
block4b_activation (Activation) (None, 14, 14, 768)  0           block4b_bn[0][0]                 
__________________________________________________________________________________________________
block4b_se_squeeze (GlobalAvera (None, 768)          0           block4b_activation[0][0]         
__________________________________________________________________________________________________
block4b_se_reshape (Reshape)    (None, 1, 1, 768)    0           block4b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4b_se_reduce (Conv2D)      (None, 1, 1, 32)     24608       block4b_se_reshape[0][0]         
__________________________________________________________________________________________________
block4b_se_expand (Conv2D)      (None, 1, 1, 768)    25344       block4b_se_reduce[0][0]          
__________________________________________________________________________________________________
block4b_se_excite (Multiply)    (None, 14, 14, 768)  0           block4b_activation[0][0]         
                                                                 block4b_se_expand[0][0]          
__________________________________________________________________________________________________
block4b_project_conv (Conv2D)   (None, 14, 14, 128)  98304       block4b_se_excite[0][0]          
__________________________________________________________________________________________________
block4b_project_bn (BatchNormal (None, 14, 14, 128)  512         block4b_project_conv[0][0]       
__________________________________________________________________________________________________
block4b_drop (Dropout)          (None, 14, 14, 128)  0           block4b_project_bn[0][0]         
__________________________________________________________________________________________________
block4b_add (Add)               (None, 14, 14, 128)  0           block4b_drop[0][0]               
                                                                 block4a_project_bn[0][0]         
__________________________________________________________________________________________________
block4c_expand_conv (Conv2D)    (None, 14, 14, 768)  98304       block4b_add[0][0]                
__________________________________________________________________________________________________
block4c_expand_bn (BatchNormali (None, 14, 14, 768)  3072        block4c_expand_conv[0][0]        
__________________________________________________________________________________________________
block4c_expand_activation (Acti (None, 14, 14, 768)  0           block4c_expand_bn[0][0]          
__________________________________________________________________________________________________
block4c_dwconv (DepthwiseConv2D (None, 14, 14, 768)  6912        block4c_expand_activation[0][0]  
__________________________________________________________________________________________________
block4c_bn (BatchNormalization) (None, 14, 14, 768)  3072        block4c_dwconv[0][0]             
__________________________________________________________________________________________________
block4c_activation (Activation) (None, 14, 14, 768)  0           block4c_bn[0][0]                 
__________________________________________________________________________________________________
block4c_se_squeeze (GlobalAvera (None, 768)          0           block4c_activation[0][0]         
__________________________________________________________________________________________________
block4c_se_reshape (Reshape)    (None, 1, 1, 768)    0           block4c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4c_se_reduce (Conv2D)      (None, 1, 1, 32)     24608       block4c_se_reshape[0][0]         
__________________________________________________________________________________________________
block4c_se_expand (Conv2D)      (None, 1, 1, 768)    25344       block4c_se_reduce[0][0]          
__________________________________________________________________________________________________
block4c_se_excite (Multiply)    (None, 14, 14, 768)  0           block4c_activation[0][0]         
                                                                 block4c_se_expand[0][0]          
__________________________________________________________________________________________________
block4c_project_conv (Conv2D)   (None, 14, 14, 128)  98304       block4c_se_excite[0][0]          
__________________________________________________________________________________________________
block4c_project_bn (BatchNormal (None, 14, 14, 128)  512         block4c_project_conv[0][0]       
__________________________________________________________________________________________________
block4c_drop (Dropout)          (None, 14, 14, 128)  0           block4c_project_bn[0][0]         
__________________________________________________________________________________________________
block4c_add (Add)               (None, 14, 14, 128)  0           block4c_drop[0][0]               
                                                                 block4b_add[0][0]                
__________________________________________________________________________________________________
block4d_expand_conv (Conv2D)    (None, 14, 14, 768)  98304       block4c_add[0][0]                
__________________________________________________________________________________________________
block4d_expand_bn (BatchNormali (None, 14, 14, 768)  3072        block4d_expand_conv[0][0]        
__________________________________________________________________________________________________
block4d_expand_activation (Acti (None, 14, 14, 768)  0           block4d_expand_bn[0][0]          
__________________________________________________________________________________________________
block4d_dwconv (DepthwiseConv2D (None, 14, 14, 768)  6912        block4d_expand_activation[0][0]  
__________________________________________________________________________________________________
block4d_bn (BatchNormalization) (None, 14, 14, 768)  3072        block4d_dwconv[0][0]             
__________________________________________________________________________________________________
block4d_activation (Activation) (None, 14, 14, 768)  0           block4d_bn[0][0]                 
__________________________________________________________________________________________________
block4d_se_squeeze (GlobalAvera (None, 768)          0           block4d_activation[0][0]         
__________________________________________________________________________________________________
block4d_se_reshape (Reshape)    (None, 1, 1, 768)    0           block4d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4d_se_reduce (Conv2D)      (None, 1, 1, 32)     24608       block4d_se_reshape[0][0]         
__________________________________________________________________________________________________
block4d_se_expand (Conv2D)      (None, 1, 1, 768)    25344       block4d_se_reduce[0][0]          
__________________________________________________________________________________________________
block4d_se_excite (Multiply)    (None, 14, 14, 768)  0           block4d_activation[0][0]         
                                                                 block4d_se_expand[0][0]          
__________________________________________________________________________________________________
block4d_project_conv (Conv2D)   (None, 14, 14, 128)  98304       block4d_se_excite[0][0]          
__________________________________________________________________________________________________
block4d_project_bn (BatchNormal (None, 14, 14, 128)  512         block4d_project_conv[0][0]       
__________________________________________________________________________________________________
block4d_drop (Dropout)          (None, 14, 14, 128)  0           block4d_project_bn[0][0]         
__________________________________________________________________________________________________
block4d_add (Add)               (None, 14, 14, 128)  0           block4d_drop[0][0]               
                                                                 block4c_add[0][0]                
__________________________________________________________________________________________________
block4e_expand_conv (Conv2D)    (None, 14, 14, 768)  98304       block4d_add[0][0]                
__________________________________________________________________________________________________
block4e_expand_bn (BatchNormali (None, 14, 14, 768)  3072        block4e_expand_conv[0][0]        
__________________________________________________________________________________________________
block4e_expand_activation (Acti (None, 14, 14, 768)  0           block4e_expand_bn[0][0]          
__________________________________________________________________________________________________
block4e_dwconv (DepthwiseConv2D (None, 14, 14, 768)  6912        block4e_expand_activation[0][0]  
__________________________________________________________________________________________________
block4e_bn (BatchNormalization) (None, 14, 14, 768)  3072        block4e_dwconv[0][0]             
__________________________________________________________________________________________________
block4e_activation (Activation) (None, 14, 14, 768)  0           block4e_bn[0][0]                 
__________________________________________________________________________________________________
block4e_se_squeeze (GlobalAvera (None, 768)          0           block4e_activation[0][0]         
__________________________________________________________________________________________________
block4e_se_reshape (Reshape)    (None, 1, 1, 768)    0           block4e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4e_se_reduce (Conv2D)      (None, 1, 1, 32)     24608       block4e_se_reshape[0][0]         
__________________________________________________________________________________________________
block4e_se_expand (Conv2D)      (None, 1, 1, 768)    25344       block4e_se_reduce[0][0]          
__________________________________________________________________________________________________
block4e_se_excite (Multiply)    (None, 14, 14, 768)  0           block4e_activation[0][0]         
                                                                 block4e_se_expand[0][0]          
__________________________________________________________________________________________________
block4e_project_conv (Conv2D)   (None, 14, 14, 128)  98304       block4e_se_excite[0][0]          
__________________________________________________________________________________________________
block4e_project_bn (BatchNormal (None, 14, 14, 128)  512         block4e_project_conv[0][0]       
__________________________________________________________________________________________________
block4e_drop (Dropout)          (None, 14, 14, 128)  0           block4e_project_bn[0][0]         
__________________________________________________________________________________________________
block4e_add (Add)               (None, 14, 14, 128)  0           block4e_drop[0][0]               
                                                                 block4d_add[0][0]                
__________________________________________________________________________________________________
block4f_expand_conv (Conv2D)    (None, 14, 14, 768)  98304       block4e_add[0][0]                
__________________________________________________________________________________________________
block4f_expand_bn (BatchNormali (None, 14, 14, 768)  3072        block4f_expand_conv[0][0]        
__________________________________________________________________________________________________
block4f_expand_activation (Acti (None, 14, 14, 768)  0           block4f_expand_bn[0][0]          
__________________________________________________________________________________________________
block4f_dwconv (DepthwiseConv2D (None, 14, 14, 768)  6912        block4f_expand_activation[0][0]  
__________________________________________________________________________________________________
block4f_bn (BatchNormalization) (None, 14, 14, 768)  3072        block4f_dwconv[0][0]             
__________________________________________________________________________________________________
block4f_activation (Activation) (None, 14, 14, 768)  0           block4f_bn[0][0]                 
__________________________________________________________________________________________________
block4f_se_squeeze (GlobalAvera (None, 768)          0           block4f_activation[0][0]         
__________________________________________________________________________________________________
block4f_se_reshape (Reshape)    (None, 1, 1, 768)    0           block4f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4f_se_reduce (Conv2D)      (None, 1, 1, 32)     24608       block4f_se_reshape[0][0]         
__________________________________________________________________________________________________
block4f_se_expand (Conv2D)      (None, 1, 1, 768)    25344       block4f_se_reduce[0][0]          
__________________________________________________________________________________________________
block4f_se_excite (Multiply)    (None, 14, 14, 768)  0           block4f_activation[0][0]         
                                                                 block4f_se_expand[0][0]          
__________________________________________________________________________________________________
block4f_project_conv (Conv2D)   (None, 14, 14, 128)  98304       block4f_se_excite[0][0]          
__________________________________________________________________________________________________
block4f_project_bn (BatchNormal (None, 14, 14, 128)  512         block4f_project_conv[0][0]       
__________________________________________________________________________________________________
block4f_drop (Dropout)          (None, 14, 14, 128)  0           block4f_project_bn[0][0]         
__________________________________________________________________________________________________
block4f_add (Add)               (None, 14, 14, 128)  0           block4f_drop[0][0]               
                                                                 block4e_add[0][0]                
__________________________________________________________________________________________________
block4g_expand_conv (Conv2D)    (None, 14, 14, 768)  98304       block4f_add[0][0]                
__________________________________________________________________________________________________
block4g_expand_bn (BatchNormali (None, 14, 14, 768)  3072        block4g_expand_conv[0][0]        
__________________________________________________________________________________________________
block4g_expand_activation (Acti (None, 14, 14, 768)  0           block4g_expand_bn[0][0]          
__________________________________________________________________________________________________
block4g_dwconv (DepthwiseConv2D (None, 14, 14, 768)  6912        block4g_expand_activation[0][0]  
__________________________________________________________________________________________________
block4g_bn (BatchNormalization) (None, 14, 14, 768)  3072        block4g_dwconv[0][0]             
__________________________________________________________________________________________________
block4g_activation (Activation) (None, 14, 14, 768)  0           block4g_bn[0][0]                 
__________________________________________________________________________________________________
block4g_se_squeeze (GlobalAvera (None, 768)          0           block4g_activation[0][0]         
__________________________________________________________________________________________________
block4g_se_reshape (Reshape)    (None, 1, 1, 768)    0           block4g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block4g_se_reduce (Conv2D)      (None, 1, 1, 32)     24608       block4g_se_reshape[0][0]         
__________________________________________________________________________________________________
block4g_se_expand (Conv2D)      (None, 1, 1, 768)    25344       block4g_se_reduce[0][0]          
__________________________________________________________________________________________________
block4g_se_excite (Multiply)    (None, 14, 14, 768)  0           block4g_activation[0][0]         
                                                                 block4g_se_expand[0][0]          
__________________________________________________________________________________________________
block4g_project_conv (Conv2D)   (None, 14, 14, 128)  98304       block4g_se_excite[0][0]          
__________________________________________________________________________________________________
block4g_project_bn (BatchNormal (None, 14, 14, 128)  512         block4g_project_conv[0][0]       
__________________________________________________________________________________________________
block4g_drop (Dropout)          (None, 14, 14, 128)  0           block4g_project_bn[0][0]         
__________________________________________________________________________________________________
block4g_add (Add)               (None, 14, 14, 128)  0           block4g_drop[0][0]               
                                                                 block4f_add[0][0]                
__________________________________________________________________________________________________
block5a_expand_conv (Conv2D)    (None, 14, 14, 768)  98304       block4g_add[0][0]                
__________________________________________________________________________________________________
block5a_expand_bn (BatchNormali (None, 14, 14, 768)  3072        block5a_expand_conv[0][0]        
__________________________________________________________________________________________________
block5a_expand_activation (Acti (None, 14, 14, 768)  0           block5a_expand_bn[0][0]          
__________________________________________________________________________________________________
block5a_dwconv (DepthwiseConv2D (None, 14, 14, 768)  19200       block5a_expand_activation[0][0]  
__________________________________________________________________________________________________
block5a_bn (BatchNormalization) (None, 14, 14, 768)  3072        block5a_dwconv[0][0]             
__________________________________________________________________________________________________
block5a_activation (Activation) (None, 14, 14, 768)  0           block5a_bn[0][0]                 
__________________________________________________________________________________________________
block5a_se_squeeze (GlobalAvera (None, 768)          0           block5a_activation[0][0]         
__________________________________________________________________________________________________
block5a_se_reshape (Reshape)    (None, 1, 1, 768)    0           block5a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5a_se_reduce (Conv2D)      (None, 1, 1, 32)     24608       block5a_se_reshape[0][0]         
__________________________________________________________________________________________________
block5a_se_expand (Conv2D)      (None, 1, 1, 768)    25344       block5a_se_reduce[0][0]          
__________________________________________________________________________________________________
block5a_se_excite (Multiply)    (None, 14, 14, 768)  0           block5a_activation[0][0]         
                                                                 block5a_se_expand[0][0]          
__________________________________________________________________________________________________
block5a_project_conv (Conv2D)   (None, 14, 14, 176)  135168      block5a_se_excite[0][0]          
__________________________________________________________________________________________________
block5a_project_bn (BatchNormal (None, 14, 14, 176)  704         block5a_project_conv[0][0]       
__________________________________________________________________________________________________
block5b_expand_conv (Conv2D)    (None, 14, 14, 1056) 185856      block5a_project_bn[0][0]         
__________________________________________________________________________________________________
block5b_expand_bn (BatchNormali (None, 14, 14, 1056) 4224        block5b_expand_conv[0][0]        
__________________________________________________________________________________________________
block5b_expand_activation (Acti (None, 14, 14, 1056) 0           block5b_expand_bn[0][0]          
__________________________________________________________________________________________________
block5b_dwconv (DepthwiseConv2D (None, 14, 14, 1056) 26400       block5b_expand_activation[0][0]  
__________________________________________________________________________________________________
block5b_bn (BatchNormalization) (None, 14, 14, 1056) 4224        block5b_dwconv[0][0]             
__________________________________________________________________________________________________
block5b_activation (Activation) (None, 14, 14, 1056) 0           block5b_bn[0][0]                 
__________________________________________________________________________________________________
block5b_se_squeeze (GlobalAvera (None, 1056)         0           block5b_activation[0][0]         
__________________________________________________________________________________________________
block5b_se_reshape (Reshape)    (None, 1, 1, 1056)   0           block5b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5b_se_reduce (Conv2D)      (None, 1, 1, 44)     46508       block5b_se_reshape[0][0]         
__________________________________________________________________________________________________
block5b_se_expand (Conv2D)      (None, 1, 1, 1056)   47520       block5b_se_reduce[0][0]          
__________________________________________________________________________________________________
block5b_se_excite (Multiply)    (None, 14, 14, 1056) 0           block5b_activation[0][0]         
                                                                 block5b_se_expand[0][0]          
__________________________________________________________________________________________________
block5b_project_conv (Conv2D)   (None, 14, 14, 176)  185856      block5b_se_excite[0][0]          
__________________________________________________________________________________________________
block5b_project_bn (BatchNormal (None, 14, 14, 176)  704         block5b_project_conv[0][0]       
__________________________________________________________________________________________________
block5b_drop (Dropout)          (None, 14, 14, 176)  0           block5b_project_bn[0][0]         
__________________________________________________________________________________________________
block5b_add (Add)               (None, 14, 14, 176)  0           block5b_drop[0][0]               
                                                                 block5a_project_bn[0][0]         
__________________________________________________________________________________________________
block5c_expand_conv (Conv2D)    (None, 14, 14, 1056) 185856      block5b_add[0][0]                
__________________________________________________________________________________________________
block5c_expand_bn (BatchNormali (None, 14, 14, 1056) 4224        block5c_expand_conv[0][0]        
__________________________________________________________________________________________________
block5c_expand_activation (Acti (None, 14, 14, 1056) 0           block5c_expand_bn[0][0]          
__________________________________________________________________________________________________
block5c_dwconv (DepthwiseConv2D (None, 14, 14, 1056) 26400       block5c_expand_activation[0][0]  
__________________________________________________________________________________________________
block5c_bn (BatchNormalization) (None, 14, 14, 1056) 4224        block5c_dwconv[0][0]             
__________________________________________________________________________________________________
block5c_activation (Activation) (None, 14, 14, 1056) 0           block5c_bn[0][0]                 
__________________________________________________________________________________________________
block5c_se_squeeze (GlobalAvera (None, 1056)         0           block5c_activation[0][0]         
__________________________________________________________________________________________________
block5c_se_reshape (Reshape)    (None, 1, 1, 1056)   0           block5c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5c_se_reduce (Conv2D)      (None, 1, 1, 44)     46508       block5c_se_reshape[0][0]         
__________________________________________________________________________________________________
block5c_se_expand (Conv2D)      (None, 1, 1, 1056)   47520       block5c_se_reduce[0][0]          
__________________________________________________________________________________________________
block5c_se_excite (Multiply)    (None, 14, 14, 1056) 0           block5c_activation[0][0]         
                                                                 block5c_se_expand[0][0]          
__________________________________________________________________________________________________
block5c_project_conv (Conv2D)   (None, 14, 14, 176)  185856      block5c_se_excite[0][0]          
__________________________________________________________________________________________________
block5c_project_bn (BatchNormal (None, 14, 14, 176)  704         block5c_project_conv[0][0]       
__________________________________________________________________________________________________
block5c_drop (Dropout)          (None, 14, 14, 176)  0           block5c_project_bn[0][0]         
__________________________________________________________________________________________________
block5c_add (Add)               (None, 14, 14, 176)  0           block5c_drop[0][0]               
                                                                 block5b_add[0][0]                
__________________________________________________________________________________________________
block5d_expand_conv (Conv2D)    (None, 14, 14, 1056) 185856      block5c_add[0][0]                
__________________________________________________________________________________________________
block5d_expand_bn (BatchNormali (None, 14, 14, 1056) 4224        block5d_expand_conv[0][0]        
__________________________________________________________________________________________________
block5d_expand_activation (Acti (None, 14, 14, 1056) 0           block5d_expand_bn[0][0]          
__________________________________________________________________________________________________
block5d_dwconv (DepthwiseConv2D (None, 14, 14, 1056) 26400       block5d_expand_activation[0][0]  
__________________________________________________________________________________________________
block5d_bn (BatchNormalization) (None, 14, 14, 1056) 4224        block5d_dwconv[0][0]             
__________________________________________________________________________________________________
block5d_activation (Activation) (None, 14, 14, 1056) 0           block5d_bn[0][0]                 
__________________________________________________________________________________________________
block5d_se_squeeze (GlobalAvera (None, 1056)         0           block5d_activation[0][0]         
__________________________________________________________________________________________________
block5d_se_reshape (Reshape)    (None, 1, 1, 1056)   0           block5d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5d_se_reduce (Conv2D)      (None, 1, 1, 44)     46508       block5d_se_reshape[0][0]         
__________________________________________________________________________________________________
block5d_se_expand (Conv2D)      (None, 1, 1, 1056)   47520       block5d_se_reduce[0][0]          
__________________________________________________________________________________________________
block5d_se_excite (Multiply)    (None, 14, 14, 1056) 0           block5d_activation[0][0]         
                                                                 block5d_se_expand[0][0]          
__________________________________________________________________________________________________
block5d_project_conv (Conv2D)   (None, 14, 14, 176)  185856      block5d_se_excite[0][0]          
__________________________________________________________________________________________________
block5d_project_bn (BatchNormal (None, 14, 14, 176)  704         block5d_project_conv[0][0]       
__________________________________________________________________________________________________
block5d_drop (Dropout)          (None, 14, 14, 176)  0           block5d_project_bn[0][0]         
__________________________________________________________________________________________________
block5d_add (Add)               (None, 14, 14, 176)  0           block5d_drop[0][0]               
                                                                 block5c_add[0][0]                
__________________________________________________________________________________________________
block5e_expand_conv (Conv2D)    (None, 14, 14, 1056) 185856      block5d_add[0][0]                
__________________________________________________________________________________________________
block5e_expand_bn (BatchNormali (None, 14, 14, 1056) 4224        block5e_expand_conv[0][0]        
__________________________________________________________________________________________________
block5e_expand_activation (Acti (None, 14, 14, 1056) 0           block5e_expand_bn[0][0]          
__________________________________________________________________________________________________
block5e_dwconv (DepthwiseConv2D (None, 14, 14, 1056) 26400       block5e_expand_activation[0][0]  
__________________________________________________________________________________________________
block5e_bn (BatchNormalization) (None, 14, 14, 1056) 4224        block5e_dwconv[0][0]             
__________________________________________________________________________________________________
block5e_activation (Activation) (None, 14, 14, 1056) 0           block5e_bn[0][0]                 
__________________________________________________________________________________________________
block5e_se_squeeze (GlobalAvera (None, 1056)         0           block5e_activation[0][0]         
__________________________________________________________________________________________________
block5e_se_reshape (Reshape)    (None, 1, 1, 1056)   0           block5e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5e_se_reduce (Conv2D)      (None, 1, 1, 44)     46508       block5e_se_reshape[0][0]         
__________________________________________________________________________________________________
block5e_se_expand (Conv2D)      (None, 1, 1, 1056)   47520       block5e_se_reduce[0][0]          
__________________________________________________________________________________________________
block5e_se_excite (Multiply)    (None, 14, 14, 1056) 0           block5e_activation[0][0]         
                                                                 block5e_se_expand[0][0]          
__________________________________________________________________________________________________
block5e_project_conv (Conv2D)   (None, 14, 14, 176)  185856      block5e_se_excite[0][0]          
__________________________________________________________________________________________________
block5e_project_bn (BatchNormal (None, 14, 14, 176)  704         block5e_project_conv[0][0]       
__________________________________________________________________________________________________
block5e_drop (Dropout)          (None, 14, 14, 176)  0           block5e_project_bn[0][0]         
__________________________________________________________________________________________________
block5e_add (Add)               (None, 14, 14, 176)  0           block5e_drop[0][0]               
                                                                 block5d_add[0][0]                
__________________________________________________________________________________________________
block5f_expand_conv (Conv2D)    (None, 14, 14, 1056) 185856      block5e_add[0][0]                
__________________________________________________________________________________________________
block5f_expand_bn (BatchNormali (None, 14, 14, 1056) 4224        block5f_expand_conv[0][0]        
__________________________________________________________________________________________________
block5f_expand_activation (Acti (None, 14, 14, 1056) 0           block5f_expand_bn[0][0]          
__________________________________________________________________________________________________
block5f_dwconv (DepthwiseConv2D (None, 14, 14, 1056) 26400       block5f_expand_activation[0][0]  
__________________________________________________________________________________________________
block5f_bn (BatchNormalization) (None, 14, 14, 1056) 4224        block5f_dwconv[0][0]             
__________________________________________________________________________________________________
block5f_activation (Activation) (None, 14, 14, 1056) 0           block5f_bn[0][0]                 
__________________________________________________________________________________________________
block5f_se_squeeze (GlobalAvera (None, 1056)         0           block5f_activation[0][0]         
__________________________________________________________________________________________________
block5f_se_reshape (Reshape)    (None, 1, 1, 1056)   0           block5f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5f_se_reduce (Conv2D)      (None, 1, 1, 44)     46508       block5f_se_reshape[0][0]         
__________________________________________________________________________________________________
block5f_se_expand (Conv2D)      (None, 1, 1, 1056)   47520       block5f_se_reduce[0][0]          
__________________________________________________________________________________________________
block5f_se_excite (Multiply)    (None, 14, 14, 1056) 0           block5f_activation[0][0]         
                                                                 block5f_se_expand[0][0]          
__________________________________________________________________________________________________
block5f_project_conv (Conv2D)   (None, 14, 14, 176)  185856      block5f_se_excite[0][0]          
__________________________________________________________________________________________________
block5f_project_bn (BatchNormal (None, 14, 14, 176)  704         block5f_project_conv[0][0]       
__________________________________________________________________________________________________
block5f_drop (Dropout)          (None, 14, 14, 176)  0           block5f_project_bn[0][0]         
__________________________________________________________________________________________________
block5f_add (Add)               (None, 14, 14, 176)  0           block5f_drop[0][0]               
                                                                 block5e_add[0][0]                
__________________________________________________________________________________________________
block5g_expand_conv (Conv2D)    (None, 14, 14, 1056) 185856      block5f_add[0][0]                
__________________________________________________________________________________________________
block5g_expand_bn (BatchNormali (None, 14, 14, 1056) 4224        block5g_expand_conv[0][0]        
__________________________________________________________________________________________________
block5g_expand_activation (Acti (None, 14, 14, 1056) 0           block5g_expand_bn[0][0]          
__________________________________________________________________________________________________
block5g_dwconv (DepthwiseConv2D (None, 14, 14, 1056) 26400       block5g_expand_activation[0][0]  
__________________________________________________________________________________________________
block5g_bn (BatchNormalization) (None, 14, 14, 1056) 4224        block5g_dwconv[0][0]             
__________________________________________________________________________________________________
block5g_activation (Activation) (None, 14, 14, 1056) 0           block5g_bn[0][0]                 
__________________________________________________________________________________________________
block5g_se_squeeze (GlobalAvera (None, 1056)         0           block5g_activation[0][0]         
__________________________________________________________________________________________________
block5g_se_reshape (Reshape)    (None, 1, 1, 1056)   0           block5g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block5g_se_reduce (Conv2D)      (None, 1, 1, 44)     46508       block5g_se_reshape[0][0]         
__________________________________________________________________________________________________
block5g_se_expand (Conv2D)      (None, 1, 1, 1056)   47520       block5g_se_reduce[0][0]          
__________________________________________________________________________________________________
block5g_se_excite (Multiply)    (None, 14, 14, 1056) 0           block5g_activation[0][0]         
                                                                 block5g_se_expand[0][0]          
__________________________________________________________________________________________________
block5g_project_conv (Conv2D)   (None, 14, 14, 176)  185856      block5g_se_excite[0][0]          
__________________________________________________________________________________________________
block5g_project_bn (BatchNormal (None, 14, 14, 176)  704         block5g_project_conv[0][0]       
__________________________________________________________________________________________________
block5g_drop (Dropout)          (None, 14, 14, 176)  0           block5g_project_bn[0][0]         
__________________________________________________________________________________________________
block5g_add (Add)               (None, 14, 14, 176)  0           block5g_drop[0][0]               
                                                                 block5f_add[0][0]                
__________________________________________________________________________________________________
block6a_expand_conv (Conv2D)    (None, 14, 14, 1056) 185856      block5g_add[0][0]                
__________________________________________________________________________________________________
block6a_expand_bn (BatchNormali (None, 14, 14, 1056) 4224        block6a_expand_conv[0][0]        
__________________________________________________________________________________________________
block6a_expand_activation (Acti (None, 14, 14, 1056) 0           block6a_expand_bn[0][0]          
__________________________________________________________________________________________________
block6a_dwconv_pad (ZeroPadding (None, 17, 17, 1056) 0           block6a_expand_activation[0][0]  
__________________________________________________________________________________________________
block6a_dwconv (DepthwiseConv2D (None, 7, 7, 1056)   26400       block6a_dwconv_pad[0][0]         
__________________________________________________________________________________________________
block6a_bn (BatchNormalization) (None, 7, 7, 1056)   4224        block6a_dwconv[0][0]             
__________________________________________________________________________________________________
block6a_activation (Activation) (None, 7, 7, 1056)   0           block6a_bn[0][0]                 
__________________________________________________________________________________________________
block6a_se_squeeze (GlobalAvera (None, 1056)         0           block6a_activation[0][0]         
__________________________________________________________________________________________________
block6a_se_reshape (Reshape)    (None, 1, 1, 1056)   0           block6a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6a_se_reduce (Conv2D)      (None, 1, 1, 44)     46508       block6a_se_reshape[0][0]         
__________________________________________________________________________________________________
block6a_se_expand (Conv2D)      (None, 1, 1, 1056)   47520       block6a_se_reduce[0][0]          
__________________________________________________________________________________________________
block6a_se_excite (Multiply)    (None, 7, 7, 1056)   0           block6a_activation[0][0]         
                                                                 block6a_se_expand[0][0]          
__________________________________________________________________________________________________
block6a_project_conv (Conv2D)   (None, 7, 7, 304)    321024      block6a_se_excite[0][0]          
__________________________________________________________________________________________________
block6a_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6a_project_conv[0][0]       
__________________________________________________________________________________________________
block6b_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6a_project_bn[0][0]         
__________________________________________________________________________________________________
block6b_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6b_expand_conv[0][0]        
__________________________________________________________________________________________________
block6b_expand_activation (Acti (None, 7, 7, 1824)   0           block6b_expand_bn[0][0]          
__________________________________________________________________________________________________
block6b_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6b_expand_activation[0][0]  
__________________________________________________________________________________________________
block6b_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6b_dwconv[0][0]             
__________________________________________________________________________________________________
block6b_activation (Activation) (None, 7, 7, 1824)   0           block6b_bn[0][0]                 
__________________________________________________________________________________________________
block6b_se_squeeze (GlobalAvera (None, 1824)         0           block6b_activation[0][0]         
__________________________________________________________________________________________________
block6b_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6b_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6b_se_reshape[0][0]         
__________________________________________________________________________________________________
block6b_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6b_se_reduce[0][0]          
__________________________________________________________________________________________________
block6b_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6b_activation[0][0]         
                                                                 block6b_se_expand[0][0]          
__________________________________________________________________________________________________
block6b_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6b_se_excite[0][0]          
__________________________________________________________________________________________________
block6b_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6b_project_conv[0][0]       
__________________________________________________________________________________________________
block6b_drop (Dropout)          (None, 7, 7, 304)    0           block6b_project_bn[0][0]         
__________________________________________________________________________________________________
block6b_add (Add)               (None, 7, 7, 304)    0           block6b_drop[0][0]               
                                                                 block6a_project_bn[0][0]         
__________________________________________________________________________________________________
block6c_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6b_add[0][0]                
__________________________________________________________________________________________________
block6c_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6c_expand_conv[0][0]        
__________________________________________________________________________________________________
block6c_expand_activation (Acti (None, 7, 7, 1824)   0           block6c_expand_bn[0][0]          
__________________________________________________________________________________________________
block6c_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6c_expand_activation[0][0]  
__________________________________________________________________________________________________
block6c_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6c_dwconv[0][0]             
__________________________________________________________________________________________________
block6c_activation (Activation) (None, 7, 7, 1824)   0           block6c_bn[0][0]                 
__________________________________________________________________________________________________
block6c_se_squeeze (GlobalAvera (None, 1824)         0           block6c_activation[0][0]         
__________________________________________________________________________________________________
block6c_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6c_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6c_se_reshape[0][0]         
__________________________________________________________________________________________________
block6c_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6c_se_reduce[0][0]          
__________________________________________________________________________________________________
block6c_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6c_activation[0][0]         
                                                                 block6c_se_expand[0][0]          
__________________________________________________________________________________________________
block6c_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6c_se_excite[0][0]          
__________________________________________________________________________________________________
block6c_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6c_project_conv[0][0]       
__________________________________________________________________________________________________
block6c_drop (Dropout)          (None, 7, 7, 304)    0           block6c_project_bn[0][0]         
__________________________________________________________________________________________________
block6c_add (Add)               (None, 7, 7, 304)    0           block6c_drop[0][0]               
                                                                 block6b_add[0][0]                
__________________________________________________________________________________________________
block6d_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6c_add[0][0]                
__________________________________________________________________________________________________
block6d_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6d_expand_conv[0][0]        
__________________________________________________________________________________________________
block6d_expand_activation (Acti (None, 7, 7, 1824)   0           block6d_expand_bn[0][0]          
__________________________________________________________________________________________________
block6d_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6d_expand_activation[0][0]  
__________________________________________________________________________________________________
block6d_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6d_dwconv[0][0]             
__________________________________________________________________________________________________
block6d_activation (Activation) (None, 7, 7, 1824)   0           block6d_bn[0][0]                 
__________________________________________________________________________________________________
block6d_se_squeeze (GlobalAvera (None, 1824)         0           block6d_activation[0][0]         
__________________________________________________________________________________________________
block6d_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6d_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6d_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6d_se_reshape[0][0]         
__________________________________________________________________________________________________
block6d_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6d_se_reduce[0][0]          
__________________________________________________________________________________________________
block6d_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6d_activation[0][0]         
                                                                 block6d_se_expand[0][0]          
__________________________________________________________________________________________________
block6d_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6d_se_excite[0][0]          
__________________________________________________________________________________________________
block6d_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6d_project_conv[0][0]       
__________________________________________________________________________________________________
block6d_drop (Dropout)          (None, 7, 7, 304)    0           block6d_project_bn[0][0]         
__________________________________________________________________________________________________
block6d_add (Add)               (None, 7, 7, 304)    0           block6d_drop[0][0]               
                                                                 block6c_add[0][0]                
__________________________________________________________________________________________________
block6e_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6d_add[0][0]                
__________________________________________________________________________________________________
block6e_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6e_expand_conv[0][0]        
__________________________________________________________________________________________________
block6e_expand_activation (Acti (None, 7, 7, 1824)   0           block6e_expand_bn[0][0]          
__________________________________________________________________________________________________
block6e_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6e_expand_activation[0][0]  
__________________________________________________________________________________________________
block6e_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6e_dwconv[0][0]             
__________________________________________________________________________________________________
block6e_activation (Activation) (None, 7, 7, 1824)   0           block6e_bn[0][0]                 
__________________________________________________________________________________________________
block6e_se_squeeze (GlobalAvera (None, 1824)         0           block6e_activation[0][0]         
__________________________________________________________________________________________________
block6e_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6e_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6e_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6e_se_reshape[0][0]         
__________________________________________________________________________________________________
block6e_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6e_se_reduce[0][0]          
__________________________________________________________________________________________________
block6e_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6e_activation[0][0]         
                                                                 block6e_se_expand[0][0]          
__________________________________________________________________________________________________
block6e_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6e_se_excite[0][0]          
__________________________________________________________________________________________________
block6e_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6e_project_conv[0][0]       
__________________________________________________________________________________________________
block6e_drop (Dropout)          (None, 7, 7, 304)    0           block6e_project_bn[0][0]         
__________________________________________________________________________________________________
block6e_add (Add)               (None, 7, 7, 304)    0           block6e_drop[0][0]               
                                                                 block6d_add[0][0]                
__________________________________________________________________________________________________
block6f_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6e_add[0][0]                
__________________________________________________________________________________________________
block6f_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6f_expand_conv[0][0]        
__________________________________________________________________________________________________
block6f_expand_activation (Acti (None, 7, 7, 1824)   0           block6f_expand_bn[0][0]          
__________________________________________________________________________________________________
block6f_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6f_expand_activation[0][0]  
__________________________________________________________________________________________________
block6f_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6f_dwconv[0][0]             
__________________________________________________________________________________________________
block6f_activation (Activation) (None, 7, 7, 1824)   0           block6f_bn[0][0]                 
__________________________________________________________________________________________________
block6f_se_squeeze (GlobalAvera (None, 1824)         0           block6f_activation[0][0]         
__________________________________________________________________________________________________
block6f_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6f_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6f_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6f_se_reshape[0][0]         
__________________________________________________________________________________________________
block6f_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6f_se_reduce[0][0]          
__________________________________________________________________________________________________
block6f_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6f_activation[0][0]         
                                                                 block6f_se_expand[0][0]          
__________________________________________________________________________________________________
block6f_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6f_se_excite[0][0]          
__________________________________________________________________________________________________
block6f_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6f_project_conv[0][0]       
__________________________________________________________________________________________________
block6f_drop (Dropout)          (None, 7, 7, 304)    0           block6f_project_bn[0][0]         
__________________________________________________________________________________________________
block6f_add (Add)               (None, 7, 7, 304)    0           block6f_drop[0][0]               
                                                                 block6e_add[0][0]                
__________________________________________________________________________________________________
block6g_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6f_add[0][0]                
__________________________________________________________________________________________________
block6g_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6g_expand_conv[0][0]        
__________________________________________________________________________________________________
block6g_expand_activation (Acti (None, 7, 7, 1824)   0           block6g_expand_bn[0][0]          
__________________________________________________________________________________________________
block6g_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6g_expand_activation[0][0]  
__________________________________________________________________________________________________
block6g_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6g_dwconv[0][0]             
__________________________________________________________________________________________________
block6g_activation (Activation) (None, 7, 7, 1824)   0           block6g_bn[0][0]                 
__________________________________________________________________________________________________
block6g_se_squeeze (GlobalAvera (None, 1824)         0           block6g_activation[0][0]         
__________________________________________________________________________________________________
block6g_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6g_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6g_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6g_se_reshape[0][0]         
__________________________________________________________________________________________________
block6g_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6g_se_reduce[0][0]          
__________________________________________________________________________________________________
block6g_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6g_activation[0][0]         
                                                                 block6g_se_expand[0][0]          
__________________________________________________________________________________________________
block6g_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6g_se_excite[0][0]          
__________________________________________________________________________________________________
block6g_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6g_project_conv[0][0]       
__________________________________________________________________________________________________
block6g_drop (Dropout)          (None, 7, 7, 304)    0           block6g_project_bn[0][0]         
__________________________________________________________________________________________________
block6g_add (Add)               (None, 7, 7, 304)    0           block6g_drop[0][0]               
                                                                 block6f_add[0][0]                
__________________________________________________________________________________________________
block6h_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6g_add[0][0]                
__________________________________________________________________________________________________
block6h_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6h_expand_conv[0][0]        
__________________________________________________________________________________________________
block6h_expand_activation (Acti (None, 7, 7, 1824)   0           block6h_expand_bn[0][0]          
__________________________________________________________________________________________________
block6h_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6h_expand_activation[0][0]  
__________________________________________________________________________________________________
block6h_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6h_dwconv[0][0]             
__________________________________________________________________________________________________
block6h_activation (Activation) (None, 7, 7, 1824)   0           block6h_bn[0][0]                 
__________________________________________________________________________________________________
block6h_se_squeeze (GlobalAvera (None, 1824)         0           block6h_activation[0][0]         
__________________________________________________________________________________________________
block6h_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6h_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6h_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6h_se_reshape[0][0]         
__________________________________________________________________________________________________
block6h_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6h_se_reduce[0][0]          
__________________________________________________________________________________________________
block6h_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6h_activation[0][0]         
                                                                 block6h_se_expand[0][0]          
__________________________________________________________________________________________________
block6h_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6h_se_excite[0][0]          
__________________________________________________________________________________________________
block6h_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6h_project_conv[0][0]       
__________________________________________________________________________________________________
block6h_drop (Dropout)          (None, 7, 7, 304)    0           block6h_project_bn[0][0]         
__________________________________________________________________________________________________
block6h_add (Add)               (None, 7, 7, 304)    0           block6h_drop[0][0]               
                                                                 block6g_add[0][0]                
__________________________________________________________________________________________________
block6i_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6h_add[0][0]                
__________________________________________________________________________________________________
block6i_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block6i_expand_conv[0][0]        
__________________________________________________________________________________________________
block6i_expand_activation (Acti (None, 7, 7, 1824)   0           block6i_expand_bn[0][0]          
__________________________________________________________________________________________________
block6i_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   45600       block6i_expand_activation[0][0]  
__________________________________________________________________________________________________
block6i_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block6i_dwconv[0][0]             
__________________________________________________________________________________________________
block6i_activation (Activation) (None, 7, 7, 1824)   0           block6i_bn[0][0]                 
__________________________________________________________________________________________________
block6i_se_squeeze (GlobalAvera (None, 1824)         0           block6i_activation[0][0]         
__________________________________________________________________________________________________
block6i_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block6i_se_squeeze[0][0]         
__________________________________________________________________________________________________
block6i_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block6i_se_reshape[0][0]         
__________________________________________________________________________________________________
block6i_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block6i_se_reduce[0][0]          
__________________________________________________________________________________________________
block6i_se_excite (Multiply)    (None, 7, 7, 1824)   0           block6i_activation[0][0]         
                                                                 block6i_se_expand[0][0]          
__________________________________________________________________________________________________
block6i_project_conv (Conv2D)   (None, 7, 7, 304)    554496      block6i_se_excite[0][0]          
__________________________________________________________________________________________________
block6i_project_bn (BatchNormal (None, 7, 7, 304)    1216        block6i_project_conv[0][0]       
__________________________________________________________________________________________________
block6i_drop (Dropout)          (None, 7, 7, 304)    0           block6i_project_bn[0][0]         
__________________________________________________________________________________________________
block6i_add (Add)               (None, 7, 7, 304)    0           block6i_drop[0][0]               
                                                                 block6h_add[0][0]                
__________________________________________________________________________________________________
block7a_expand_conv (Conv2D)    (None, 7, 7, 1824)   554496      block6i_add[0][0]                
__________________________________________________________________________________________________
block7a_expand_bn (BatchNormali (None, 7, 7, 1824)   7296        block7a_expand_conv[0][0]        
__________________________________________________________________________________________________
block7a_expand_activation (Acti (None, 7, 7, 1824)   0           block7a_expand_bn[0][0]          
__________________________________________________________________________________________________
block7a_dwconv (DepthwiseConv2D (None, 7, 7, 1824)   16416       block7a_expand_activation[0][0]  
__________________________________________________________________________________________________
block7a_bn (BatchNormalization) (None, 7, 7, 1824)   7296        block7a_dwconv[0][0]             
__________________________________________________________________________________________________
block7a_activation (Activation) (None, 7, 7, 1824)   0           block7a_bn[0][0]                 
__________________________________________________________________________________________________
block7a_se_squeeze (GlobalAvera (None, 1824)         0           block7a_activation[0][0]         
__________________________________________________________________________________________________
block7a_se_reshape (Reshape)    (None, 1, 1, 1824)   0           block7a_se_squeeze[0][0]         
__________________________________________________________________________________________________
block7a_se_reduce (Conv2D)      (None, 1, 1, 76)     138700      block7a_se_reshape[0][0]         
__________________________________________________________________________________________________
block7a_se_expand (Conv2D)      (None, 1, 1, 1824)   140448      block7a_se_reduce[0][0]          
__________________________________________________________________________________________________
block7a_se_excite (Multiply)    (None, 7, 7, 1824)   0           block7a_activation[0][0]         
                                                                 block7a_se_expand[0][0]          
__________________________________________________________________________________________________
block7a_project_conv (Conv2D)   (None, 7, 7, 512)    933888      block7a_se_excite[0][0]          
__________________________________________________________________________________________________
block7a_project_bn (BatchNormal (None, 7, 7, 512)    2048        block7a_project_conv[0][0]       
__________________________________________________________________________________________________
block7b_expand_conv (Conv2D)    (None, 7, 7, 3072)   1572864     block7a_project_bn[0][0]         
__________________________________________________________________________________________________
block7b_expand_bn (BatchNormali (None, 7, 7, 3072)   12288       block7b_expand_conv[0][0]        
__________________________________________________________________________________________________
block7b_expand_activation (Acti (None, 7, 7, 3072)   0           block7b_expand_bn[0][0]          
__________________________________________________________________________________________________
block7b_dwconv (DepthwiseConv2D (None, 7, 7, 3072)   27648       block7b_expand_activation[0][0]  
__________________________________________________________________________________________________
block7b_bn (BatchNormalization) (None, 7, 7, 3072)   12288       block7b_dwconv[0][0]             
__________________________________________________________________________________________________
block7b_activation (Activation) (None, 7, 7, 3072)   0           block7b_bn[0][0]                 
__________________________________________________________________________________________________
block7b_se_squeeze (GlobalAvera (None, 3072)         0           block7b_activation[0][0]         
__________________________________________________________________________________________________
block7b_se_reshape (Reshape)    (None, 1, 1, 3072)   0           block7b_se_squeeze[0][0]         
__________________________________________________________________________________________________
block7b_se_reduce (Conv2D)      (None, 1, 1, 128)    393344      block7b_se_reshape[0][0]         
__________________________________________________________________________________________________
block7b_se_expand (Conv2D)      (None, 1, 1, 3072)   396288      block7b_se_reduce[0][0]          
__________________________________________________________________________________________________
block7b_se_excite (Multiply)    (None, 7, 7, 3072)   0           block7b_activation[0][0]         
                                                                 block7b_se_expand[0][0]          
__________________________________________________________________________________________________
block7b_project_conv (Conv2D)   (None, 7, 7, 512)    1572864     block7b_se_excite[0][0]          
__________________________________________________________________________________________________
block7b_project_bn (BatchNormal (None, 7, 7, 512)    2048        block7b_project_conv[0][0]       
__________________________________________________________________________________________________
block7b_drop (Dropout)          (None, 7, 7, 512)    0           block7b_project_bn[0][0]         
__________________________________________________________________________________________________
block7b_add (Add)               (None, 7, 7, 512)    0           block7b_drop[0][0]               
                                                                 block7a_project_bn[0][0]         
__________________________________________________________________________________________________
block7c_expand_conv (Conv2D)    (None, 7, 7, 3072)   1572864     block7b_add[0][0]                
__________________________________________________________________________________________________
block7c_expand_bn (BatchNormali (None, 7, 7, 3072)   12288       block7c_expand_conv[0][0]        
__________________________________________________________________________________________________
block7c_expand_activation (Acti (None, 7, 7, 3072)   0           block7c_expand_bn[0][0]          
__________________________________________________________________________________________________
block7c_dwconv (DepthwiseConv2D (None, 7, 7, 3072)   27648       block7c_expand_activation[0][0]  
__________________________________________________________________________________________________
block7c_bn (BatchNormalization) (None, 7, 7, 3072)   12288       block7c_dwconv[0][0]             
__________________________________________________________________________________________________
block7c_activation (Activation) (None, 7, 7, 3072)   0           block7c_bn[0][0]                 
__________________________________________________________________________________________________
block7c_se_squeeze (GlobalAvera (None, 3072)         0           block7c_activation[0][0]         
__________________________________________________________________________________________________
block7c_se_reshape (Reshape)    (None, 1, 1, 3072)   0           block7c_se_squeeze[0][0]         
__________________________________________________________________________________________________
block7c_se_reduce (Conv2D)      (None, 1, 1, 128)    393344      block7c_se_reshape[0][0]         
__________________________________________________________________________________________________
block7c_se_expand (Conv2D)      (None, 1, 1, 3072)   396288      block7c_se_reduce[0][0]          
__________________________________________________________________________________________________
block7c_se_excite (Multiply)    (None, 7, 7, 3072)   0           block7c_activation[0][0]         
                                                                 block7c_se_expand[0][0]          
__________________________________________________________________________________________________
block7c_project_conv (Conv2D)   (None, 7, 7, 512)    1572864     block7c_se_excite[0][0]          
__________________________________________________________________________________________________
block7c_project_bn (BatchNormal (None, 7, 7, 512)    2048        block7c_project_conv[0][0]       
__________________________________________________________________________________________________
block7c_drop (Dropout)          (None, 7, 7, 512)    0           block7c_project_bn[0][0]         
__________________________________________________________________________________________________
block7c_add (Add)               (None, 7, 7, 512)    0           block7c_drop[0][0]               
                                                                 block7b_add[0][0]                
__________________________________________________________________________________________________
top_conv (Conv2D)               (None, 7, 7, 2048)   1048576     block7c_add[0][0]                
__________________________________________________________________________________________________
top_bn (BatchNormalization)     (None, 7, 7, 2048)   8192        top_conv[0][0]                   
__________________________________________________________________________________________________
top_activation (Activation)     (None, 7, 7, 2048)   0           top_bn[0][0]                     
__________________________________________________________________________________________________
flatten_4 (Flatten)             (None, 100352)       0           top_activation[0][0]             
__________________________________________________________________________________________________
dropout_8 (Dropout)             (None, 100352)       0           flatten_4[0][0]                  
__________________________________________________________________________________________________
dense_6 (Dense)                 (None, 10)           1003530     dropout_8[0][0]                  
==================================================================================================
Total params: 29,517,057
Trainable params: 1,003,530
Non-trainable params: 28,513,527
__________________________________________________________________________________________________
</code></pre>
</div>
</div>
<div id="e736959e" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.796138,&quot;end_time&quot;:&quot;2023-01-11T19:57:24.762419&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:57:22.966281&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Lo siguente que se realizará es el entrenamiento de nuestro modelo,
que será de la misma forma que el resto, se entrenará durante 100 epochs
hasta que el EarlyStopping lo detenga.</p>
</div>
<div id="6d1b8903" class="cell code" data-execution_count="46"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T19:57:28.304470Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T19:57:28.304086Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:28:34.016266Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:28:34.015229Z&quot;}"
data-papermill="{&quot;duration&quot;:1867.480315,&quot;end_time&quot;:&quot;2023-01-11T20:28:34.018416&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T19:57:26.538101&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb76"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>history_efficientnetb5 <span class="op">=</span> model_efficientnetb5.fit_generator(train_generator,validation_data<span class="op">=</span>val_generator,epochs<span class="op">=</span><span class="dv">100</span>,verbose<span class="op">=</span><span class="dv">1</span>, callbacks<span class="op">=</span>cbs)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/opt/conda/lib/python3.7/site-packages/keras/engine/training.py:1972: UserWarning:

`Model.fit_generator` is deprecated and will be removed in a future version. Please use `Model.fit`, which supports generators.

</code></pre>
</div>
<div class="output stream stdout">
<pre><code>Epoch 1/100
655/655 [==============================] - 325s 479ms/step - loss: 1.3173 - auc: 0.9649 - val_loss: 1.1427 - val_auc: 0.9769
Epoch 2/100
655/655 [==============================] - 307s 469ms/step - loss: 1.2301 - auc: 0.9749 - val_loss: 1.2966 - val_auc: 0.9797
Epoch 3/100
655/655 [==============================] - 307s 469ms/step - loss: 1.2218 - auc: 0.9774 - val_loss: 1.4505 - val_auc: 0.9784
Epoch 4/100
655/655 [==============================] - 309s 471ms/step - loss: 1.1726 - auc: 0.9790 - val_loss: 1.6228 - val_auc: 0.9796
Epoch 5/100
655/655 [==============================] - 301s 459ms/step - loss: 1.0525 - auc: 0.9819 - val_loss: 1.6573 - val_auc: 0.9811
Epoch 6/100
655/655 [==============================] - 315s 481ms/step - loss: 1.2351 - auc: 0.9798 - val_loss: 1.7942 - val_auc: 0.9815
</code></pre>
</div>
</div>
<div id="aeb062ee" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.008993,&quot;end_time&quot;:&quot;2023-01-11T20:28:38.065797&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:28:36.056804&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>El mejor resultado obtenido durante nuestro entrenamiento sobre el
conjunto de validación es de <code>0.9827</code>, un resultado muy bueno
otra vez. Por lo tanto, nos guardaremos dicho modelo para una posterior
evaluación.</p>
</div>
<div id="2f97840f" class="cell code" data-execution_count="47"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:28:42.195478Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:28:42.195102Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:29:41.418214Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:29:41.417210Z&quot;}"
data-papermill="{&quot;duration&quot;:61.278106,&quot;end_time&quot;:&quot;2023-01-11T20:29:41.420726&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:28:40.142620&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb79"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>model_efficientnetb5.save(<span class="st">&quot;model_efficientnetb5.h5&quot;</span>)</span></code></pre></div>
<div class="output stream stderr">
<pre><code>/opt/conda/lib/python3.7/site-packages/keras/utils/generic_utils.py:497: CustomMaskWarning:

Custom mask layers require a config and must override get_config. When loading, the custom mask layer must be passed to the custom_objects argument.

</code></pre>
</div>
</div>
<div id="cd0f6035" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.433061,&quot;end_time&quot;:&quot;2023-01-11T20:29:45.834694&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:29:43.401633&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez guardado dicho modelo procedemos a mostrar gráficamente cómo
ha evolucionado el entrenamiento de nuestro modelol.</p>
</div>
<div id="6188872e" class="cell code" data-execution_count="48"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:29:50.214160Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:29:50.213521Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:29:50.653316Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:29:50.652257Z&quot;}"
data-papermill="{&quot;duration&quot;:2.663955,&quot;end_time&quot;:&quot;2023-01-11T20:29:50.655789&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:29:47.991834&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb81"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>val_acc <span class="op">=</span> np.mean(history_efficientnetb5.history[<span class="st">&#39;val_auc&#39;</span>])</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>val_loss <span class="op">=</span> np.mean(history_efficientnetb5.history[<span class="st">&#39;val_loss&#39;</span>])</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>acc <span class="op">=</span> np.mean(history_efficientnetb5.history[<span class="st">&#39;auc&#39;</span>])</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>loss <span class="op">=</span> np.mean(history_efficientnetb5.history[<span class="st">&#39;loss&#39;</span>])</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>plt.style.use(<span class="st">&quot;ggplot&quot;</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">4</span>))</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb5.history[<span class="st">&#39;val_loss&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb5.history[<span class="st">&#39;loss&#39;</span>], marker <span class="op">=</span> <span class="st">&#39;o&#39;</span>)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_loss&quot;</span>, <span class="st">&quot;loss&quot;</span>])</span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;Losses</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_loss<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>loss<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;Loss&quot;</span>)</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>plt.subplot(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb5.history[<span class="st">&#39;val_auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;*&#39;</span>)</span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>plt.plot(history_efficientnetb5.history[<span class="st">&#39;auc&#39;</span>], marker<span class="op">=</span><span class="st">&#39;o&#39;</span>)</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>plt.legend([<span class="st">&quot;val_auc&quot;</span>, <span class="st">&quot;auc&quot;</span>])</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f&quot;AUCs</span><span class="ch">\n</span><span class="ss">Val: </span><span class="sc">{</span>val_acc<span class="sc">:.3f}</span><span class="ss">. Train: </span><span class="sc">{</span>acc<span class="sc">:.3f}</span><span class="ss">&quot;</span>)</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">&quot;Epochs&quot;</span>)</span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">&quot;AUC&quot;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="48">
<pre><code>Text(0, 0.5, &#39;AUC&#39;)</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/511e6767d2de74443f3ae9632a5a0b288c0be2fb.png" /></p>
</div>
</div>
<div id="b7bd06c6" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.980688,&quot;end_time&quot;:&quot;2023-01-11T20:29:54.671095&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:29:52.690407&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar cómo sigue existiendo un mínimo de varianza entre el
resultado obtenido en entrenamiento y validación. Además, podemos
observar en la pérdida cómo el sesgo va aumentando en el conjunto de
validación. Aún teniendo en cuenta todo lo comentado el modelo obtenido
es muy bueno.</p>
<h1 id="5-análisis-de-los-resultados-obtenidos">5. Análisis de los
resultados obtenidos<a name="resultados"></a></h1>
<p>En este apartado evaluaremos frente al test los tres mejores modelos
obtenidos, en este caso los tenemos ya entrenados y almacenados en la
carpeta <em><strong>modelosvarp</strong></em> que hemos creado para este
proyecto. Por lo tanto, lo primero que realizamos es cargar los modelos
con <code>load_model</code> de tensorflow para modelos ya
entrenados.</p>
</div>
<div id="bfdff121" class="cell code" data-execution_count="49"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:29:58.672476Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:29:58.671809Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:30:18.621092Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:30:18.620062Z&quot;}"
data-papermill="{&quot;duration&quot;:21.969314,&quot;end_time&quot;:&quot;2023-01-11T20:30:18.623887&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:29:56.654573&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb83"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>model_resnet50 <span class="op">=</span> tf.keras.models.load_model(<span class="st">&#39;../input/modelosvarp/model_resnet50.h5&#39;</span>)</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>model_efficientnetb7 <span class="op">=</span> tf.keras.models.load_model(<span class="st">&#39;../input/modelosvarp/model_efficientnetb7.h5&#39;</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>model_efficientnetb5 <span class="op">=</span> tf.keras.models.load_model(<span class="st">&#39;../input/modelosvarp/model_efficientnetb5.h5&#39;</span>)</span></code></pre></div>
</div>
<div id="01e2d1b3" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.241045,&quot;end_time&quot;:&quot;2023-01-11T20:30:22.880044&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:30:20.638999&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos cargados los distintos modelos entrenados procedemos
a evaluarlos frente al test.</p>
</div>
<div id="3625e819" class="cell code" data-execution_count="50"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:30:26.791733Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:30:26.790192Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:31:18.496109Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:31:18.495078Z&quot;}"
data-papermill="{&quot;duration&quot;:53.714216,&quot;end_time&quot;:&quot;2023-01-11T20:31:18.498309&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:30:24.784093&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb84"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>test_loss_resnet50, test_auc_resnet50 <span class="op">=</span> model_resnet50.evaluate(test_generator, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>test_loss_efficientnetb7, test_auc_efficientnetb7 <span class="op">=</span> model_efficientnetb7.evaluate(test_generator, verbose<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>test_loss_efficientnetb5, test_auc_efficientnetb5 <span class="op">=</span> model_efficientnetb5.evaluate(test_generator, verbose<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
<div class="output stream stdout">
<pre><code>83/83 [==============================] - 10s 103ms/step - loss: 5.3336 - auc: 0.9634
83/83 [==============================] - 24s 235ms/step - loss: 2.0402 - auc: 0.9789
83/83 [==============================] - 16s 143ms/step - loss: 1.9561 - auc: 0.9757
</code></pre>
</div>
</div>
<div id="7979fa51" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.030128,&quot;end_time&quot;:&quot;2023-01-11T20:31:22.945070&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:31:20.914942&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Si observamos los resultados el mejor modelo que obtenemos en cuanto
a AUC es el modelo EfficientNetB7, en cuanto a pérdida es el modelo
EfficientNetB5. Podemos observar cómo los modelos de EfficientNet son
muy buenos para este tipo de problemas siendo muy sencillos de utilizar.
Por lo tanto, tendríamos el siguiente orden de resultados prente al test
según AUC:</p>
<ol>
<li><p>Modelo <strong>EfficientNetB7</strong></p></li>
<li><p>Modelo <strong>EfficientNetB5</strong></p></li>
<li><p>Modelo <strong>ResNet50</strong></p></li>
</ol>
<p>Y en cuanto a pérdida:</p>
<ol>
<li><p>Modelo <strong>EfficientNetB5</strong></p></li>
<li><p>Modelo <strong>EfficientNetB7</strong></p></li>
<li><p>Modelo <strong>ResNet50</strong></p></li>
</ol>
<p>Con motivo de mejorar dichos resultados frente al test lo que
realizaremos a continuación es construir un ensemble muy simple para
comprobar si obtenemos una pequeñe mejora a la hora de la
clasificación.</p>
<h1 id="6-detalles-del-modelo-final-ensemble">6. Detalles del modelo
final: Ensemble<a name="validacion"></a></h1>
<p>Por lo tanto, cómo se ha comentado la idea final que hemos planteado
es la de crear un ensemble muy sencillo para comprobar si existe una
mejora. Para elaborar dicho ensemble la idea que hay detrás es la que se
puede apreciar en la siguiente imagen:</p>
</div>
<div id="e07edefb" class="cell code" data-execution_count="51"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:31:26.965953Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:31:26.965511Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:31:26.983192Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:31:26.982268Z&quot;}"
data-papermill="{&quot;duration&quot;:2.040796,&quot;end_time&quot;:&quot;2023-01-11T20:31:26.985315&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:31:24.944519&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb86"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>Image(<span class="st">&#39;../input/modelosvarp/ensemble.png&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="51">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/8053d70259a6e77255824879f3acad423c935eec.png" /></p>
</div>
</div>
<div id="23bd301e" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.00609,&quot;end_time&quot;:&quot;2023-01-11T20:31:31.120348&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:31:29.114258&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Cómo podemos observar no se trata de un ensemble de voto por la
mayoría, nuestro ensemble tendrá en cuenta las diferentes probabilidades
de clasificación que ofrece cada modelo por separado. Se podría decir
que nuestro ensemble realiza una agregación de resultados por la media
de probabilidades obtenidas. Conseguir esto es muy sencillo de hacer, lo
único que tendremos que realizar es la predicción cada modelo por
separado y sumar las probabilidades, aunque no realizemos la media al
aplicar <code>np.argmax()</code> estaremos clasificando a la clase que
tenga una mayor suma de probabilidades obteniendo el mismo
resultado.</p>
</div>
<div id="f486a9bc" class="cell code" data-execution_count="52"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:31:35.176108Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:31:35.175737Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:32:17.222064Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:32:17.221059Z&quot;}"
data-papermill="{&quot;duration&quot;:44.072485,&quot;end_time&quot;:&quot;2023-01-11T20:32:17.224466&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:31:33.151981&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb87"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>prob_a <span class="op">=</span> model_resnet50.predict(test_generator)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>prob_b <span class="op">=</span> model_efficientnetb7.predict(test_generator)</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>prob_c <span class="op">=</span> model_efficientnetb5.predict(test_generator)</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>probabilities <span class="op">=</span> np.add(prob_a, prob_b)</span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>probabilities <span class="op">=</span> np.add(probabilities, prob_c)</span></code></pre></div>
</div>
<div id="860e49d5" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.99485,&quot;end_time&quot;:&quot;2023-01-11T20:32:21.219916&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:19.225066&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Por lo tanto, una vez tenemos agrupadas las probabilidades de todos
los modelos calculamos como se clasificaría almacenandolo en
prediction.</p>
</div>
<div id="db1d16a4" class="cell code" data-execution_count="53"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:32:25.935153Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:32:25.934774Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:32:25.939771Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:32:25.938717Z&quot;}"
data-papermill="{&quot;duration&quot;:2.004407,&quot;end_time&quot;:&quot;2023-01-11T20:32:25.942017&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:23.937610&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb88"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>prediction <span class="op">=</span> np.argmax(probabilities,axis<span class="op">=</span><span class="dv">1</span>)</span></code></pre></div>
</div>
<div id="5617aa29" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.981008,&quot;end_time&quot;:&quot;2023-01-11T20:32:29.906940&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:27.925932&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>A continuación, guardaremos el resultado verdadero como
true_prediction.</p>
</div>
<div id="d85330ac" class="cell code" data-execution_count="54"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:32:34.088719Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:32:34.088358Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:32:34.092937Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:32:34.091895Z&quot;}"
data-papermill="{&quot;duration&quot;:2.135335,&quot;end_time&quot;:&quot;2023-01-11T20:32:34.094898&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:31.959563&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb89"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>true_prediction <span class="op">=</span> test_generator.classes</span></code></pre></div>
</div>
<div id="2750da6d" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.015287,&quot;end_time&quot;:&quot;2023-01-11T20:32:38.103252&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:36.087965&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Con el objetivo de compara el resultado de nuestro ensemble con el de
los modelos por serparado con la misma métrica de evaluación (AUC)
tendremos que realizar una serie de paso para poder evaluarlo. Para ello
tendremos que realizar un OneHotEncoder sobre nuestros arrays prediction
y true_prediction.</p>
</div>
<div id="39ab9004" class="cell code" data-execution_count="55"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:32:42.096871Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:32:42.096487Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:32:42.615610Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:32:42.614617Z&quot;}"
data-papermill="{&quot;duration&quot;:2.521827,&quot;end_time&quot;:&quot;2023-01-11T20:32:42.618335&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:40.096508&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb90"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OneHotEncoder</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>onehotencoder <span class="op">=</span> OneHotEncoder()</span></code></pre></div>
</div>
<div id="2e649635" class="cell code" data-execution_count="56"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:32:46.790103Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:32:46.789678Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:32:46.801003Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:32:46.800137Z&quot;}"
data-papermill="{&quot;duration&quot;:2.066114,&quot;end_time&quot;:&quot;2023-01-11T20:32:46.803096&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:44.736982&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb91"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>true_prediction_df <span class="op">=</span> true_prediction.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>prediction_df <span class="op">=</span> prediction.reshape(<span class="op">-</span><span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>true_prediction_df <span class="op">=</span> pd.DataFrame(true_prediction_df)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>prediction_df <span class="op">=</span> pd.DataFrame(prediction_df)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>prediction_transformed <span class="op">=</span> onehotencoder.fit_transform(prediction_df).toarray()</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>true_prediction_transformed <span class="op">=</span> onehotencoder.fit_transform(true_prediction_df).toarray()</span></code></pre></div>
</div>
<div id="1d83aa98" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.03733,&quot;end_time&quot;:&quot;2023-01-11T20:32:50.825383&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:48.788053&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez tenemos preparado nuestra predicción para poder ser evaluado
con la métrica AUC procedemos a hacerlo.</p>
</div>
<div id="8e47e9f8" class="cell code" data-execution_count="57"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:32:55.270151Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:32:55.269491Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:32:55.338092Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:32:55.337106Z&quot;}"
data-papermill="{&quot;duration&quot;:2.544528,&quot;end_time&quot;:&quot;2023-01-11T20:32:55.340498&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:52.795970&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb92"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> roc_auc_score</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>roc_auc_score(true_prediction_transformed, prediction_transformed, multi_class<span class="op">=</span><span class="st">&#39;ovr&#39;</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="57">
<pre><code>0.9801319581932596</code></pre>
</div>
</div>
<div id="f62dd3d3" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.026055,&quot;end_time&quot;:&quot;2023-01-11T20:32:59.532564&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:32:57.506509&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Obtenemos un resultado frente al test de <code>0.98013</code>, un
resultado muy bueno dado el problema que teniamos sobre una muesra
desbalanceada. Además, podemos concluir con que la agregación de
resultados de una forma muy sencilla nos ofrece un mejor resultado que
por separado. A continuación seguiremos haciendo comparaciones con
diferentes métricas de evaluación.</p>
</div>
<div id="aefbbf48" class="cell code" data-execution_count="58"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:33:03.557953Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:33:03.557298Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:33:03.563884Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:33:03.562901Z&quot;}"
data-papermill="{&quot;duration&quot;:2.049035,&quot;end_time&quot;:&quot;2023-01-11T20:33:03.565928&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:01.516893&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb94"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.metrics <span class="im">import</span> classification_report, confusion_matrix, ConfusionMatrixDisplay</span></code></pre></div>
</div>
<div id="79bb6e06" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.13878,&quot;end_time&quot;:&quot;2023-01-11T20:33:07.724843&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:05.586063&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Realizaremos un classification_report para cada modelo por separado y
en última instancia lo realizaremos del ensemble.</p>
</div>
<div id="7600f76f" class="cell code" data-execution_count="59"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:33:11.707279Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:33:11.706903Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:33:11.719655Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:33:11.718606Z&quot;}"
data-papermill="{&quot;duration&quot;:1.998518,&quot;end_time&quot;:&quot;2023-01-11T20:33:11.721778&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:09.723260&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb95"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(true_prediction, np.argmax(prob_a,axis<span class="op">=</span><span class="dv">1</span>), digits<span class="op">=</span><span class="dv">4</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

           0     0.9315    0.9220    0.9267       487
           1     0.9234    0.9163    0.9198       263
           2     0.9257    0.9384    0.9320       146
           3     0.9186    0.9575    0.9376       212
           4     0.9675    0.9582    0.9628       311
           5     0.8235    0.9167    0.8676       168
           6     0.8490    0.8670    0.8579       188
           7     0.9200    0.8846    0.9020       182
           8     0.9914    0.9524    0.9715       483
           9     0.9471    0.9572    0.9521       187

    accuracy                         0.9307      2627
   macro avg     0.9198    0.9270    0.9230      2627
weighted avg     0.9321    0.9307    0.9311      2627

</code></pre>
</div>
</div>
<div id="fef20170" class="cell code" data-execution_count="60"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:33:15.836968Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:33:15.836548Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:33:15.848903Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:33:15.847908Z&quot;}"
data-papermill="{&quot;duration&quot;:2.103477,&quot;end_time&quot;:&quot;2023-01-11T20:33:15.851547&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:13.748070&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb97"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(true_prediction, np.argmax(prob_b,axis<span class="op">=</span><span class="dv">1</span>), digits<span class="op">=</span><span class="dv">4</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

           0     0.9582    0.9425    0.9503       487
           1     0.8811    0.9582    0.9180       263
           2     0.9728    0.9795    0.9761       146
           3     0.9581    0.9717    0.9649       212
           4     0.9770    0.9582    0.9675       311
           5     0.9643    0.9643    0.9643       168
           6     0.9551    0.9043    0.9290       188
           7     0.9486    0.9121    0.9300       182
           8     0.9774    0.9834    0.9804       483
           9     0.9574    0.9626    0.9600       187

    accuracy                         0.9558      2627
   macro avg     0.9550    0.9537    0.9540      2627
weighted avg     0.9565    0.9558    0.9559      2627

</code></pre>
</div>
</div>
<div id="9b53c650" class="cell code" data-execution_count="61"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:33:19.995810Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:33:19.995456Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:33:20.008702Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:33:20.006881Z&quot;}"
data-papermill="{&quot;duration&quot;:1.903149,&quot;end_time&quot;:&quot;2023-01-11T20:33:20.010813&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:18.107664&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb99"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(true_prediction, np.argmax(prob_c,axis<span class="op">=</span><span class="dv">1</span>), digits<span class="op">=</span><span class="dv">4</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

           0     0.9049    0.9774    0.9398       487
           1     0.9478    0.8973    0.9219       263
           2     0.9667    0.9932    0.9797       146
           3     0.9761    0.9623    0.9691       212
           4     0.9836    0.9614    0.9724       311
           5     1.0000    0.9048    0.9500       168
           6     0.9081    0.8936    0.9008       188
           7     0.9235    0.9286    0.9260       182
           8     0.9712    0.9772    0.9742       483
           9     0.9672    0.9465    0.9568       187

    accuracy                         0.9509      2627
   macro avg     0.9549    0.9442    0.9491      2627
weighted avg     0.9519    0.9509    0.9509      2627

</code></pre>
</div>
</div>
<div id="5126c38d" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.044306,&quot;end_time&quot;:&quot;2023-01-11T20:33:24.068620&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:22.024314&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Una vez realizado de los modelos por separado podemos observar que el
modelo que obtiene un mejor f1-score es el modelo EfficientNetB7, siendo
otra vez el mejor modelo por separado. A continuación, veremos que
resultado obtiene el ensemble que hemos creado.</p>
</div>
<div id="8b7a854d" class="cell code" data-execution_count="62"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:33:28.749190Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:33:28.748426Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:33:28.766437Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:33:28.765583Z&quot;}"
data-papermill="{&quot;duration&quot;:2.225607,&quot;end_time&quot;:&quot;2023-01-11T20:33:28.768885&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:26.543278&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb101"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(classification_report(true_prediction, prediction, digits<span class="op">=</span><span class="dv">4</span>))</span></code></pre></div>
<div class="output stream stdout">
<pre><code>              precision    recall  f1-score   support

           0     0.9406    0.9754    0.9577       487
           1     0.9474    0.9582    0.9527       263
           2     0.9864    0.9932    0.9898       146
           3     0.9765    0.9811    0.9788       212
           4     0.9805    0.9711    0.9758       311
           5     0.9758    0.9583    0.9670       168
           6     0.9293    0.9096    0.9194       188
           7     0.9714    0.9341    0.9524       182
           8     0.9958    0.9855    0.9906       483
           9     0.9785    0.9733    0.9759       187

    accuracy                         0.9676      2627
   macro avg     0.9682    0.9640    0.9660      2627
weighted avg     0.9679    0.9676    0.9677      2627

</code></pre>
</div>
</div>
<div id="427d5012" class="cell markdown"
data-papermill="{&quot;duration&quot;:1.903126,&quot;end_time&quot;:&quot;2023-01-11T20:33:32.751690&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:30.848564&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos observar cómo obtiene un 0.9676 siendo otra vez el resultado
superior a que si lo evaluasemos por separado. Por lo tanto, podemos
concluir con que es muy interesante plantearse siempre la implementación
de un ensemble aunque este sea muy sencillo, cómo es el caso. Si
mostramos la matriz de confusión de dicho ensemble tendría la siguiente
forma:</p>
</div>
<div id="d8c897a5" class="cell code" data-execution_count="63"
data-execution="{&quot;iopub.execute_input&quot;:&quot;2023-01-11T20:33:36.778198Z&quot;,&quot;iopub.status.busy&quot;:&quot;2023-01-11T20:33:36.777813Z&quot;,&quot;iopub.status.idle&quot;:&quot;2023-01-11T20:33:37.399895Z&quot;,&quot;shell.execute_reply&quot;:&quot;2023-01-11T20:33:37.398752Z&quot;}"
data-papermill="{&quot;duration&quot;:2.616822,&quot;end_time&quot;:&quot;2023-01-11T20:33:37.402204&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:34.785382&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<div class="sourceCode" id="cb103"><pre
class="sourceCode python"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>cm <span class="op">=</span> confusion_matrix(true_prediction, prediction)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">13</span>,<span class="dv">13</span>))</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>ax.grid(<span class="va">False</span>)</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>disp <span class="op">=</span> ConfusionMatrixDisplay(confusion_matrix <span class="op">=</span> cm)</span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>disp.plot(ax<span class="op">=</span>ax,</span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>         colorbar <span class="op">=</span> <span class="va">False</span>)</span></code></pre></div>
<div class="output execute_result" data-execution_count="63">
<pre><code>&lt;sklearn.metrics._plot.confusion_matrix.ConfusionMatrixDisplay at 0x7fd5f9f30b10&gt;</code></pre>
</div>
<div class="output display_data">
<p><img
src="vertopal_efc99e98770c49ccb9cf9a2b420f5627/f42931b401504cd6bbb2871cd03376ec10321def.png" /></p>
</div>
</div>
<div id="aaeb707c" class="cell markdown"
data-papermill="{&quot;duration&quot;:2.149724,&quot;end_time&quot;:&quot;2023-01-11T20:33:41.649067&quot;,&quot;exception&quot;:false,&quot;start_time&quot;:&quot;2023-01-11T20:33:39.499343&quot;,&quot;status&quot;:&quot;completed&quot;}"
data-tags="[]">
<p>Podemos apreciar cómo clasifica la mayoría de clases dónde debería,
está matriz de confusión es muy clarificadora en el sentido de que nos
muestra que nuestro modelo final, el ensemble, es muy buen modelo para
el problema que se nos había presentado.</p>
<h1 id="7-conclusión">7. Conclusión<a name="conclusion"></a></h1>
<p>Para terminar, destacar que la implementación de los diferentes tipos
de modelos nos permite sacar unas serie de conclusiones:</p>
<ul>
<li><p>Una buena arquitectura en un diseño creado manualmente puede ser
muy superior a cualquier modelo preentrenado.</p></li>
<li><p>La problemática que encontramos del punto anterior es que para
encontrar dicha arquitectura tienes que realizar muchas pruebas y el
entrenamiento se dispara en tiempo de ejecución para encontrar la
óptima.</p></li>
<li><p>Los modelo preentrenados solventan muy bien dicha problemática de
encontrar la mejor arquitectura, dado que ofrecen un muy buen
resultado.</p></li>
<li><p>La agrupación de resultados puede ofrecer un mejor resultado,
esto se ve cuando realizamos una agregación muy simple con el
ensemble.</p></li>
</ul>
<p>En conclusión, estamos muy contentos con el trabajo realizado con
este proyecto dado que hemos conseguido entender todos esos puntos y
profundizar en Tensorflow/Keras. Además, creemos que el resultado
obtenido es muy bueno dado el problema que teniamos al tener muy pocas
muestras de ciertas clases. Por lo tanto, la valoración interna que
realizamos es muy buena y creemos que la mejor forma de aprender es
poniéndonos delante de un problema.</p>
</div>
</body>
</html>
